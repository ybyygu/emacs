#+TITLE: ä¸ªäººæ–‡æœ¬äº¤äº’ç³»ç»Ÿ(based on doom-emacs)
#+SETUPFILE: ~/Notes/common.org

å†å²è®¾ç½®
- [[file:~/Install/configs/spacemacs/config.note][spacemacs]]
- [[file:~/Install/configs/spacemacs/ybyygu.org][emacs24-starter-kit]]
- ä»é›¶å¼€å§‹ [[file:~/Install/configs/emacs/gwp/gwp.note][gwp.note]]

å¾…è€ƒ
- [[https://github.com/davidshepherd7/terminal-here][davidshepherd7/terminal-here: An Emacs package to open an external terminal emulator in the current directory]]

* Portal
- note [[zotero://select/items/1_MG5FH5V9][@emacs]]
- [[zotero://select/library/collections/Z8UFNPZ4][zotero collection]]

* Tasks [9/9]
- [X] insert çŠ¶æ€ä¸‹æ— æ³•è¾“å…¥z
- [X] ä½¿ç”¨ transient é‡å†™cargo (tangle)
- [X] autosaveç©ºæ ¼ä¸¢å¤±é—®é¢˜
- [X] org-capture clipboardä¸æ­£å¸¸
- [X] tabä¸èƒ½cycle itemåŠproperties
- [X] åœ¨magit commitç¯å¢ƒä¸­ä¸èƒ½ä½¿ç”¨C-d
- [X] æ·»åŠ  dired link to home çš„åŠŸèƒ½, æ–¹ä¾¿ virtualbox ä¸­æ‰“å¼€æ–‡ä»¶
- [X] agenda ä¸­çš„æŒ‰é”®æœ‰äº›é—®é¢˜
- [X] image å¤§å°ä¸èƒ½æ§åˆ¶

* é…ç½®å‚è€ƒ
- [ ] [[https://github.com/tshu-w/.emacs.d/tree/master/lisp][.emacs.d/lisp at master Â· tshu-w/.emacs.d]]
- [ ] [[https://github.com/bodnarlajos/emacs-pure][bodnarlajos/emacs-pure]]
- [ ] [[https://github.com/seagle0128/.emacs.d][seagle0128/.emacs.d: Centaur Emacs - A Fancy and Fast Emacs Configuration]]
- [ ] [[https://github.com/Wilfred/.emacs.d/tree/48e7eb583f6afdfa3257edd0b9e64b1f489c001a][Wilfred/.emacs.d]]
- [ ] [[https://github.com/purcell/emacs.d][purcell/emacs.d: An Emacs configuration bundle with batteries included]]
- [ ] [[https://git.sr.ht/~technomancy/better-defaults][~technomancy/better-defaults - sourcehut git]]
- [ ] [[https://github.com/hlissner/doom-emacs][doom-emacs: An Emacs configuration for the stubborn martian vimmer]]
  - [ ] [[https://github.com/hlissner/doom-emacs/blob/develop/docs/faq.org][doom-emacs/faq.org]]
  - [ ] [[https://github.com/hlissner/doom-emacs/blob/develop/docs/getting_started.org][doom-emacs/getting_started.org]]
  - [ ] [[https://github.com/hlissner/doom-emacs/blob/develop/docs/modules.org][doom-emacs/modules.org at develop]]
  - [ ] [[https://github.com/hlissner/doom-emacs/blob/develop/modules/lang/org/README.org#description][doom-emacs/README.org at develop Â· hlissner/doom-emacs]]
- [ ] https://github.com/gilbertw1/bmacs/blob/master/bmacs.org
- [X] [[https://tecosaur.github.io/emacs-config/config.html][Doom Emacs Configuration]] by tecosaur
  è¿™é‡Œæåˆ°äº†åŸºäºmupdfçš„ä¸€ä¸ªæ¨¡å—, å¯ä»¥å…³æ³¨. pdf-toolså¤ªæ…¢äº†
- [ ] [[https://noelwelsh.com/posts/2019-01-10-doom-emacs.html][Noel Welsh: Doom Emacs Workflows]]
- [ ] [[https://github.com/grettke/help/blob/master/Org-Mode_Fundamentals.org][help/Org-Mode_Fundamentals.org at master Â· grettke/help]]
- [ ] [[https://develop.spacemacs.org/layers/+emacs/org/README.html][Org layer]]
- [ ] ç¼–ç å‚è€ƒ: [[https://github.com/bbatsov/emacs-lisp-style-guide][bbatsov/emacs-lisp-style-guide: A community-driven Emacs Lisp style guide]]
- [X] [[https://github.com/cnsunyour/.doom.d][cnsunyour/.doom.d: doom-emacs private configuration]]
- [X] [[https://github.com/redguardtoo/emacs.d][redguardtoo/emacs.d: Fast and robust Emacs setup.]] [[file:redguardtoo-emacs.d][read codes]]

* Memo [60/71]
** DONE [2021-10-21 Thu] å®ç° org-noter æœ€åŸºæœ¬çš„åŠŸèƒ½, æ–¹ä¾¿ pdf æ‰¹æ³¨.
- State "DONE"       from "TODO"       [2021-10-22 Fri 17:18]
- [X] å¯è‡ªåŠ¨ç”Ÿæˆ annotation.note æ–‡ä»¶
- [X] å¯æ’å…¥æŒ‡å‘ pdf æŸé¡µçš„ headline
- [X] å¯ç”± headline ä½¿ç”¨å¤–éƒ¨çš„ pdf é˜…è¯»å™¨æ¥æ‰“å¼€æŒ‡å®šæ–‡ä»¶åŠé¡µé¢

** DONE [2021-10-17 Sun] å°è¯• eaf ä¸­çš„ pdf-viewer
- Note taken on [2021-10-20 Wed 18:59] \\
  æŒºå¥½çš„, ä¸»è¦æ˜¯ eaf-pdf-viewer å¥½ç”¨. ä¸è¿‡æš‚æ—¶å¯ä»¥ä¸ç”¨.
- State "DONE"       from "TODO"       [2021-10-20 Wed 18:59]
åŸºäº mupdf, æ¯” pdf-tools å¿«å¤šäº†. æ”¯æŒæ–‡æœ¬é«˜äº®, æ”¯æŒä¸ org äº’åŠ¨, è¿™æ ·ä¸ org-noter
é…åˆå°±æ²¡ä»€ä¹ˆé—®é¢˜äº†.

[2021-10-19 Tue] æ„Ÿè§‰å®‰è£…æŒºå®¹æ˜“çš„, ä¾èµ–å¸¦æ¥çš„éº»çƒ¦ä¸å¤§. æŒºå€¼å¾—ä¸€ç”¨. ä¸è¿‡é™¤äº† pdf å¤–, è¿˜æ²¡ä»€ä¹ˆæ€æ‰‹çº§çš„åº”ç”¨.

: okular foo.pdf -p 5
: evince foo.pdf -p 5
: llpp foo.pdf -page 5

** DONE [2021-10-16 Sat] å¦‚ä½•é‡æ–°æ‰“å¼€å…³é—­çš„buffer?
- State "DONE"       from "TODO"       [2021-10-17 Sun 07:04]
- [[https://github.com/mrkkrp/kill-or-bury-alive][mrkkrp/kill-or-bury-alive: Precise control over buffer killing in Emacs]]
- [[https://stackoverflow.com/questions/10394213/emacs-reopen-previous-killed-buffer][Emacs reopen previous killed bufferï¼Ÿ - Stack Overflow]]

** DONE [2021-10-15 Fri] å®ç°å½“å‰ç›®å½•ä¸‹æœç´¢æ–‡ä»¶ååŠŸèƒ½

- State "DONE"       from "TODO"       [2021-10-17 Sun 07:03]
** TODO [2021-10-13 Wed] æ‰¾æ—¶é—´é€ƒç¦»doom-emacs, è‡ªå·±æ­ä¸€ä¸ª?
doom-emacsé—®é¢˜
- ä¾èµ–äºstraight, github, è£…åŒ…å¤ªç—›è‹¦ [2021-10-15 Fri] å¯å¯æœ‰ä»£ç†, åœ¨emacsä¸­reload (doom/reload)
- è‡ªå®šä¹‰è®¾ç½®å¤ªå¤š, éš¾ä»¥å°½å¦‚å¿ƒæ„.

å‚è€ƒ:
- [[https://github.com/seagle0128/.emacs.d][seagle0128/.emacs.d: Centaur Emacs - A Fancy and Fast Emacs Configuration]]
- [[https://www.reddit.com/r/emacs/comments/jzjtv0/doom_emacs_vs_vanilla_emacs/][Doom emacs vs vanilla emacs : emacs]]

[2021-10-14 Thu] è¯•ç”¨äº†ä¸‹Centaur, æœ‰äº›å¤±æœ›.

** DONE [2021-10-11 Mon] org-toggle-headingåä¼šè·³ä¸€ä¸‹
- State "DONE"       from "TODO"       [2021-10-15 Fri 15:57]
æ˜¯doomä¸­org moduleçš„é”…, ç¦ç”¨å°±å¯ä»¥äº†.

*** DONE toggle headlineæ—¶, åº”éšè— properties
- State "DONE"       from "TODO"       [2021-10-12 Tue 19:31]
  æ˜¯default moduleä¸­bindingsçš„åŸå› , å½»åº•å»æ‰å°±å¯ä»¥äº†.

*** TODO org-protocolè®¾ç½®æœ‰é—®é¢˜, daemonæ²¡å¼€å¯?

*** éœ€è¦å¯¼å…¥çš„é…ç½®
- RET: +org/dwim-at-point
            :n [return]   #'+org/dwim-at-point
            :n "RET"      #'+org/dwim-at-point

*** +org/open-fold

*** æˆ‘è¿˜æ˜¯ä¹ æƒ¯orgé»˜è®¤çš„è¡Œä¸º, Alt-RETæ—¶ä¸ç”¨ç®¡ä¸Šä¸‹æ–‡
;; (setq org-M-RET-may-split-line nil
;;       ;; insert new headings after current subtree rather than inside it
;;       org-insert-heading-respect-content t)

** DONE [2021-10-12 Tue] ä»¥å‰çš„ä¸€ä¸ªç—›ç‚¹: orgè·³è½¬åˆ°æŠ˜å çš„headlineæ—¶, å¦‚ä½•å±•å¼€å…‰æ ‡ä¸‹çš„å†…å®¹?
- State "DONE"       from "TODO"       [2021-10-12 Tue 20:07]
å¯ç”¨org-show-contexæ¥æ•‘æ€¥, æ¯”org-revealå‘½ä»¤å¥½ç”¨

** DONE [2021-10-11 Mon] org store linkæ—¶, å¦‚æœåœ¨bufferé¡¶éƒ¨ç”Ÿæˆçš„é“¾æ¥æ— æ•ˆ
- State "DONE"       from "TODO"       [2021-10-13 Wed 16:47]
æ ¹æ®doc, å¯ä»¥ç”¨C-uæ¥è°ƒç”¨.

#+begin_src text
For some link types, a C-u prefix ARG is interpreted.  A single
C-u negates org-context-in-file-links for file links or
org-gnus-prefer-web-links for links to Usenet articles.
#+end_src


** DONE [2021-10-10 Sun] [[https://emacs-china.org/t/package-symbol-overlay-symbol/7706][[æ¨é”€package] symbol-overlayï¼ŒåŒæ—¶é«˜äº®å¤šä¸ªsymbol - Emacs-general - Emacs China]]

- State "DONE"       from "TODO"       [2021-10-13 Wed 16:45]
** DONE [2021-10-09 Sat] magit-statuså¯åŠ¨åéšè— untracked filesåˆ—è¡¨, æ¯æ¬¡è·³å¼€è¦æµªè´¹ä¸å°‘æ—¶é—´
- State "DONE"       from "TODO"       [2021-10-09 Sat 19:48]
[[https://emacs.stackexchange.com/questions/27271/how-do-i-toggle-magit-enumerating-untracked-files][How do I toggle Magit enumerating untracked files? - Emacs Stack Exchange]]

magit-section-initial-visibility-alist

** DONE [2021-10-09 Sat] ä½¿ç”¨rimeåšä¸ºé»˜è®¤çš„è¾“å…¥æ³•
- State "DONE"       from "TODO"       [2021-10-09 Sat 19:31]

- [[https://sunyour.org/post/emacs-%E5%86%85%E7%BD%AE%E8%BE%93%E5%85%A5%E6%B3%95%E6%AD%A3%E5%BC%8F%E6%94%B9%E7%94%A8-emacs-rime/][æˆ‘çš„ emacs å†…ç½®è¾“å…¥æ³•æ­£å¼æ”¹ç”¨ emacs-rime - å‡¡Â·è®° - å¢©å¢©å®¶çš„å¹¸ç¦ç”Ÿæ´»]]
- [[https://manateelazycat.github.io/emacs/2020/03/22/emacs-rime.html][æŠ˜è…¾emacs-rime]]
- [[https://blindwith.science/2020/12/460.html/][ä» pyim æ¢åˆ° emacs-rime äº† - Blind with Science]]
- [[https://sunyour.org/post/%E7%BB%99-emacs-rime-%E5%A2%9E%E5%8A%A0%E7%B1%BB%E4%BC%BC-pyim-%E7%9A%84%E8%BD%AC%E6%8D%A2%E5%BD%93%E5%89%8D%E8%8B%B1%E6%96%87%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%BA%E4%B8%AD%E6%96%87%E7%9A%84%E5%8A%9F%E8%83%BD/][ç»™ emacs-rime å¢åŠ ç±»ä¼¼ pyim çš„è½¬æ¢å½“å‰è‹±æ–‡å­—ç¬¦ä¸²ä¸ºä¸­æ–‡çš„åŠŸèƒ½ - å‡¡Â·è®° - å¢©å¢©å®¶çš„å¹¸ç¦ç”Ÿæ´»]]
- [[https://wiki.archlinux.org/title/Rime][Rime - ArchWiki]]
- [[https://github.com/LEOYoon-Tsaw/Rime_collections/blob/master/Rime_description.md][Rime_collections/Rime_description.md at master Â· LEOYoon-Tsaw/Rime_collections]]

ä¼˜ç‚¹:
- ç›¸æ¯”äºfcitx tableä¸å†æœ‰æ‰å­—çš„é—®é¢˜.
- å¯ä»¥é…åˆemacs-rimeè¿™ä¸ªåŒ…æ¥ç²¾ç»†è°ƒæ•´, å®ç°æ›´ä½³çš„è¾“å…¥ä½“éªŒ.

æ€è·¯
- emacså¯åŠ¨æ—¶, ç¦ç”¨æ‰fcitxç›¸å…³çš„å˜é‡, è¿™æ ·å¯å®ç°ctrl-spaceè‡ªåŠ¨è°ƒç”¨emacs-rime. ä¸
  æ¡Œé¢å…¶å®ƒä¹ æƒ¯ä¿æŒä¸€è‡´.
- å‰¯ä½œç”¨: åœ¨emacsä¸­è°ƒç”¨çš„ç¨‹åºå¯èƒ½æ— æ³•æ­£å¸¸ä½¿ç”¨fcitxæ¥è¾“å…¥ä¸­æ–‡.

rimeçš„å®‰è£…
: sudo pacman -S fcitx-rime5 librime
: pac -S manjaro-asian-input-support-fcitx5

rimeæ•°æ®åœ¨ ~/.local/share/fcitx5/rimeä¸‹.
: ~/.local/share/fcitx5/rime/default.custom.yaml

äº”ç¬”98ç è¡¨è®¾ç½®æ–‡ä»¶:
- [[https://github.com/yanhuacuo/98wubi-tables][yanhuacuo/98wubi-tables: 98äº”ç¬”åŸºç¡€ç è¡¨]]
- [[https://github.com/thep0y/rime-98][thep0y/rime-98]]

åœ¨fcitx-rimeä¸­åˆ‡æ¢ä¸­è‹±æ–‡æŒºéº»çƒ¦çš„, å¯åœ¨rimeä¸­ç¦ç”¨è‹±æ–‡(ascii_composerå¾—ä¿ç•™, ä¸ç„¶
æ— æ³•åœ¨emacsä¸­åˆ‡æ¢ä¸´æ—¶è‹±æ–‡):
- [[https://github.com/rime/squirrel/issues/221][å¦‚ä½•åˆ é™¤ é¼ é¡»ç®¡ çš„è‹±æ–‡æ¨¡å¼ï¼Ÿ #221]]

** DONE [2021-10-08 Fri] è§£å†³matebookæ‰“å¼€urlæ…¢çš„é—®é¢˜
- State "DONE"       from "TODO"       [2021-10-08 Fri 19:45]
browse-urlå‡½æ•°æ…¢
browse-url-xdg-open

åœ¨emacsä¸­è¿è¡Œå¦‚ä¸‹shellå‘½ä»¤åå‘ç°é—®é¢˜æ‰€åœ¨:
#+begin_src shell :tangle no
#! /usr/bin/env bash

strace -f -s 1000 -tt xdg-open http://www.baidu.com &>/tmp/a.log
#+end_src

#+begin_src text
[pid 15914] 19:23:16.378907 futex(0x7f4f40246ac8, FUTEX_WAKE_PRIVATE, 2147483647) = 0
[pid 15914] 19:23:16.378935 openat(AT_FDCWD, "/run/systemd/machines/tower7820", O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)
[pid 15914] 19:23:16.378973 rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0
#+end_src

åŸæ¥ç¯å¢ƒå˜é‡çš„é—®é¢˜:
: ~/.emacs.d> rg --no-ignore --hidden tower7820
: .local/env
: 82: "SESSION_MANAGER=local/tower7820:@/tmp/.ICE-unix/3651,unix/tower7820:/tmp/.ICE-unix/3651"

åˆ é™¤ ~/.emacs.d/local/env æ–‡ä»¶, é‡å¯åé—®é¢˜è§£å†³.

** TODO [2021-10-08 Fri] è§£å†³window layoutä¿å­˜é—®é¢˜
- [[https://www.reddit.com/r/emacs/comments/q5l4mv/do_you_use_ivypushpopview/][(2) Do you use ivy-push/pop-view? : emacs]]
- [[https://stackoverflow.com/questions/2572950/preserve-window-layout-in-emacs][Preserve window layout in Emacs - Stack Overflow]]
- [[https://github.com/alphapapa/burly.el][alphapapa/burly.el: Save and restore frames and windows with their buffers in Emacs]]

** DONE [2021-10-07 Thu] è§£å†³rustç¼–ç¨‹ä¸­åœ¨commentç¯å¢ƒä¸­å¼€æ–°è¡Œçš„é—®é¢˜
- State "DONE"       from "TODO"       [2021-10-08 Fri 10:58]
é»˜è®¤çš„å®¹æ˜“ä¸orgä¸­çš„å†²çª.

ç”¨ctrl-jä»£æ›¿

** DONE [2021-08-26 Thu] dolphinåœ¨emacsä¸­æ— æ³•æ­£å¸¸æ‰“å¼€
- State "DONE"       from "TODO"       [2021-10-08 Fri 19:46] \\
  æ˜¯~/.emacs.d/local/envæ–‡ä»¶æƒ¹çš„ç¥¸

** DONE [2021-10-07 Thu] ä¿®å¤evilnc-comment-or-uncomment-linesåœ¨org src blocksé‡Œä¹±è·³çš„é—®é¢˜
- State "DONE"       from "TODO"       [2021-10-08 Fri 18:40]
åº”å…ˆè¿›å…¥org-src-editæ¨¡å¼åå†å¤„ç†

** DONE [2021-10-06 Wed] ä¼˜åŒ–æŒ‰é”®å¸ƒå±€
- State "DONE"       from "TODO"       [2021-10-20 Wed 19:01]
å¯ä»¥è€ƒè™‘å»æ‰qå‘½ä»¤, å¾ˆå°‘ç”¨, è¿˜ç»å¸¸é”™æŒ‰. å¯ä»¥ç”¨evil-forward-*ä¹‹ç±»çš„ä»£æ›¿?
evil-forward-paragraph

** DONE [2021-10-06 Wed] Rustç¼–è¾‘ä¼˜åŒ–
- State "DONE"       from "TODO"       [2021-10-07 Thu 09:22]
å‚è€ƒrust-modeä¸­dbg!è®¾ç½®, å®ç°:
: Option<Molecule> => Molecule
: Molecule => Result<Molecule>
: Molecule => Option<Molecule>

** TODO [2021-10-04 Mon] ä¹Ÿè®¸è¿™ä¸ªå¯ç”¨äºç¼–è¾‘rustdoc? [[https://github.com/twlz0ne/separedit.el#edit-heredoc][twlz0ne/separedit.el: Edit comment or string/docstring or code block inside them in separate buffer with your favorite mode]]
- [[https://emacs-china.org/t/separedit-el-docstring/11196][separedit.el: åœ¨å•ç‹¬çš„ç¼“å†²åŒºç¼–è¾‘æ³¨é‡Šã€docstring æˆ–å…¶ä¸­çš„ä»£ç å—]]
- [[https://github.com/phillord/lentic][phillord/lentic: Create views of the same content in two Emacs buffers]]

** DONE [2021-10-06 Wed] ä¿®å¤refileé—®é¢˜
- State "DONE"       from "TODO"       [2021-10-10 Sun 07:27]
å¦‚æœæœ‰å¤šä¸ªMemo headline, ä¼šé€‰æ‹©æœ€ä½çš„é‚£ä¸ª

** TODO [2021-10-06 Wed] é¼“æ£ä¸€ä¸‹ [[https://github.com/stardiviner/goldendict.el][stardiviner/goldendict.el]]
- [[https://emacs-china.org/t/topic/18006][ä¸€ä¸ªæ”¯æŒå¤šè¯å…¸çš„ç¿»è¯‘æ’ä»¶(ç›®å‰ä»…æ”¯æŒå•è¯)]]

goldendictå°±æ˜¯å‘½ä»¤è°ƒç”¨, éå¸¸ç®€å•

** TODO [2021-10-05 Tue] å‡ ä¸ªæœ‰ç”¨çš„hydraå‘½ä»¤
hydra-apropos/body, æ¯”å¦‚æŒ‰valueæœç´¢variable
+hydra/text-zoom/body
+hydra/window-nav/body

SPC-i-?: æŸ¥çœ‹ä»¥SPC-iå¼€å¤´çš„å‘½ä»¤

** DONE [2021-10-01 Fri] å¦‚ä½•é€‰æ‹©ä¸­è‹±æ–‡æ··å½•æ–‡å­—ä¸­çš„ä¸­æ–‡æˆ–è‹±æ–‡å‘¢?
- State "DONE"       from "TODO"       [2021-10-02 Sat 11:56]
** TODO [2021-09-30 Thu] orgæ’å…¥screenshotæ—¶ä¼šè®¿é—®wikipedia
å¯èƒ½æ˜¯doomæŸç§è‡ªå®šä¹‰è¡Œä¸º?

** DONE [2021-09-28 Tue] åˆ‡æ¢ç¦ç”¨é¼ æ ‡æ¨¡å¼
- State "DONE"       from "TODO"       [2021-09-28 Tue 20:38]
ç¬”è®°æœ¬è¾“å…¥æ—¶å®¹æ˜“è¯¯ç¢°è§¦æ§æ¿, ç¦ç”¨é¼ æ ‡å¯é¿å…è¿™ä¸€é—®é¢˜.

- [[https://stackoverflow.com/questions/4906534/disable-mouse-clicks-in-emacs/4906698#4906698][Disable mouse clicks in Emacs - Stack Overflow]]
- [[https://endlessparentheses.com/disable-mouse-only-inside-emacs.html][Disable Mouse only inside Emacs Â· Endless Parentheses]]

** DONE [2021-09-25 Sat] ç ”ç©¶ä¸‹æ–‡æœ¬é€‰æ‹©åŠŸèƒ½, æ¯”å¦‚expand-regionç­‰
- State "DONE"       from "TODO"       [2021-09-29 Wed 19:16]


** DONE [2021-09-24 Fri] ä½¿ç”¨hydraæ”¹è¿›çª—å£å¤§å°è°ƒæ•´æŒ‰é”®
space-d-w

- State "DONE"       from "TODO"       [2021-09-29 Wed 15:21]
** DONE [2021-09-24 Fri] clipboardå‡ºé—®é¢˜äº†?
- State "DONE"       from "TODO"       [2021-09-29 Wed 20:28]
org-captureä¸­ç”¨çš„æ˜¯ primary clipboardä¸­çš„å†…å®¹

ä¹Ÿè®¸å’Œorgçš„autoloadåŠ è½½æ¬¡åºæœ‰å…³? ([2021-09-29 Wed] æ— å…³)

æ ¹æ® [[https://github.com/emacsmirror/org/blob/d70f2806788dce06871287ef02c88ee08076dffc/lisp/org-capture.el#L1579][è¿™é‡Œ]], orgé»˜è®¤ä»primary clipboardä¸­å–å†…å®¹.

** DONE [2021-09-18 Sat] ç ”ç©¶ä¸‹è‡ªåŠ¨è¡¥å…¨ç³»ç»Ÿ
- State "DONE"       from "TODO"       [2021-09-24 Fri 14:20]
dabbrev-expand
hippie-expand

hippie-expandé»˜è®¤ä¼šä½¿ç”¨dabbrev-expandçš„è¡¥å…¨é¡¹, å› æ­¤å¯æ›¿ä»£ä¹‹(éœ€è¦è®¾ç½®hippie-expand-dabbrev-skip-space):
: (global-set-key "\M-/" 'hippie-expand)

redgaurdtoo: "ä»£ç è‡ªåŠ¨å®Œæˆå’Œä»£ç è‡ªåŠ¨å¯¼èˆªæˆ‘æ¨èåŸºäºctagsçš„æ–¹æ¡ˆï¼Œç¼ºç‚¹å½“ç„¶æ˜¯æ™ºèƒ½ç¨‹åº¦ä¸é«˜ã€‚ä½†æ˜¯é€Ÿ
åº¦å¿«ï¼Œæ”¯æŒæ­£åˆ™è¡¨è¾¾å¼å®šåˆ¶ï¼Œé€šåƒæ‰€æœ‰è¯­è¨€ã€‚åœ¨æˆ‘çœ¼é‡Œä¼˜ç‚¹è¿œè¿œå‹å€’äº†ç¼ºç‚¹ã€‚"

[2021-09-30 Thu] æ–°å‘ç°çš„ä¸€ä¸ª, å¯è·³è½¬è‡³å®šä¹‰, å¾ˆä¸é”™
- [[https://emacs-china.org/t/citre-ctags/17604][Citre: å…ˆè¿›çš„ Ctags å‰ç«¯ - Emacs-general - Emacs China]]

[2021-09-24 Fri] è¯•äº†ä¸‹, æœ‰éš¾åº¦, æ²¡ç”¨èµ·æ¥.
- [[https://github.com/redguardtoo/company-ctags][Fastest auto-completion using Company and Ctags]]


** DONE [2021-09-16 Thu] æœ€è¿‘å…³äºç¬”è®°ç®¡ç†çš„å¥½æ–‡ [[https://index.pmthinking.com/3a8c5d77b5be42c58719d174bfbfa935][ä½•è°“æ¸è¿›å¼æ€»ç»“]]          :ATTACH:
:PROPERTIES:
:ID:       71394edd-0d8b-4d34-b49e-e0c7e8ade4c1
:END:
- State "DONE"       from "TODO"       [2021-10-02 Sat 21:34]
- é€‚å½“çš„å‹ç¼©ä¿¡æ¯ï¼ˆè¿™ä¸ªç³»åˆ—ä¾¿æ˜¯å¦‚æ­¤ï¼‰èƒ½æ›´åˆ©äºæˆ‘ä»¬è®°å¿†
- çŸ¥è¯†çš„æŒ‘æˆ˜ä¸åœ¨äºè·å–çŸ¥è¯†, è€Œåœ¨äºå°†éƒ¨åˆ†çŸ¥è¯†è·¨æ—¶è·ä¼ é€’(åœ¨éœ€è¦çš„æ—¶å€™)
- ç¬”è®°ç³»ç»Ÿè¦å¹³è¡¡å¯å‘ç°æ€§å’Œå¯ç†è§£æ€§

æ¸è¿›å¼æ€»ç»“
- ä¸æ–­åœ°æ€»ç»“ï¼ŒæŠŠæ€è·¯æç‚¼æˆè¶Šæ¥è¶Šå°çš„å±‚æ¬¡ã€‚
- æœ‰äº†è¿™äº›å±‚å±‚æš´éœ²ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»é«˜ç©ºé¸Ÿç°ç¬”è®°çš„å±±å³°ï¼Œåˆ¤æ–­è¿™åº§å±±å³°æ˜¯å¦ä¸æˆ‘ä»¬è¦æ‰¾çš„ä¸œè¥¿æœ‰å…³ã€‚
- ä½†æˆ‘ä»¬ä¹Ÿä¿ç•™äº†æ‰€æœ‰çš„å±‚çº§ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬çœ‹åˆ°ä¸€ä¸ªçœ‹èµ·æ¥å¾ˆæœ‰å‰æ™¯çš„å±±å³°ï¼Œå°±å¯ä»¥ç”¨æˆ‘
  ä»¬çš„ "ç†è§£çš„é™è½ä¼ "ç›´æ¥æ½œå…¥å…¶ä¸­ï¼Œå¾€ä¸‹é’»ï¼Œåªè¦æˆ‘ä»¬éœ€è¦çš„æ·±åº¦ã€‚

æ¸è¿›å¼æ€»ç»“å°†ä¸›æ—å˜æˆäº†ä¸€ä¸ªç¾¤å²›å¼çš„å²›å±¿ã€‚å®ƒæ­ç¤ºäº†ä½ çš„ä¸ªäººä¿¡æ¯åœ°è²Œ â€”â€” ä½ çš„ç›®æ ‡ã€ä»·
å€¼è§‚ã€å…´è¶£å’Œè¿½æ±‚çš„ç‹¬ç‰¹åœ°å½¢ã€‚æœ‰äº†æ¸…æ™°çš„åœ°å½¢å›¾ï¼Œä½ å°±æœ‰äº†å¼•å¯¼çš„èƒ½åŠ›ã€‚

- å¿«é€Ÿç´¢å¼•çŸ¥è¯†ï¼Œå¹¶å°†å…¶å‹ç¼©æˆè®¸å¤šçŸ¥è¯†å—;
- è¿…é€Ÿå¿˜æ‰æ‰€å­¦çš„ä¸œè¥¿, æ”¾å…¥ç¬”è®°ç³»ç»Ÿ(ç¬¬äºŒå¤§è„‘), å°†å¤§è„‘æ”¾ç©º;
- ç›®æ ‡: ä¿æŒæ¸…æ™°çš„å¤§è„‘ï¼Œåˆèƒ½å»ºç«‹èµ·æŒä¹…çš„ç»“æ„.

è®°å¿†çš„å…³é”®:
- ä¸æ˜¯è¦æŠŠæ¯ä¸€ä¸ªæƒ³æ³•å°½æ— é—åœ°ç½—åˆ—å‡ºæ¥
- è€Œæ˜¯è¦åˆ›é€ ä¸€ä¸ªä¸°å¯Œçš„è§¦å‘å™¨ã€æç¤ºå’Œé’©å­çš„ç¯å¢ƒ, ä»¥å¼•å‘è®°å¿†ã€è”ç³»ï¼Œç”šè‡³æ˜¯æ›´å¤šçš„æ–°
  æƒ³æ³•
- æ‹¥æœ‰æ­£ç¡®çš„çŸ¥è¯†ä¸æ˜¯æœ€å¤§çš„æŒ‘æˆ˜, å¯»æ‰¾çŸ¥è¯†æ‰æ˜¯æœ€å¤§çš„æŒ‘æˆ˜. çŸ¥è¯†æ˜¯å­˜åœ¨çš„ï¼Œåªæ˜¯æˆ‘ä»¬æ‰¾
  ä¸åˆ°è€Œå·².
- è®©æˆ‘ä»¬ä»ã€Œè®°è¯¦ç»†çš„ç¬”è®°ã€è½¬åŒ–ä¸ºã€Œè®°å½•ç¬”è®°çš„å…³é”®è¯ã€æ ¸å¿ƒæ€æƒ³å’Œå…¶ä»–å…ƒæ•°æ®ä¸Šã€

#+name: fig:da08e510
#+attr_org: :width 800
#+attr_odt: :width 10
[[attachment:2021-09-16_09-57-42_screenshot.png]]

#+name: fig:9b50705a
#+attr_org: :width 800
#+attr_odt: :width 10
[[attachment:2021-09-16_09-57-54_screenshot.png]]

** DONE [2021-09-09 Thu] å‡ ä¸ªæŒ‰é”®é—®é¢˜
- State "DONE"       from "TODO"       [2021-09-29 Wed 20:30]
- State "DONE"       from "TODO"       [2021-09-09 Thu 19:23]

space-j, mini-buffer: ctrl-k

Ctrl-z suspend-frame

evil-emacs-state, evil-exit-emacs-state

** DONE [2021-09-03 Fri] ä½¿ç”¨magit transientæ¥è°ƒç”¨å‘½ä»¤è¡Œç¨‹åº?
- State "DONE"       from "TODO"       [2021-09-05 Sun 18:00]
å¦‚ä½•å¯é¿å…ä½¿ç”¨emacs-module, æ”¹è¿›å®¹é”™.

- [[https://magit.vc/manual/transient/][Transient User and Developer Manual]]
- [[https://www.reddit.com/r/emacs/comments/f3o0v8/anyone_have_good_examples_for_transient/][Anyone have good examples for Transient? : emacs]]
- [[https://github.com/sheijk/org-menu/blob/main/org-menu.el][org-menu.el]]

#+begin_src elisp
(defun test-function (&optional args)
  (interactive
   (list (transient-args 'test-transient)))
  (message "args %s" args))

(transient-define-infix test-transient:--message ()
  :description "Message"
  :class 'transient-option
  :shortarg "-m"
  :argument "--message=")

(transient-define-prefix test-transient ()
  "Test Transient Title"
  ["Arguments"
   ("-s" "Switch" "--switch")
   ("-a" "Another switch" "--another")
   ("-d" "Another switch" "4")
   (test-transient:--message)]
  ["Actions"
   ("d" "Action d" test-function)])

(test-transient)
#+end_src

*** DONE [2021-09-28 Tue] æ”¹è¿›cargoå‡ ä¸ªå‘½ä»¤ç»„æŒ‰é”®
- State "DONE"       from "TODO"       [2021-09-29 Wed 16:03]
transientå¯ä»¥æ ¹æ®å½“å‰çš„modeæ¥æ˜¾ç¤ºç‰¹å®šçš„å‘½ä»¤, æ¯”å¦‚tangleä»…åœ¨org-modeé‡Œæ˜¾ç¤º


** DONE [2021-08-25 Wed] æ”¹è¿›å­—ä½“è®¾ç½®                                   :ATTACH:
:PROPERTIES:
:ID:       aacae034-53c7-4ae8-a8b3-266aaa765e84
:END:
- State "DONE"       from "TODO"       [2021-08-25 Wed 09:20]

[2021-10-05 Tue] ç°çš„å­—ä½“æ˜¾ç¤º"è¯­è¨€", å…¶ä¸­çš„è¨€å­—å¾ˆæ€ª.

#+name: fig:4e8b267b
#+attr_org: :width 800
#+attr_odt: :width 10
[[attachment:2021-09-12_16-13-53_screenshot.png]]

nerd-fontsæ˜¯åŠ äº†å„ç§å›¾å½¢åŒ–å­—ä½“è¡¥ä¸çš„å­—ä½“, æ¯”å¦‚nered-fonts-ubuntu-mono

Sarasaç±»å­—ä½“, ç­‰å®½ç­‰é«˜, å¯ä»¥è§£å†³ä¸­è‹±æ–‡æ··æ’çš„é—®é¢˜. ä¸éœ€è¦ä¸ºorg-tableå•ç‹¬è®¾å­—ä½“äº†.

å­—å½¢ï¼š
CL: Classical orthography
SC: Simplified Chinese
TC: Traditional Chinese
HC: Hong Kong Chinese
J : Japanese
K : Korean

å¯¹é½æµ‹è¯•
| WenQuanYi Zenhei Mono (æ–‡æ³‰é©¿ç­‰å®½æ­£é»‘) | ä¸­è‹±æ–‡ï¼ŒåŠå®½ï¼Œç­‰é«˜                                                                                  |
| Inconsolata                            | è‹±æ–‡ï¼ŒåŠå®½                                                                                          |
| Ubuntu Mono                            | è‹±æ–‡ï¼ŒåŠå®½                                                                                          |
|----------------------------------------+-----------------------------------------------------------------------------------------------------|
| 4VH9GANA => 2009                       | Do Quantum Mechanical Energies Calculated for Small Models of Protein-Active Sites Converge?â€        |
| FIIAZG4V => 2010                       | P450 Enzymes: Their Structure, Reactivity, and Selectivityâ€”Modeled by QM/MM Calculations            |
| JVGGKSCS => 2008                       | A theoretical investigation into the thiophene-cracking mechanism over pure BrÃ¸nsted acidic zeolite |
| ğŸ•™ 16:22:34 â¯                          | test                                                                                                |

å‚è€ƒ
- [[https://manateelazycat.github.io/emacs/2020/04/02/org-font.html][Org-Mode è¡¨æ ¼å¯¹é½è®¾ç½®]]

** TODO [2021-08-20 Fri] å®ç°zoteroç®¡ç†ç•Œé¢
- [[https://github.com/chenyanming/calibredb.el/blob/master/calibredb-ivy.el][calibredb.el/calibredb-ivy.el at master Â· chenyanming/calibredb.el Â· GitHub]]
- [[https://oremacs.com/swiper/#actions][Ivy User Manual]]
- [[id:f9dbae5c-d135-47fd-be30-e788fc1e3eb7][ivy æ–°æ‰‹æ•™ç¨‹ - Emacs-general - Emacs China]]
- [[id:dba75f6c-108f-4e84-a0ae-589065f572f6][JSON-RPC :: Better BibTeX for Zotero]]
- [[https://github.com/tmalsburg/helm-bibtex/blob/master/ivy-bibtex.el][helm-bibtex/ivy-bibtex.el at master Â· tmalsburg/helm-bibtex]]

ä¸å¤ªæ»¡æ„, æœ‰å¾…æ”¹è¿›:
- [ ] æœç´¢æ—¶, keywordä¸ºç©ºæ—¶å“åº”éå¸¸æ…¢.
- [ ] å¤šç§æ¡ä»¶ä»»æ„æœç´¢
- [ ] æ— æ³•å…ˆè¿‡æ»¤, ç„¶åå†æœç´¢(åƒzoteroä¸­, å…ˆæŒ‰tagsæˆ–collectionè¿‡è™‘è¿‡å†æœç´¢).
  ivy-bibtexå¯ä»¥é€‰æ‹©å¤šä¸ªitem, å†æ‰§è¡Œç»Ÿä¸€çš„æ“ä½œ. å¯ä»¥ç ”ç©¶ä¸‹. [[https://github.com/tmalsburg/helm-bibtex#apply-actions-to-multiple-entries][Apply actions to multiple entries]]
- [X] ä¸­è‹±æ–‡æ··æ’ä¸å¯¹é½

*** Memo
[2021-09-12 Sun] æ”¹è¿›æ–‡æœ¬å¯¹é½
#+begin_src elisp :tangle no
(require 'ivy-bibtex)
(setq candidate '("2008 è¢äºšæ¹˜ éçº¿æ€§ä¼˜åŒ–è®¡ç®—æ–¹æ³• book è¢äºšæ¹˜2008  "
 ("year" . "2008")
 ("author" . "è¢äºšæ¹˜")
 ("title" . "{éçº¿æ€§ä¼˜åŒ–è®¡ç®—æ–¹æ³•}")
 ("=type=" . "book")
 ("=key=" . "è¢äºšæ¹˜2008")
))
(bibtex-completion-format-entry candidate 20)

(truncate-string-to-width "magit-diff: elisp-demos" 40 0 ?\s)
(truncate-string-to-width "magit-diff: elisp-å¥½å¥½" 40 0 ?\s)
#+end_src

[2021-08-31 Tue] å®ç°è‡ªåŠ¨ç¼–è¯‘æ¨¡å—? [[https://github.com/casouri/xeft/blob/master/xeft.el][URL]]
[2021-08-25 Wed] è¿™ä¸ªé“¾æ¥æ‰“ä¸å¼€? [[zotero://select/items/1_I9BXB5GH][@WenBin2007]] å·²ä¿®å¤
[2021-08-23 Mon] è‡ªå·±å†™äº†ä¸€ä¸ª, ç®€æ´å¤Ÿç”¨.
æµç¨‹:
: gwp/zotero-searcn
: Ctrl-o, o

** TODO [2021-08-01 Sun] è¯•ç”¨org-roam2
[2021-09-28 Tue] æ€»è§‰å¾—æ²¡å¤šå¤§çš„ç”¨å‘¢?
org-roam-serveræ”¹ä¸ºorg-roam-ui

org-roam-uiç”¨ä¸èµ·æ¥. å¼ƒ

** DONE [2021-07-18 Sun] è§£å†³doom-emacså‡çº§å¯¼è‡´çš„é—®é¢˜
- State "DONE"       from "TODO"       [2021-07-25 Sun 08:55]
åŸæ¥æ˜¯org/packages.elå‡çº§å¯¼è‡´çš„é—®é¢˜

# required dependencies
pacman -S git emacs ripgrep
# optional dependencies
pacman -S fd

~/.emacs.d/bin/doom install

** DONE [2021-02-03 Wed] è§£å†³fcitxè¾“å…¥æ±‰å­—æ‰å­—çš„é—®é¢˜
- State "DONE"       from "TODO"       [2021-10-09 Sat 09:27]
- State "DONE"       from "TODO"       [2021-02-08 Mon 14:20]
fcitxè¾“å…¥å¤ªå¿«ä¼šæ‰å­—, è¿™å¯èƒ½æ˜¯emacsè¾“å…¥æœºåˆ¶çš„ä¸€ä¸ªé—®é¢˜. ä½¿ç”¨emacså†…ç½®çš„è¾“å…¥æ³•å¯ä»¥
è¾ƒå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜.

- [[https://emacs-china.org/t/os-smart-input-source/13436/37][ä¸­è‹±æ–‡æ··æ‰“ï¼šOSè¾“å…¥æ³•ç®¡ç†åŒ… smart-input-source - Emacs-general - Emacs China]]

ç”¨fcitx rimeä¸ä¼šæ‰å­—? ä¹Ÿè®¸ç›´æ¥ç”¨fcitx5-rimeå°±å¯ä»¥äº†?

*** pyimè¾“å…¥æ³•
ç°åœ¨æœ‰çš„ç‰¹æ€§:
- ä½¿ç”¨Ctrl-\æŒ‰é”®åˆ‡æ¢pyimè¾“å…¥æ³•.
- å°½é‡å’Œfcitxè¾“å…¥ä¿æŒä¸€è‡´, é»˜è®¤ä½¿ç”¨è‹±æ–‡æ ‡ç‚¹.
- æŒ‰ä¸‹åˆ’çº¿(_)æˆ–"\"è¿›æ—¶ä¸´æ—¶è‹±æ–‡è¾“å…¥æ¨¡å¼.
- è‹±æ–‡çŠ¶æ€ä¸‹ï¼Œå…ˆå½•å…¥äº”ç¬”ç ï¼Œæ¯”å¦‚(fq), ç„¶åæŒ‰F2-SPCæŒ‰é”®è¿›å…¥ä¸­æ–‡è¾“å…¥çŠ¶æ€, å¹¶å°†å…‰æ ‡
  ä¸‹å­—ä¸²è½¬æ¢ä¸ºæ±‰å­—"æ— ".
- å¦‚æœå¿˜è®°äº”ç¬”ç ï¼Œå¯è¾“å…¥æ‹¼éŸ³ï¼ŒæŒ‰â€œ/â€é”®è¿›å…¥ä¸´æ—¶æ‹¼éŸ³è¾“å…¥æ¨¡å¼.

** [2021-01-09 Sat] è§£å†³org-modeä¸­Tabé”®ä¹±çªœçš„é—®é¢˜
: (add-hook 'org-mode-hook #'evil-normalize-keymaps)

[[https://github.com/hlissner/doom-emacs/issues/2775][TAB key is not behaving properly in org-mode when #+SETUPFILE keyword is present Â· Issue #2775 Â· hlissner/doom-emacs]]

** DONE [2021-01-09 Sat] è§£å†³join-lineå‘½ä»¤å¼‚å¸¸çš„é—®é¢˜
- State "DONE"       from "TODO"       [2021-01-09 Sat 10:33]
[[https://github.com/hlissner/doom-emacs/commit/40cf6139ed53b635fec37ce623c4b1093c78a11e][Make evil-join remove comment delimiters Â· hlissner/doom-emacs@40cf613]]

: (advice-remove #'evil-join #'+evil-join-a)

** DONE [2021-01-07 Thu] è§£å†³è‡ªåŠ¨ä¿å­˜æ—¶æ¸…ç†ç©ºæ ¼çš„é—®é¢˜
- State "DONE"       from "TODO"       [2021-01-07 Thu 16:00]

[2021-09-30 Thu] å°†è‡ªåŠ¨ä¿å­˜æ—¶é—´å»¶é•¿è‡³30ç§’.

åœ¨ç¼–è¾‘è¿‡ç¨‹ä¸­è‡ªåŠ¨ä¿å­˜åä¼šåˆ æ‰ç©ºæ ¼, åº”ç¦ç”¨è¿™ä¸€è¡Œä¸º.

[2021-09-12 Sun] ä¼¼ä¹æ”¹è¿›äº†, é‡æ–°å¯ç”¨.
- [[file:doom-emacs/docs/getting_started.org::*Using ~delete-trailing-whitespaces~ or ~whitespace-cleanup~ to manage leftover whitespace][Using ~delete-trailing-whitespaces~ or ~whitespace-cleanup~ to manage leftover whitespace]]

** DONE [2020-09-14 Mon] ç¦ç”¨which-key-mode
- State "DONE"       from "TODO"       [2020-09-14 Mon 10:39]
å“åº”éå¸¸æ…¢, ä»¥å‰åœ¨spacemacsä¸­ä¹Ÿé‡åˆ°è¿‡. ç¦ç”¨äº†ä¹‹.

** DONE [2020-07-09 Thu] è¯•ç”¨org-roam
- State "DONE"       from "TODO"       [2020-08-07 Fri 20:37]
- [[https://www.orgroam.com/manual/Getting-Started.html#Getting-Started][Getting Started (Org-roam User Manual)]]
- [[https://www.reddit.com/r/emacs/comments/hltl69/org_roam_for_academics_demo/][Org Roam for Academics Demo : emacs]]
- [[https://www.zmonster.me/2020/06/27/org-roam-introduction.html][ä½¿ç”¨ org-roam æ„å»ºè‡ªå·±çš„çŸ¥è¯†ç½‘ç»œ Â· ZMonster's Blog]]

[2021-08-01 Sun] org-captureçš„æ›´ä½³æ›¿ä»£å“
[2020-08-07 Fri] æ„Ÿè§‰ç”¨å¤„ä¸å¤§

** DONE [2020-05-27 Wed] rust-fmtå‡ºé—®é¢˜äº†
- State "DONE"       from "TODO"       [2020-06-07 Sun 10:05]
: +format/region-or-buffer
ç¦ç”¨äº†äº‹. ä¸€èˆ¬ä¹Ÿä»…ç”¨åœ¨rust-modeä¸­

å¿«æ·é”®:
: SPC-m-f, SPC-m-C-f SPC-m-=

[2020-06-14 Sun] å·²ä¿®å¤, ä½†ä¸æ­£å¸¸
- [[https://github.com/hlissner/doom-emacs/commit/991a205ebd439214f5e9f9d6bf68303f44221d48][Fix wrong-number-of-args error on +format/region-or-buffer Â· hlissner/doom-emacs@991a205]]

** DONE [2020-05-16 Sat] doomæ›´æ–°å‡ºé—®é¢˜
- State "DONE"       from "TODO"       [2020-05-27 Wed 08:49]
- https://github.com/hlissner/doom-emacs/issues/2802#issuecomment-606654151

** DONE [2020-04-27 Mon] å¥½åƒorgå“åº”æœ‰äº›æ…¢äº†
- State "DONE"       from "TODO"       [2020-05-06 Wed 14:03]
- [[https://github.com/hlissner/doom-emacs/issues/1301][Hang when scrolling with mouse Â· Issue #1301 Â· hlissner/doom-emacs]]
- [[https://github.com/hlissner/doom-emacs/issues/2217][[BUG] Slow scrolling/cursor movement on macOS with large window Â· Issue #2217 Â· hlissner/doom-emacs]]

[2020-04-28 Tue] åˆæ­¥æ€€ç–‘æ˜¯doomä¿®æ”¹orgä¸­çš„Linkæˆ–å…¶å®ƒfontifyå¯¼è‡´çš„.
[2020-04-29 Wed] ç¡®å®šmaterial themeæ˜¯æœ€å¤§çš„å…ƒå‡¶

** [2020-04-24 Fri] è§£å†³hack modulesä¸­autoloadsä»£ç æ— æ³•åŠ è½½çš„é—®é¢˜
éœ€è¦ä¿®æ”¹autoloadsä¸­é¦–è¡Œçš„è·¯å¾„, åŒæ—¶ä¸èƒ½ä½¿ç”¨è½¯é“¾æ¥
: -;;; lang/org/autoload/org-link.el -*- lexical-binding: t; -*-
: +;;; ~/.doom.d/modules/gwp/org/autoload/org-link.el -*- lexical-binding: t; -*-

** DONE [2020-03-22 Sun] workspaceä¿å­˜æ—¶ç»å¸¸å‡ºé”™çš„é—®é¢˜
- State "DONE"       from "TODO"       [2021-09-29 Wed 20:32]
[2021-09-12 Sun] æœ€è¿‘æ­£å¸¸
æ— æ³•ç¡®å®šé—®é¢˜çš„æ ¹æº, æœ‰æ—¶æˆåŠŸ, æœ‰æ—¶å¤±è´¥. æˆåŠŸæ¡ˆä¾‹:
- Cu-u SPC-l-s, å¤±è´¥åå†ç”¨SPC-l-s

** DONE [2020-03-20 Fri] orgä¸­narrowåŠŸèƒ½                                  :Idea:
- State "DONE"       from "TODO"       [2021-08-26 Thu 07:44]
orgä¸­è¿›è¡ŒLiterate porgrammingæ—¶, å¦‚æœsource blockså¤ªå¤š, ä¼šä¸¥é‡å½±å“æ€§èƒ½, è¿™æ—¶å¾ˆæœ‰
å¿…è¦é…åˆnarrowæ¥è¿›è¡Œviewæˆ–tangle.

org-tree-to-indirect-buffer æ¯” org-narrow-to-subtreeæ›´å¥½ç”¨, å‰è€…ä¸ä¼šå½±å“å…¨å±€
buffer, å¯ä»¥åŒæ—¶æµè§ˆå¤šä¸ªnarrowed subtree, äº’ä¸å½±å“.
- å¤šæ¬¡ä½¿ç”¨ org-tree-to-indirect-bufferæ—¶åˆ‡æ¢narrowå’ŒwiddençŠ¶æ€.
- ä½¿ç”¨C-uè°ƒç”¨æ—¶, å¯ä»¥åŒæ—¶å¼€å¤šä¸ªnarrow buffer.

** DONE [2020-03-13 Fri] smartparenså­¦ä¹ 
- State "DONE"       from "TODO"       [2021-10-02 Sat 21:43]
- [[https://ebzzry.io/en/emacs-pairs/][Emacs and Pairs]]
- [[https://gist.github.com/pvik/8eb5755cc34da0226e3fc23a320a3c95][A Cheatsheet for Emacs Smarparens example configuration]]

| sp-kill-sexp | åˆ é™¤å…‰æ ‡é™„è¿‘ç¬¦å·å¯¹å†…å®¹ |

** TODO [2020-03-13 Fri] vterm-toggle [[https://github.com/jixiuf/vterm-toggle][jixiuf/vterm-toggle: toggles between the vterm buffer and whatever buffer you are editing.]]
è¿™ä¸ªå¯ä»¥è‡ªå®šä¹‰çš„åœ°æ–¹æ›´å¤š.

** TODO [2020-03-01 Sun] doom evilå­¦ä¹ 
- [X] [[https://github.com/noctuid/evil-guide][noctuid/evil-guide: Draft of a guide for using emacs with evil]]
- [ ] è¿™ä¸ªå’Œregex-alignæœ‰ç‚¹åƒ https://github.com/edkolev/evil-lion
- [ ] [[https://noelwelsh.com/posts/doom-emacs/][Noel Welsh: Doom Emacs Workflows]]
- [ ] [[https://github.com/hlissner/doom-emacs/blob/develop/modules/editor/evil/README.org][doom-emacs/README.org at develop Â· hlissner/doom-emacs]]
- [ ] ä½ç½®è·³è½¬: better-jumper-jump-backward. å…ˆæŒ‰ctrl-o, è·³å›ä¹‹å‰çš„ä½ç½®, æŒ‰TABè¿”å›.
- [ ] [[https://github.com/hlissner/evil-multiedit][hlissner/evil-multiedit: Multiple cursors for evil-mode, based on iedit]]
- [ ] [[https://github.com/gabesoft/evil-mc][gabesoft/evil-mc: Multiple cursors implementation for evil-mode]]
- [ ] indent-rigidly: C-x TAB, å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å‘å·¦æˆ–å‘å³ç§»åŠ¨é€‰ä¸­æ–‡æœ¬.
- [X] expand region: å¯ä»¥ç”¨viéƒ¨åˆ†ä»£æ›¿ [[https://github.com/hlissner/doom-emacs/blob/develop/docs/faq.org#why-do-non-evil-users-get-expand-region-but-not-evil-users][URL]]
- [X] å„ç§æ³¨é‡Šç›¸å…³æ“ä½œ: [[https://github.com/redguardtoo/evil-nerd-commenter][redguardtoo/evil-nerd-commenter: Comment/uncomment lines efficiently. Like Nerd Commenter in Vim]]
- [X] gd: è·³è½¬åˆ°å‡½æ•°å®šä¹‰ä½ç½®. å¹¶ä¸æ€»æ˜¯çµå…‰.
- Ctrl-h b: æ˜¾ç¤ºæ‰€æœ‰æŒ‰é”® which-key-show-keymap Ctrl-h b m

** DONE [2020-03-06 Fri] ä½¿ç”¨ custom-set-faces!æ¥ä¿®æ”¹theme
- State "DONE"       from "TODO"       [2020-04-25 Sat 09:07]
#+begin_src elisp :tangle no
(load-theme 'material t)
;; (load-theme 'doom-one-light t)
(custom-set-faces!
  '(org-todo :foreground "yellow" :weight bold :background "#263238")
  '(org-done :foreground "yellow" :weight bold :background "#263238")
  '(org-table :foreground "#e3f2fd")
  '(org-level1 :foreground "#e3f2fd")
  '(org-headline-done :foreground "gray")
  )
#+end_src

** DONE [2020-03-01 Sun] å„ç§emacs distribution
- State "DONE"       from "TODO"       [2020-04-25 Sat 09:07]
- [[https://github.com/emacs-tw/awesome-emacs][emacs-tw/awesome-emacs: A community driven list of useful Emacs packages, libraries and others.]]

** DONE [2020-04-20 Mon] æ–°å»ºframeæ—¶æœ€å¤§åŒ–çª—å£
- State "DONE"       from "TODO"       [2020-04-25 Sat 08:53]
[[https://emacs.stackexchange.com/questions/2999/how-to-maximize-my-emacs-frame-on-start-up][How to maximize my Emacs frame on start-up? - Emacs Stack Exchange]]

: (add-to-list 'default-frame-alist '(fullscreen . maximized))

** DONE [2020-04-03 Fri] è¯•ç”¨ org-sidebar
- State "DONE"       from "TODO"       [2020-04-07 Tue 20:01]
- [[https://www.reddit.com/r/orgmode/comments/dbsngi/finally_solving_the_lack_of_a_treeview_navigation/][Finally solving the lack of a tree-view navigation window in Org : orgmode]]

ç”¨æ³•:
- æ‰“å¼€ org-sidebar-tree-mode, SPC-m-s-t
- åˆ‡æ¢narrow, SPC-m-Enter

** DONE [2020-03-24 Tue] å¯ä»¥ç”¨[[https://github.com/raxod502/el-patch][el-patch]]æ¥hackä»£ç 

- State "DONE"       from "TODO"       [2020-04-20 Mon 09:28]
https://org-roam.readthedocs.io/en/latest/ecosystem/
#+BEGIN_SRC elisp :tangle no
  (use-package deft
    ;; same as above...
    :config/el-patch
    (defun deft-parse-title (file contents)
      "Parse the given FILE and CONTENTS and determine the title.
  If `deft-use-filename-as-title' is nil, the title is taken to
  be the first non-empty line of the FILE.  Else the base name of the FILE is
  used as title."
      (el-patch-swap (if deft-use-filename-as-title
                         (deft-base-filename file)
                       (let ((begin (string-match "^.+$" contents)))
                         (if begin
                             (funcall deft-parse-title-function
                                      (substring contents begin (match-end 0))))))
                     (org-roam--get-title-or-slug file))))
#+END_SRC

** DONE [2020-02-29 Sat] æ”¹è¿›literate rustç¼–ç¨‹ä½“éªŒ
- State "DONE"       from "TODO"       [2020-03-21 Sat 20:00]
- [X] rustä¸­"{|}" ä¸­å›è½¦è¡Œä¸º. åŸæ¥æ˜¯spacemacsä¸­æœ‰ç‰¹åˆ«é…ç½®. [[https://emacs.stackexchange.com/questions/2837/automatically-formatting-brackets][stackexchange]]
- [X] Tabé”®è‡ªåŠ¨ä½¿ç”¨yaså±•å¼€ä»£ç . ç¦ç”¨init.elä¸­snippets.
- [X] è¿˜åŸåœ¨normal/insert stateä¸‹, Ctrl-kçš„è¡Œä¸º: org-kill-line
- [X] rusticæ–°åŠ çš„åŠŸèƒ½è™½å¤š, ä½†ç”¨å¤„éƒ½ä¸å¤§. è¿˜æ˜¯ç”¨rust-modeå¥½äº†.
- [X] org-edit-src-exit: ä¸èƒ½å®šä¹‰ä¸ºCtrl-C Ctrl-C, å› ä¸ºorg-srcé‡Œçš„ä¸»æ¨¡å¼å¾ˆå¤šä¼šç”¨åˆ°è¿™ä¸ªé”®.
- [X] å…¨å±€ç¦æœ‰flyspell-mode
- [X] ctrl-dåˆä¸ç®¡ç”¨äº†, alt-l
- [X] evil-org: åœ¨source codeä¸­çš„enterè¡Œä¸º. æ”¹ä¸ºè¿›å…¥ä»£ç .
- [X] magitå“åº”æ…¢
- [X] use structopt::*ä¸­, è¾“å‡º*ä¼šå‡ºç°ä¸¤ä¸ª, æŒ‰/ä¼šå‡ºç°ä¸¤ä¸ª.
- [X] visual stateä¸‹Tabé”®åº”è¯¥indentä»£ç 

** DONE [2020-02-28 Fri] å¤ªå¤šéœ€è¦ä¿®æ”¹çš„åœ°æ–¹äº†, åªèƒ½ä¸€ç‚¹ç‚¹æ”¹è¿›, æ…¢æ…¢æ­
- State "DONE"       from "TODO"       [2020-03-21 Sat 20:00]
- [X] å»æ‰diredä¸­å›¾æ ‡æ˜¾ç¤ºåŠå…¶å®ƒå¤šä½™åŠŸèƒ½, ç®€å•ç¨³å®šå°±å¥½
- [X] org-captureåŠŸèƒ½
- [X] odt exportsåŠŸèƒ½
- [X] zotero links
- [X] æ·»åŠ re-openå½“å‰æ–‡ä»¶åŠŸèƒ½? [[https://emacs.stackexchange.com/questions/3330/how-to-reopen-just-killed-buffer-like-c-s-t-in-firefox-browser][URL]]
- [X] dired-copy-filename-as-kill å¤åˆ¶æ–‡ä»¶è·¯å¾„, å¯ä»¥ spc-m y
- [X] å°†spc-o-Tæ”¹æˆå’Œspacemacsä¸€æ ·. vtermä¹Ÿå°±æ˜¯å›¾æ–¹ä¾¿, åŠŸèƒ½ä¸Šè¿˜æ˜¯ä¸å¦‚gnome-terminalä¹‹ç±»é¡ºæ‰‹.
- [X] [[https://github.com/hlissner/doom-emacs/blob/develop/modules/ui/window-select/README.org][window-select]] å¯ä»¥ç”¨C-w C-w, æ¯”spacemacsä¸‹æ›´æ–¹ä¾¿.
- [X] çœ‹æ¥è¿˜æ˜¯å¾—ç”¨evil-org. æ¯”å¦‚ddå‘½ä»¤åœ¨hideçŠ¶æ€ä¸‹åº”è¯¥ä¸º delete subtree
- [X] o: evil-org-open-below +org/insert-item-below, å¯ä»¥ç”¨ctrl-enter, ctrl-shift-enter
- [X] (spacemacs/open-file-or-directory-in-external-app ARG)
- [X] insert-modeä¸‹ Ctrl-h åº”ä¸ºhelp
- [X] insert-mode: ctrl-d evil-shift-left
- [X] SPC-c l, comment line
- [X] æ£€æŸ¥å•è¯: z=, flyspell-correct-at-point (å¯ç”¨spell moduleå³å¯)
- [X] flyspellé”™å­—æç¤º (å¯ä»¥æ‰‹åŠ¨å…³æ‰, flyspell-mode, SPC-t s)
- [X] insert-modeä¸‹ Ctrl-y é”®åº”ä¸ºç²˜è´´
- [X] org-metaright, org-demote-subtree
- [X] helm-resume => SPC r l
- [X] deadgrep notes

** DONE [2020-03-14 Sat] ä¸­æ–‡å­—ä½“è®¾ç½® [[https://emacs-china.org/t/doom-modeline-2-1-0/9251/13][URL]]
- State "DONE"       from "TODO"       [2020-03-15 Sun 09:45]
å¯ä»¥å»æ‰cnfonts, ç›´æ¥ä¸­è‹±æ–‡åˆ†å¼€è®¾ç½®, è§£å†³modelineæ˜¾ç¤ºå¼‚å¸¸çš„é—®é¢˜.

** DONE [2020-03-10 Tue] å¯ç”¨formatæ¨¡å—
- State "DONE"       from "TODO"       [2020-03-10 Tue 21:16]
- [[https://github.com/lassik/emacs-format-all-the-code][lassik/emacs-format-all-the-code]]

éœ€è¦çš„å·¥å…·:
- Shell script (shfmt)
- Python (black)
- Rust (rustfmt)

å¯¹äºå¿«æ·é”® SPC-c-f

** DONE [2020-03-05 Thu] æˆªå›¾æ–°æ–¹å¼: org-capture + org-download? :ATTACH:
:PROPERTIES:
:ID:       e0591a18-e431-46bc-a5b5-568eeee5c567
:END:
- State "DONE"       from "TODO"       [2020-03-06 Fri 14:29]
ä½¿ç”¨xclipå°†clipboardä¸­çš„imageå¦å­˜ä¸ºæ–‡ä»¶, ç„¶åå†è°ƒorg-downloadæˆªå›¾.

#+DOWNLOADED: screenshot @ 2020-03-06 16:07:53
#+caption: æˆªå›¾ç•™å¿µ
#+name: fig:feaf75a4
#+attr_org: :width 500
#+attr_odt: :width 10
[[attachment:2020-03-06_16-07-53_screenshot.png]]

- å‚è€ƒ: [[https://emacs.stackexchange.com/questions/41016/how-can-i-yank-images-from-emacs][osx - How can I yank images from Emacs? - Emacs Stack Exchange]]
- [2020-03-06 Fri] org-download-deleteæœ‰é—®é¢˜, ä¸èƒ½ç”¨äº†.
- ä½¿ç”¨ä¸‹é¢çš„è„šæœ¬, ä»X11 clipboardå¤åˆ¶æˆªå›¾, è¿™æ ·é¿å…äº†æˆªå›¾æ—¶emacsçª—å£å¦‚ä½•æœ€å°åŒ–çš„
  é—®é¢˜. [2020-03-06 Fri] ä¸å¤ªå¥½ç”¨, ç”¨rusté‡å†™äº†.
  #+begin_src shell :tangle no
  set -e
  if [ "x$1" = "x" ]; then
      echo "Usage: [options] $0 file..." >&2
      exit 1
  fi

  xclip -selection clipboard -t image/png -o > "$1"

  # remove zero sized file
  [ ! -s "$1" ] && rm "$1"
  #+end_src

** DONE [2020-03-02 Mon] å®Œæˆripgrepæœç´¢notesåŠŸèƒ½
CLOSED: [2020-03-02 Mon 14:49]
- State "DONE"       from              [2020-03-02 Mon 14:49]
éœ€è¦ä¿®æ”¹ripgrepé…ç½®, ä½¿ä¹‹èƒ½follow symlinks. [[https://github.com/BurntSushi/ripgrep/blob/master/GUIDE.md#configuration-file][ripgrep/GUIDE.md at master Â· BurntSushi/ripgrep]]

ç›¸å…³æ–‡ä»¶:
: ~/.ripgreprc
: ~/.zshrc

** DONE [2020-03-01 Sun] å…³äºispellçš„é—®é¢˜
CLOSED: [2020-03-01 Sun 19:35]
- State "DONE"       from "TODO"       [2020-03-01 Sun 19:35]
ä»¥å‰å¸¸ç”¨ ispell-word æ¥æŸ¥è¯, ç°åœ¨å‘ç°å¾—å¼€å¯ispell-modeåæ‰æ­£å¸¸, ä¸ç„¶ä¼šæŠ¥é”™.

** DONE [2020-02-28 Fri] è§£å†³org-modeä¸­æ€ªå¼‚çš„Tabé”®è¡Œä¸ºé—®é¢˜
CLOSED: [2020-02-28 Fri 15:42]
- State "DONE"       from "TODO"       [2020-02-28 Fri 15:42]
- [[https://github.com/hlissner/doom-emacs/issues/1897][[BUG] org-mode TAB key mapped to different command when emacs running as daemon Â· Issue #1897 Â· hlissner/doom-emacs]]

å»æ‰:configä¸­çš„ +bindings å¼€å…³æ­£å¸¸äº†.

** DONE [2020-02-28 Fri] å¯ç”¨çš„theme
CLOSED: [2020-02-29 Sat 18:12]
- State "DONE"       from "TODO"       [2020-02-29 Sat 18:12]
[[*theme][theme]]
: doom-acario-light
: doom-material
: doom-moonlight
: doom-nord-light x
: doom-nord
: doom-oceanic-next
: doom-one-light x
: doom-opera-light x
: doom-palenight
: doom-peacock x
: doom-snazzy
: doom-tomorrow-day x
: doom-vibrant

** DONE [2020-02-27 Thu] è§£å†³ org-mode æ’å…¥æ—¶é—´æˆ³å¿«æ·é”®è¢«å ç”¨çš„é—®é¢˜
CLOSED: [2020-02-28 Fri 15:42]
- State "DONE"       from "TODO"       [2020-02-28 Fri 15:42]
: C-c ! (org-time-stamp-inactive)

ç¦ç”¨:checkersç»„ä¸­çš„moduleså³å¯.

** DONE [2020-02-27 Thu] doomå°é²œ
- State "DONE"       from "TODO"       [2020-04-07 Tue 20:02]
doomçš„ä¼˜ç‚¹:
1. è¾ƒspacemacsè½»é‡, å¯åŠ¨å¿«, æ¶æ„ç®€å•, åç»­æ˜“ç»´æŠ¤
2. å’Œspacemacsä½¿ç”¨ç±»ä¼¼çš„key-bindings
3. ç¤¾åŒºè´¨é‡é«˜, ä½œè€…ç»´æŠ¤çƒ­æƒ…é«˜

ä¿®æ”¹é…ç½®æ—¶æ³¨æ„:
1. ä¸è¦ä½¿ç”¨emacsä¸­å†…ç½®çš„customæœºåˆ¶
2. ä¸ç”¨ä½¿ç”¨use-packageä¸­çš„åŒ…å®‰è£…æœºåˆ¶(:ensure)
3. ä¸è¦ä½¿ç”¨org-babelä¸­çš„rg-babel-do-load-languagesæœºåˆ¶

- configä¸­çš„flags: [[https://github.com/hlissner/doom-emacs/blob/develop/docs/getting_started.org#flags][doom-emacs/getting_started.org at develop Â· hlissner/doom-emacs]]
- doom api: [[https://github.com/hlissner/doom-emacs/blob/develop/docs/api.org#map][doom-emacs/api.org at develop Â· hlissner/doom-emacs]]

https://github.com/hlissner/doom-emacs/blob/develop/modules/lang/rest/README.org

https://github.com/hlissner/doom-emacs/blob/develop/modules/ui/zen/README.org

https://github.com/hlissner/doom-emacs/blob/develop/modules/ui/workspaces/README.org

https://github.com/hlissner/doom-emacs/issues/2483

doom clean && doom sync && doom build

https://github.com/emacs-tw/awesome-emacs

git clone https://code.orgmode.org/bzg/org-mode.git

doomè¦cloneå¾ˆå¤šgithubä¸Šçš„repo, å¾ˆå®¹æ˜“è¢«RESET, å¯¼è‡´å®‰è£…å¤±è´¥.

gitä½¿ç”¨v2ray proxy
https://gist.github.com/evantoli/f8c23a37eb3558ab8765

https://segmentfault.com/q/1010000000118837

** [2018-08-22 Wed] ç¦ç”¨è‡ªåŠ¨ä¸ºbabel source blockç”Ÿæˆnameçš„åŠŸèƒ½.
ç”¨å¤„ä¸å¤§.

** [2018-06-01 Fri] è§£å†³expand-regionåœ¨org-mode bufferä¸­çš„é—®é¢˜
ä½¿ç”¨æ‰©é€‰åŠŸèƒ½æ—¶, expand-regionä¼šè‡ªåŠ¨å±•å¼€æ˜¾ç¤ºä¹‹å‰éšè—outlineä¸­çš„å†…å®¹, å¯¼è‡´æ˜¾ç¤ºå†…å®¹è·³è½¬.

è§£å†³æ–¹æ¡ˆ:
- ä¿®æ”¹expand-region.el, åˆ é™¤æ‰ "(eval-after-load 'org)" ç›¸å…³å†…å®¹

** DONE [2018-01-24 Wed] ä¿®å¤org-capture, org-protocolä¸­çš„å‡ ä¸ªbug
- State "DONE"       from "TODO"       [2020-08-01 Sat 16:20] \\
  æ¢ç”¨doomåæ²¡å†å‘ç°
- [X] åœ¨org-captureä¸­, å¦‚æœabortä¼šåˆ æ‰refile.orgæœ€å¼€å¤´æ¡ç›®çš„æ˜Ÿå·.
- [X] firefoxä¸­, org-protocolåœ¨æŸäº›ç½‘é¡µä¸­æ— æ³•æ¿€æ´». æ˜¯firefoxä¸­çš„"content security policy"æ£çš„é¬¼. åœ¨configé‡Œç¦ç”¨å³å¯. "security.csp.enable"
- [X] [[https://www.reddit.com/r/firefox/comments/k64ha0/fix_allow_this_site_to_open_the_protocol_link/][Fix "Allow this site to open the PROTOCOL link with APPLICATION" warning : firefox]]

** DONE [2018-01-06 Sat] è§£å†³odtå¯¼å‡ºlatexå…¬å¼åˆ†è¾¨ç‡å¤ªä½çš„é—®é¢˜
CLOSED: [2018-01-10 Wed 16:18]
- State "DONE"       from "TODO"       [2018-01-10 Wed 16:18] \\
  odtä½¿ç”¨dvipngå¯¼å‡ºå…¬å¼æ—¶ç”Ÿæˆçš„å›¾ç‰‡åˆ†è¾¨ç‡å¤ªä½, è¿™é‡Œæ”¾å¤§3å€, ç„¶åé€šè¿‡è®¾ç½®odt dpiä¸º
  300(é»˜è®¤ä¸º96), å°†imageç¼©å°ä¸ºåŸå§‹å¤§å°.

** [2017-12-12 Tue] ä¿®æ”¹org-downloadè®¾ç½®, è°ƒæ•´odtå¯¼å‡ºå‚æ•°
è‡ªå®šä¹‰org-download-annotate-function
- è‡ªåŠ¨æ·»åŠ å›¾ç‰‡çš„ ~name~ ~caption~, æ–¹ä¾¿odtå¯¼å‡ºæ—¶å›¾ç‰‡è‡ªåŠ¨ç¼–å·åŠäº¤å‰å¼•ç”¨.
- è‡ªåŠ¨æ·»åŠ  ~#+attr_org~ å±æ€§, è®¾ç½®orgé¢„è§ˆå›¾ç‰‡çš„å¤§å°
- è‡ªåŠ¨æ·»åŠ  ~#+attr_odt~ å±æ€§, è®¾ç½®odtå¯¼å‡ºæ—¶çš„å›¾ç‰‡å¤§å°

References
- [[http://kitchingroup.cheme.cmu.edu/blog/2015/07/10/Drag-images-and-files-onto-org-mode-and-insert-a-link-to-them/][Drag images and files onto org-mode and insert a link to them]]

** [2017-11-19 Sun] æ·»åŠ æ–°åŠŸèƒ½, åœ¨bufferæˆ–diredå½“å‰ç›®å½•ä¸­æ‰“å¼€gnome-terminal
æŒ‰é”®: ~SPC o T~

** TODO [2017-11-13 Mon] å®Œå–„org-to-read å®ç°ç±»ä¼¼zotfileçš„åŠŸèƒ½
[2017-11-17 Fri] ç±»ä¼¼æ²¡å¤ªå¤§å¿…è¦. æœ‰æ›´æµç•…çš„æ–¹å¼?

- è‡ªåŠ¨å°†å½“å‰headlineä¸‹çš„é™„ä»¶æ”¾è‡³æŸä¸ªREADç›®å½•
- æ‰‹æœºä¸Šé˜…è¯»å¹¶æ³¨é‡Š, å¹¶åŒæ­¥å›ä¿®æ”¹.
- åˆ‡å›DONEçŠ¶æ€æ—¶ä»READç›®å½•é‡Œå–å›ä¿®æ”¹åçš„ç‰ˆæœ¬, å¹¶å¯¼å‡ºpdfæ³¨é‡Š.

References
- [[https://github.com/machc/pdf-tools-org][machc/pdf-tools-org: pdf-tools and org-mode integration]]
- [[http://tech.memoryimprintstudio.com/pdf-annotation-related-tools/][PDF Annotation Related Tools â€“ Emacs, Arduino, Raspberry Pi, Linux and Programming etc]]
- [[http://pragmaticemacs.com/emacs/view-and-annotate-pdfs-in-emacs-with-pdf-tools/][View and annotate PDFs in Emacs with PDF-tools | Pragmatic Emacs]]
- [[https://matt.hackinghistory.ca/2015/11/11/note-taking-with-pdf-tools/][Note Taking with PDF Tools | Thoughts on Code & History]]
- [[https://github.com/politza/pdf-tools/issues/134][extract annotations? Â· Issue #134 Â· politza/pdf-tools]]
- [[https://www.reddit.com/r/emacs/comments/4gudyw/help_me_with_my_orgmode_workflow_for_notetaking/][Help me with my org-mode workflow for note-taking? : emacs]]

** DONE [2017-11-10 Fri] è¿›ä¸€æ­¥æ”¹è¿›org-attachåŠŸèƒ½ æ–¹ä¾¿ç§»åŠ¨ä¸åŒçš„outlineåŠå…¶attachments
- State "DONE"       from "TODO"       [2021-09-03 Fri 17:47]
- State "DONE"       from "TODO"       [2017-11-10 Fri 20:37]

æ“ä½œæµç¨‹
- å­˜å‚¨å½“å‰entryçš„é™„ä»¶å†…å®¹: gwp/org-attach-copy
- å°†å½“å‰org entryæ–‡æœ¬ç§»åŠ¨åˆ°æ–°çš„æ–‡ä»¶ä¸­
- å°†ä¹‹å‰å­˜å‚¨çš„é™„ä»¶å†…å®¹å¤åˆ¶åˆ°æ–°çš„attachmentç›®å½•ä¸­æ¥: gwp/org-attach-paste. æ­¤æ—¶ä¼š
  è‡ªåŠ¨ç”Ÿæˆä¸ä¹‹å‰ç›¸åŒçš„attachç›®å½•å’Œæ–‡ä»¶.

** DONE [2017-11-10 Fri] ä¿®æ”¹tangleå‡½æ•°, èƒ½æ›´æ–¹ä¾¿çš„tangleä»£ç 
- State "DONE"       from "TODO"       [2020-04-07 Tue 20:03]
å°†gwp/org-babel-tangle-dwimç»‘å®šåˆ° ~SPC o b~
- ä½¿ç”¨ ~Ctrl-c '~ è¿›å…¥ä»£ç çª—å£
- ä¿®æ”¹ä»£ç å, æŒ‰ ~SPC o b~
- è¯¥å‡½æ•°è‡ªåŠ¨ä¿å­˜ä»£ç , å¹¶tangleå¯¹åº”æ–‡ä»¶

** DONE [2017-10-27 Fri] å®Œå–„org-protocolå’Œorg-capture             :Starred:
CLOSED: [2017-11-01 Wed 10:34]

- æ·»åŠ å°†htmlé¡µé¢ç”Ÿæˆorg-mode linkåŠŸèƒ½, é€šè¿‡clipboardæ¥ä¸emacsäº¤äº’. è§£å†³KDEä¸‹captureçª—å£å¤±ç„¦é—®é¢˜ [2021-09-09 Thu]
- è¿›ä¸€æ­¥å®Œå–„jsä»£ç 
- è¿›ä¸€æ­¥ä¼˜åŒ–bookmarklet, æ–¹ä¾¿åœ¨firefoxä¸­ä½¿ç”¨ [2018-01-24 Wed 21:02]
- State "DONE"       from "TODO"       [2017-11-01 Wed 10:34]

*** store-link
ç‰ˆæœ¬1: ä½¿ç”¨selectionæˆ–URLåšä¸ºdescription
#+BEGIN_SRC javascript
  javascript:
  var title = window.getSelection();
  if (title == '') {
      title = 'URL';
  }

  location.href = 'org-protocol:///store-link?url=' + encodeURIComponent(location.href) + '&title=' + encodeURIComponent(title);
#+END_SRC

ç‰ˆæœ¬2: ä½¿ç”¨selectionæˆ–document titleåšä¸ºdescription. å¦‚æœæ²¡æœ‰, é»˜è®¤ä¸ºURL.
#+BEGIN_SRC javascript
javascript:
var title = window.getSelection();
if (title == '') {
    title = document.title;
    if (title == '') {
        title = 'URL';
    }
}

location.href = 'org-protocol:///store-link?url=' + encodeURIComponent(location.href) + '&title=' + encodeURIComponent(title);
#+END_SRC

*** capture
ä½¿ç”¨'n'æ¨¡æ¿: æ’å…¥å½“å‰é¡µé¢çš„é“¾æ¥, ä½¿ç”¨é¡µé¢æ ‡é¢˜æˆ–URLåšä¸ºé“¾æ¥æè¿°. å¼•ç”¨é€‰ä¸­æ–‡å­—.

#+name: 12d167c2-43c7-4f54-9a27-2b55432d113d
#+BEGIN_SRC javascript
javascript:
var title = document.title;
if (title == '') {
    title = 'URL';
}

location.href = 'org-protocol:///capture?template=n' + '&url=' + encodeURIComponent(location.href) + '&title=' + encodeURIComponent(title) + "&body=" + encodeURIComponent(window.getSelection());
#+END_SRC

*** clipboard
ç”Ÿæˆorgé“¾æ¥, æ–¹ä¾¿capture. ä¸éœ€è¦èµ° org-protocol.

é“¾æ¥ç”Ÿæˆè§„åˆ™: å¦‚æœæœ‰é€‰ä¸­æ–‡å­—, åˆ™ä»¥é€‰ä¸­æ–‡å­—ä¸ºtitle, å¦åˆ™ä»¥é¡µé¢æ ‡é¢˜ä¸ºé“¾æ¥title. å¦‚
æœé¡µé¢æ ‡é¢˜ä¹Ÿä¸ºç©º, åˆ™ä»¥"URL"ä¸ºé“¾æ¥æ˜¾ç¤ºæ ‡é¢˜.

[[https://gist.github.com/stefanmaric/2abf96c740191cda3bc7a8b0fc905a7d][Create Bookmarklet (browser bookmark that executes Javsacript) to copy a given text to Clipboard]]

#+begin_src js
var title = window.getSelection();
if (title == "") {
  title = document.title;
}
if (title == "") {
  title = "URL";
}
(function (text) {
  var node = document.createElement("textarea");
  var selection = document.getSelection();

  node.textContent = text;
  document.body.appendChild(node);

  selection.removeAllRanges();
  node.select();
  document.execCommand("copy");

  selection.removeAllRanges();
  document.body.removeChild(node);
})("[[" + location.href + "]" + "[" + title + "]]");
#+end_src

javascript:void function(){var a=window.getSelection();""==a%26%26(a=document.title),""==a%26%26(a="URL"),function(a){var b=document.createElement("textarea"),c=document.getSelection();b.textContent=a,document.body.appendChild(b),c.removeAllRanges(),b.select(),document.execCommand("copy"),c.removeAllRanges(),document.body.removeChild(b)}("[["+location.href+"]["+a+"]]")}();

*** References
åŸç†: é€šè¿‡åŠ«æŒemacsclientåŠŸèƒ½, å°†org-protocol://ä¹‹ç±»çš„URLä¸org-modeå®ç°åŠŸèƒ½äº¤äº’.
- org-capture.el
- [[https://www.ruanyifeng.com/blog/2011/06/a_guide_for_writing_bookmarklet.html][Bookmarkletç¼–å†™æŒ‡å— - é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—]]
- https://github.com/alphapapa/org-protocol-capture-html
- org capture extensions: https://github.com/sprig/org-capture-extension
- [[http://orgmode.org/worg/org-contrib/org-protocol.html][org-protocol.el â€“ Intercept calls from emacsclient to trigger custom actions]] (outdated)
å·¥å…·
- ä»jsä»£ç ç”Ÿæˆurl: [[https://chriszarate.github.io/bookmarkleter/][Bookmarkleter]]
- [[http://jsbeautifier.org/][Online JavaScript beautifier]]
- [[https://mrcoles.com/bookmarklet/][Bookmarklet Creator with Script Includer - Peter Coles]]

** [2017-10-06 Fri] è§£å†³org-modeåŠ è½½å¤§æ–‡ä»¶å¤ªæ…¢çš„é—®é¢˜
- [2017-10-07 Sat] å‘ç°æ˜¯hl-todoè¿™ä¸ªåŒ…å¯¼è‡´çš„é—®é¢˜. ç¦ç”¨è¯¥åŒ…å³å¯.
- [2017-10-06 Fri] ä½¿ç”¨spacemacs-base distrubtionå³å¯.
** [2016-12-10 Sat] ç¦ç”¨é€‰ä¸­çš„æ–‡å­—è¿›å…¥clipboardçš„åŠŸèƒ½ [[https://github.com/syl20bnr/spacemacs/blob/master/doc/FAQ.org#prevent-the-visual-selection-overriding-my-system-clipboard][URL]]
: ;; Prevent the visual selection overriding my system clipboard
: (fset 'evil-visual-update-x-selection 'ignore)

** [2016-12-10 Sat] ä¿®æ”¹spacemacsä¸­é»˜è®¤çš„undoè¡Œä¸º é»˜è®¤çš„undoå¤ªå˜æ€äº†
: (setq evil-want-fine-undo t)

** [2016-10-14 Fri] emacs24-starter-kit æ›´æ–°ç»´æŠ¤ä¸æ˜¯å¾ˆæ´»è·ƒ. ç°åœ¨å·²æ˜¯ emacs25 æ—¶ä»£äº†. è€ƒè™‘æ¢åˆ° spacemacs


* Tips
~SPC h d~
** Universal arguments
SPC-u, C-u
** general: keybindings
ä¸ºå„ç§æŒ‰é”®ç”Ÿæˆä¸€ä¸ªæ¼‚äº®çš„ org æ–‡æ¡£
: general-describe-keybindings

ä½¿ç”¨ general-def æˆ– bind-key! æ¥å®šä¹‰æŒ‰é”®

** ç»Ÿè®¡å­—ç¬¦æ•°
g C-g
: count-words

** æ‹¼å†™æ£€æŸ¥
z=
: flyspell-correct-at-point

** Swiper/Ivy notes
[[https://github.com/condy0919/emacs-newbie/blob/master/introduction-to-ivy.md][ivy æ–°æ‰‹æ•™ç¨‹]]

| å‘½ä»¤                          | åŠŸèƒ½                                   | Tips                            |
|-------------------------------+----------------------------------------+---------------------------------|
| counsel-recentf               | æ‰“å¼€æœ€è¿‘æ–‡ä»¶åˆ—è¡¨                       | æŒ‰C-o,få¯å¼ºåˆ¶åœ¨æ–°çš„frameæ‰“å¼€    |
| counsel-org-goto              | è·³è½¬åˆ°org headline                     | SPC-m .                         |
| counsel-org-goto-all          | è·³è½¬åˆ°æ‰€æœ‰org buffersçš„headline        | SPC-m /                         |
| ivy-occur                     | å°†ivy candidatesç•Œé¢å˜æˆå¯äº¤äº’çš„buffer | æ”¯æŒwgrep, æ¯”å¦‚c-x-c-q          |
| counsel-org-tag               | ç”¨äºæ‰“æ ‡ç­¾. (SPC-m-q)                  | å½“ctrl-c ctrl-cä¸å¥½ç”¨æ˜¯å¯ç”¨è¿™ä¸ª |
| swiper-isearch-thing-at-point | æœç´¢å…‰æ ‡ä¸‹å†…å®¹                         | å¯é¢„å‘Šé€‰æ‹©è¦æœç´¢çš„å†…å®¹          |
| ivy-next-history-element      | åœ¨minibufferä¸­åˆ‡æ¢å†å²æœç´¢é¡¹           | M-n/M-p                         |
| swiper-avy                    | åœ¨swiperæœç´¢ç»“æœä¸­è¿›è¡Œavyè·³è½¬          | C-'æˆ–M-;                        |
| ivy-occur                     | å°†candidateså˜ä¸ºç‹¬ç«‹çš„å¯æ“ä½œçš„buffer   | C-c C-o                         |
| ivy-toggle-regexp-quote       | åœ¨minibufferä¸­åˆ‡æ¢regexpç‰¹æ®Šå­—ç¬¦è½¬ä¹‰   | M-r, æ¯”å¦‚æœç´¢"."æ—¶              |

æ›´å¤šæŒ‰é”®å¯æŸ¥çœ‹: ivy-minibuffer-map

** org-mode
| org-kill-note-or-show-branches | C-c C-k | æŸ¥çœ‹headlines, å½“å‰ä¸Šä¸‹æ–‡TABé”®æ— æ•ˆæ—¶æœ‰ç”¨ |
| org-edit-special               | C-c '   | é»˜è®¤æŒ‰é”®éš¾æŒ‰, æ”¹ä¸ºSPC-M-;                |

Movement
| Key Binding | Description                            |
|-------------+----------------------------------------|
| ~g h~       | Move up one level in headings          |
| ~g j~       | Move to next heading on same level     |
| ~g k~       | Move to previous heading on same level |
| ~g l~       | Move down one level in headings        |

refileæµç¨‹:
- æ‰“å¼€refile.note
- æ£€æŸ¥å…¶ä¸­çš„æ¡ç›®, æ‰¾åˆ°å¯èƒ½çš„åˆé€‚çš„å½’æ¡£noteæ–‡ä»¶, æ‰“å¼€ä¹‹.
- SPC-m-r-r, org-refile
- SPC-u SPC-m-r-r: è·³è½¬è‡³refile targets

** è‡ªåŠ¨è¡¥å…¨
- [[https://github.com/hlissner/doom-emacs/blob/develop/modules/completion/company/README.org][doom-emacs/README.org at develop Â· hlissner/doom-emacs]]

æŸ¥çœ‹evil-insert-state-mapä¸­çš„ç»‘å®šå¯çŸ¥:

| C-x C-f | company-files è¡¥å…¨æ–‡ä»¶å, ç±»vim   |
| C-x C-s | company-yasnippet: è¡¥å…¨ yasnippet |
| C-x C-l | +company/whole-lines è¡¥å…¨è¡Œ       |

** æŸ¥çœ‹buffer major mode
eval: major-mode

** å„ç§è·³è½¬
| g;              | goto-last-change         |
| g,              | goto-last-change-reverse |
| gi              | evil-insert-resume       |
| gv              | evil-visual-resume       |
| SPC-s-i         | imenu symbol             |
| Alt-mouse-wheel | jump backward/foraward   |
| SPC-j-m         | emacs mark ring          |

è¡Œå†…è·³è½¬
- f: å‘è¡Œå°¾æœç´¢å•å­—æ¯(evil-snipe-f)
- ?: å‘è¡Œå§‹æœç´¢å•å­—æ¯(evil-ex-search-backward)

æœç´¢è·³è½¬:
- æœç´¢å•å­—æ¯: avy-goto-char
- æœç´¢åŒå­—æ¯: avy-goto-char-2
- æœç´¢ä»»æ„å­—ç¬¦: isearch + avy-search
- swiper + ivy-avy
- åœ¨evilä¸­æŒ‰*æˆ–/é”®æœç´¢å½“å‰wordæˆ–ä»»æ„è¯, å†SPC-j-j å¯ç”¨avy jump

marking ringè·³è½¬
- ä¸åŒbuffer: SPC-`
- åŒä¸€buffer: ``
- åŒä¸€bufferæˆ–ä¸åŒbuffer, æ›´è¿œçš„ä½ç½®:
  - emacs mark ring: SPC-j-m

** evilåŠŸèƒ½
æŸ¥çœ‹evil-visual-state-mapå¸®åŠ©
*** evil-set-initial-state
è®¾ç½®ä¸åŒæ¨¡å¼å¯¹çš„åˆå§‹æŒ‰é”®æ¨¡å¼

*** å¿«é€Ÿç§»åŠ¨
è·³è½¬è‡³æŸè¡Œ(G):
: evil-goto-line

^
: evil-first-non-blank

è‡³è¡Œé¦–(0, g0)
: evil-beginning-of-line

è‡³è¡Œå°¾($)
: evil-end-of-line

å°†å…‰æ ‡ç§»åŠ¨åˆ°çª—å£åº•éƒ¨(L)
: evil-window-bottom

å°†å…‰æ ‡ç§»åŠ¨åˆ°çª—å£é¡¶éƒ¨(H)
: evil-window-top

é¦–è¡Œ(gg)
: evil-goto-first-line

å°¾è¡Œ(G)
: evil-goto-line

è·³è‡³ä¹‹å‰çš„è¡Œ('')
: evil-goto-mark-line

è·³è‡³ä¹‹å‰çš„ä½ç½®(``)
: evil-goto-mark

è‡³æˆå¯¹(%)
: evil-jump-item

g;
: goto-last-change

g,
: goto-last-change-reverse

*** æ–‡æœ¬é€‰æ‹©
é€‰ä¸­æ–‡å­—åæŒ‰S, å†æŒ‰"(" å¯åœ¨é€‰ä¸­å­—ç¬¦å‰ååŠ æ‹¬å·.

evilä¸‹æŒ‰vå†æŒ‰aæœ‰ä¸å°‘å¯¹åº”çš„åŠŸèƒ½, æ¯”å¦‚"va[" é€‰ä¸­æ–¹æ‹¬å·ä¸­çš„å†…å®¹
- va: æ¯”å¦‚é€‰æ‹©åŒ…å«æ‹¬å·çš„å†…å®¹
  - vab: é€‰æ‹©åœ†æ‹¬å·åŠå…¶å†…çš„æ–‡å­—
  - vau: é€‰æ‹©url
- vi: æ¯”å¦‚é€‰æ‹©æ‹¬å·å†…çš„å†…å®¹
  - vio: æ–‡å­—å—, ä¸å«æ‹¬å·
- vS => æ’å…¥åŒ…å›´æ“ä½œ

*** ç¼–è¾‘åŠŸèƒ½
å¤§å°å†™äº’æ¢: ~, å¤§å†™æ–‡å­—: U, å°å†™æ–‡å­—: u

*** å¤åˆ¶ç²˜è´´
- y (evil-yank): copy region
- Y (evil-yank-line): å¤åˆ¶åˆ°è¡Œå°¾

*** å¿«é€Ÿæœç´¢
/
: evil-search-forward

*
: evil-search-word-forward

?
: evil-search-backward

n/N
: evil-search-next
: evil-search-previous

- f/F: æœç´¢å•ä¸ªå­—ç¬¦
- s/S: æœç´¢ä¸¤ä¸ªå­—ç¬¦
- t/T: æœç´¢è¡Œå†…çš„ä¸€ä¸ªå­—ç¬¦

å…¶åæŒ‰","æˆ–";"é‡å¤ä¹‹å‰çš„æœç´¢æ“ä½œ(evil-repeat-find-char).

æŒ‰ç¼©è¿›å±‚æ¬¡é€‰æ‹©æ–‡æœ¬:
- vii
NOTE: é€‰æ‹©æ–‡å­—åŒºåŸŸåå¯æŒ‰"o"é”®exchange-point-and-mark, å†ç”±ä¸Šæˆ–ç”±ä¸‹æ‰©é€‰èŒƒå›´.

æ”¹å˜é€‰ä¸­æ•°å­—å¤§å°:
- g+æˆ–g=, g-

*** zå¼€å¤´çš„å‘½ä»¤:
- zc, zoå…³é—­æˆ–æ‰“å¼€æ‰€åœ¨headline
- zn/zN: åˆ‡æ¢æŸ¥çœ‹å½“å‰headline (indirect buffer)
- zi: åˆ‡æ¢imageæ˜¾ç¤º

Zå¼€å¤´çš„å‘½ä»¤
- ZQ: evil-quit
- ZX: ä¿å­˜å¹¶å…³é—­å½“å‰buffer

*** org headlineè·³è½¬
- gk, gj
- gh, gl, gH

*** resumeç›¸å…³å‘½ä»¤
- gi: evil-insert-resume
- gv: evil-visual-restore

*** æ‰¾åˆ°å…‰æ ‡ä¸‹çš„æ–‡ä»¶
gf
: evil-find-file-at-point-visual

*** è½¬æ¢å¼€å…³
emacsç›¸å…³
\
: evil-execute-in-emacs-state

C-z
: evil-emacs-state

åœ¨insert stateä¸‹æŒ‰C-oå¯åœ¨normal stateä¸‹æ‰§è¡Œå‘½ä»¤. è¿™æ ·å°±æ²¡å¿…è¦å®šä¹‰doom-leader-alt-keyäº†?
: evil-execute-in-normal-state

*** exå‘½ä»¤
æ¯”å¦‚ä»¥":"è¿›è¡Œexå‘½ä»¤:
: :g/evil/d
ä»¥ä¸Šå‘½ä»¤æœç´¢evilå¼€å¤´çš„è¡Œ, å¹¶åˆ é™¤ä¹‹.

: :v/evil/d
åˆ é™¤ä¸åŒ…æ‹¬evilçš„è¡Œ

:m æŒªè‡³è¡Œå·

:! æ‰§è¡Œshellå‘½ä»¤
: evil-shell-command


** multi-cursor: åŒæ—¶æ“ä½œå¤šä¸ªå…‰æ ‡
- gzz
- gzc

** dired-jump
| SPC-f-j |

** window/frame
| SPC w v   | vertical split                       |
| SPC w s   | horizontally split                   |
| SPC w d   | remove window                        |
| SPC w r   | swap windows                         |
| SPC w f   | tear off window, float window å¾ˆæœ‰ç”¨ |
| SPC w o   | æœ€å¤§åŒ–popup                          |
| SPC w z   | è‡ªåŠ¨å°†å½“å‰windowæ”¾å¤§è‡³åˆæ ¼å¤§å°       |
| SPC w m m | æœ€å¤§åŒ–å½“å‰çª—å£                       |
| SPC w u   | æ’¤é”€çª—å£æ”¹åŠ¨                         |
| SPC o f   | æ–°å¼€çª—å£, make-frame                 |

** è°ƒè¯•emacs
çœŸå¥½ç”¨.
: debug-on-error

åœ¨doomé‡Œå¯ä»¥ç”¨ SPC-h-d-d

ä¹Ÿå¯å¯ç”¨profiler, SPC-h-d-t, æŸ¥çœ‹å‘½ä»¤è°ƒç”¨å †æ ˆ

** ä¹¦ç­¾ç®¡ç†
: SPC-f-b

#+BEGIN_SRC emacs-lisp :tangle no
(counsel-bookmark)
#+END_SRC

** multiple-cursors
æŒ‰Alt-Dé«˜äº®word, é€æ­¥é€‰ä¸­å¤šä¸ªå¯ç¼–è¾‘å•å…ƒ. æŒ‰ESCé€€å‡º.

** åˆ é™¤ç©ºæ ¼
- just-one-space é»˜è®¤ç»‘å®šä¸º ~ï¼­-SPC~

** åˆ‡æ¢åªè¯»æ¨¡å¼
: C-x C-q
: SPC-t r

** magit
- åœ¨magit statusçª—å£, å¯ä»¥ç›´æ¥ä½¿ç”¨diredè®¿é—®æ–‡ä»¶: magit-dired-jump (C-M-i)
- ä½¿ç”¨yadmç®¡ç†dotfiles, SPC-g-.

| magit-status          | SPC-g-g                     |
| magit-stage-file      | s                           |
| magit-file-dispatch   | SPC-g-.                     |
| magit-log-buffer-file | Show log for current buffer |
| magit-delete-thing    | æŒ‰x, å¯åˆ é™¤å…‰æ ‡å‰æ–‡ä»¶       |

: reset: O
: discard: x
: git rm --cached: K

timemachine:
<normal-state> C-n    git-timemachine-show-next-revision
<normal-state> C-p    git-timemachine-show-previous-revision


å¤„ç†å½“å‰æ–‡ä»¶çš„ç¼–è¾‘å†å²:
: magit-file-dispatch

** ç²˜è´´æ›¿æ¢é€‰ä¸­æ–‡å­—
viæ¨¡å¼ä¸‹ä½¿ç”¨På‘½ä»¤.

** ä½¿ç”¨å¤–éƒ¨ç¨‹åºæ‰“å¼€æ–‡ä»¶çš„æ–¹å¼
emacs é»˜è®¤ä½¿ç”¨ docview mode æ¥æ‰“å¼€é“¾æ¥çš„æ–‡ä»¶, æ¯”å¦‚ PDF ç­‰, ä¸å¤ªæ–¹ä¾¿. æ“ä½œæ­¥éª¤:
1. dired-jump (SPC-f-j): ä½¿ç”¨ dired æ‰“å¼€å½“å‰æ–‡ä»¶æ‰€åœ¨ç›®å½•
2. åœ¨ dired ç•Œé¢ä¸Šé€‰æ‹©æŸä¸ªæ–‡ä»¶, ä½¿ç”¨ external ç¨‹åºæ‰“å¼€ (SPC-f-o).
3. ä¹Ÿå¯ä»¥åœ¨ dired ç•Œé¢ä¸Šç”¨"!"æˆ–"&"å‘½ä»¤, æŒ‡å®šä»»æ„ç¨‹åºæ‰“å¼€.

** æ‰“å¼€bufferæ–‡ä»¶æ‰€åœ¨ç›®å½•
~SPC-u SPC-f-o~

* TODO Note management
- ç«èŠ±ç¬”è®°, fleeting note, slip-box: è¿™äº›ç”¨org-captureå°±å¾ˆå¥½, å…³é”®æ˜¯å¿«, ç”µå…‰çŸ³ç«
- æ°¸ä¹…ç¬”è®°, permanent note: è¿™äº›å¯æ”¾ç½®åœ¨zoteroé‡Œ. ä½¿ç”¨zoteroæ•°æ®åº“, å¯å®ç°æ¡ç›®çš„
  æ°¸ä¹…é“¾æ¥, ä¸å—ç¬”è®°è·¯å¾„å˜åŒ–çš„å½±å“.

æœç´¢æ‰€æœ‰.noteç¬”è®°å
- SPC-n-f (gwp/find-file-in-notes)
å…¨æ–‡æœç´¢æ‰€æœ‰.noteç¬”è®°
- SPC-s-n (gwp/search-all-notes)

** roam research/org-roam
æˆ‘è§‰å¾—å¯ä»¥åŸºäºzoteroæ¥å®ç°ç±»ä¼¼roamçš„ç»„ç»‡æ–¹å¼. åœ¨zoteroä¸­å¯ä»¥æ‰“æ ‡ç­¾, ä¹Ÿå¯ä»¥è®¾ç½®
related items. åŒæ—¶zoteroä¸­çš„itemsä¹Ÿæ˜¯å¹³çº§ç»„ç»‡, ç»Ÿä¸€å‘½å, ä½¿ç”¨zotero uriå¯ä»¥åœ¨
orgæ–‡æ¡£ä¸­è‡ªç”±å¼•ç”¨è·³è½¬. ç°åœ¨å”¯ä¸€æ¬ ç¼ºçš„æ—¶åƒorg-roam-serveré‚£æ ·å¯ä»¥äº¤äº’å¼çš„å±•ç°å…³è”
æ¡ç›®çš„networkå±•ç°æ–¹å¼.

org-roamå¯ç”¨äºæ›¿ä»£org-capture, è¿™æ ·åœ¨æµè§ˆæ—¶éšæ—¶è®°å½•, å¹¶å¯ä¿ç•™noteé—´çš„å…³è”æ€§. åŒ
æ—¶ç”±äºæ˜¯å¤šæ–‡ä»¶, å¯ä»¥å‡å°‘æ–‡ä»¶åŒæ­¥å†²çª.

org-roam-capture
org-roam-node-find
org-roam-node-insert
org-roam-buffer-toggle

å…³é”®åŠŸèƒ½:
- åŒå‘é“¾æ¥ backlinks
- å—å¼•ç”¨
  - [[https://github.com/nobiot/org-transclusion][nobiot/org-transclusion: (alpha) Emacs package to enable transclusion with Org Mode]]
  - [[https://github.com/Kinneyzhang/roam-block][Kinneyzhang/roam-block: An all-purpose block ref and block embed implement in emacs.]]
- å›¾è¡¨å±•ç¤º(å¯ç”¨org-protocolé“¾æ¥)

* TODO Literate Programming in Rust
éœ€è¦å®‰è£…[[https://github.com/racer-rust/racer][racer]], æ³¨æ„ä¸èƒ½ç”¨ç³»ç»Ÿåº“ä¸­çš„, ä¸ç„¶è¡¥å…¨stdä¼šæŠ¥é”™.

: rustup toolchain add nightly
: rustup component add rust-src
: cargo +nightly install racer
: racer complete std::io::B

- ä½¿ç”¨ "Ctrl-c Ctrl-d" å¯ä»¥è‡ªåŠ¨æ·»åŠ æˆ–åˆ é™¤dbg!
- ä½¿ç”¨ "Ctrl-c Ctrl-f" rustfmtæ ¼å¼åŒ–buffer
- ä»¥ä¸ŠæŒ‰é”®åœ¨orgä»£ç å—ä¸­ä¹Ÿå¯ç›´æ¥æ‰§è¡Œ, org-babel-do-key-sequence-in-edit-buffer
- (citre-jump-back): éœ€è¦å®šä¹‰tagæ–‡ä»¶, æ”¯æŒè·³è½¬è‡³å‡½æ•°å®šä¹‰, å¾ˆå¸… (SPC-j-c-d, SPC-j-c-b)
- cargo compileåŠŸèƒ½: (gwp/rust-cargo-transient)
- åœ¨orgä¸­ç¼–è¾‘ä»£ç , é€‰æ‹©å½“å‰ä»£ç , (gwp/org-babel-tangle-dwim)åå¯å°†ä»£ç æ‰€tangleè‡³çš„ç›®æ ‡æ–‡ä»¶åŠæ‰€æœ‰blockséƒ½å¯¼å‡º.
- å¯èƒ½ç”¨å¾—ä¸Š: rust-promote-module-into-dir

* TODO Python scripting
- ä½¿ç”¨tmuxå¼€ä¸€ç»ˆç«¯, æ‰“å¼€ipython
- åœ¨emacsä¸­å†™ä»£ç , ä½¿ç”¨ +tmux/send-regionæ¥å‘é€ä»£ç åˆ°ipythonçª—å£

* TODO Research Writing Workflow
** åŸºæœ¬æµç¨‹
- ä½¿ç”¨org-modeæ¥å®Œæˆæ–‡å­—, å›¾ç‰‡, è¡¨æ ¼, å…¬å¼ç­‰å†…å®¹.
- å¯¼å‡ºä¸ºodtæ ¼å¼.
- ä½¿ç”¨[[http://zotero-odf-scan.github.io/zotero-odf-scan/][RTF/ODF-Scan for Zotero]] æ¥æ ¼å¼åŒ–zoteroå¼•ç”¨.
  - [2018-01-05 Fri] å·²è‡ªå®šä¹‰exportå‡½æ•°, ä¸å¿…ä½¿ç”¨odf-scan, odtå¯¼å‡ºä¸€æ­¥åˆ°ä½.
- åœ¨Libreofficeä¸­è¿›è¡Œå¿…è¦çš„ä¿®æ”¹.
- è¾“å‡ºPDFå’Œæˆ–doc.

** org odt export
- odtå¯¼å‡ºåŠŸèƒ½éå¸¸å¼ºå¤§, å¯¹äºæ™®é€šç”¨æˆ·, odtæ— ç–‘æ¯”latexçš„æ˜“ç”¨æ€§å’Œå¯å®šåˆ¶æ€§æ›´å¼º.
- å¯ä»¥åœ¨org bufferé‡ŒæŒ‡å®šodtæ¨¡æ¿æ–‡ä»¶. ä½¿ç”¨odtè€Œä¸æ˜¯ottæ ¼å¼ä¼šæ›´æ–¹ä¾¿ä¸€äº›, å› ä¸ºæ‰“å¼€
  ottæ—¶æ²¡æœ‰å…·ä½“çš„å†…å®¹å¯å‚ç…§ä¿®æ”¹ç»“æœ.
- ç å…¬å¼çš„æ—¶å€™, ä½¿ç”¨"begin{equation*}"block, odtä¼šè‡ªåŠ¨ç¼–å·. ä¸èƒ½è®¾ç½®scale, width
  ç­‰å›¾ç‰‡å±æ€§.

References
- [[https://github.com/emacsmirror/org/blob/master/lisp/ox-odt.el][org/ox-odt.el at master Â· emacsmirror/org]]
- [[https://orgmode.org/manual/OpenDocument-Text-export.html][The Org Manual: OpenDocument Text export]]

** RTF/ODF-scanæ’ä»¶
è¿™ä¸ªæ’ä»¶å¯ä»¥å°†çº¯æ–‡æœ¬çš„å¼•æ–‡æ ‡è®°, æ ¼å¼åŒ–ä¸ºzotero word processorå¯å¤„ç†çš„zoteroå¼•æ–‡.
æ­¤å¤–, è¿™ä¸ªæ‰©å±•è¿˜å¯ä»¥åå‘çš„å°†zotero word processorå¤„ç†åçš„å¼•æ–‡è½¬æ¢æˆçº¯æ–‡ä»¶æ ‡è®°.

ä»å®˜ç½‘ä¸‹è½½æ‰©å±•å, åœ¨zotero standaloneçš„addoneçª—å£å®‰è£….

1. åœ¨zoteroä¸­è®¾ç½®å¥½quick copyçš„è¾“å‡ºæ ¼å¼ä¸º "scannable cite".
2. åœ¨zoteroä¸­é€‰æ‹©ç›®æ ‡æ¡ç›®, å°†å…¶æ‹–å…¥org-modeå½“å³å¯.
3. é€šè¿‡ä¿®æ”¹configé€‰é¡¹(ODFScan.useZoteroSelect), odfscan markerå­—æ®µä¸­çš„æœ€åä¸€é¡¹ä¹Ÿ
   å¯ä»¥ä¸ºzoteroé“¾æ¥. ä½†åœ¨æ ¼å¼åŒ–æ—¶ä¸èƒ½æ­£å¸¸ç”Ÿæˆodtæ–‡ä»¶, è¿™å¯èƒ½æ˜¯ä¸€ä¸ªbug.

* TODO Research Literature Management Workflow
- [[https://github.com/joostkremers/ebib][joostkremers/ebib: A BibTeX database manager for Emacs.]]
- [[https://emacs-china.org/t/emacs/12580][ä½ çš„emacsæ–‡çŒ®/çŸ¥è¯†ç®¡ç†æ–¹æ¡ˆæ˜¯ä»€ä¹ˆï¼Ÿ - Emacs-general - Emacs China]]

å°†annotation.noteæ”¾åˆ°zoteroå†…ç½®åº“é‡Œçš„ä¼˜ç‚¹å’Œé—®é¢˜:
- ä¼˜ç‚¹: ä»¥zoteroä¸ºä¸­å¿ƒè¿›è¡Œæ•°æ®ç®¡ç†. ä»æ–‡çŒ®åˆ°ç¬”è®°å¾ˆæ–¹ä¾¿.
- ä¼˜ç‚¹: noteå’Œpdfè·¯å¾„ç›¸å¯¹ç¨³å®š, ä¸ç”¨æ‹…å¿ƒæ›´æ¢ç³»ç»Ÿåæ–‡ä»¶è·¯å¾„å˜åŒ–å¯¼è‡´çš„é—®é¢˜.
- ä¼˜ç‚¹: æ–¹ä¾¿å®ç°ç±»ä¼¼roamç­‰å·¥å…·ç±»ä¼¼çš„åŠŸèƒ½.
- é—®é¢˜: ä¸èƒ½æ–¹ä¾¿åœ°åœ¨zoteroç•Œé¢é‡Œè¿›è¡Œæœç´¢ (éœ€è¦fulltext index) (ä½†å¯ä»¥ç”¨è‡ªç¼–å·¥å…·
  notesearchæ¥å¤„ç†, ä¸è¿‡éœ€è¦å®šæœŸæ›´æ–°cache)

** Zoteroç¬”è®°ç®¡ç†
- åœ¨Emacsä¸­gwp/insert-new-zotero-item, å°†åœ¨zoteroä¸­æ–°æ·»åŠ ä¸€reportç±»ä¼¼çš„note
- åœ¨Zoteroç•Œé¢é€‰ä¸­æŸæ–‡çŒ®, å³é”®Attach New File, å°†è‡ªåŠ¨é™„ä¸Šä¸€noteæ–‡ä»¶

** ä½¿ç”¨org-noteræ‰¹æ³¨PDF
- [2021-08-19 Thu] org-noterä¹Ÿå¾ˆé•¿æ—¶é—´æ²¡æœ‰æ›´æ–°äº†
- [2020-01-01 Wed] org-noteræ¯”interleaveåŠŸèƒ½æ›´å¼º.

å°†pdfæ–‡ä»¶å…³è”åˆ°emacs, ä½¿ç”¨pdf-toolsæ‰“å¼€(pdf-view-mode)
- è¿›å…¥org-noterç•Œé¢(SPC-n-n), æŒ‰æç¤ºå°† annotation.noteæ”¾åˆ°PDFæ‰€åœ¨ç›®å½•
- ä½¿ç”¨org-noteræ’å…¥ç¬”è®°

ä¼˜ç‚¹:
- Noteå’ŒPDFç›´æ¥å…³è”, ä¸éœ€è¦å†™ä»»ä½•ä»£ç . æ–¹ä¾¿æ˜“ç”¨.
- åŸå§‹zoteroæ•°æ®åº“ä¸­çš„ä¸ºçˆ¶æœ¬, ä¸åŒNoteä¸­çš„æ‰¹æ³¨çš„æœ‰ä¸åŒçš„å‰¯æœ¬.
éœ€è¦æ›´æ–°.cache/notesåˆ—è¡¨.

æµç¨‹:
- åœ¨zoteroç•Œé¢, é€‰ä¸­å¾…æ‰¹æ³¨çš„PDF, "copy attachment path"
- åœ¨æ™®é€šçš„orgæ–‡ä»¶ä¸­å°†zoteroä¸­çš„PDFåˆ—ä¸ºé™„ä»¶.
- æ‰“å¼€org-noteræ‰¹æ³¨è¯¥é™„ä»¶(space-m-n-n).

pdf-viewå¿«æ·é”®
- pdf-view-scroll-down-or-previous-page: ctrl-d, ctrl-b
- pdf-view-scroll-up-or-next-page: ctrl-u, ctrl-f
- pdf-view-next-page-command: ctrl-j
- pdf-view-previous-page-command: ctrl-k
- pdf-view-first-page: gg
- pdf-view-last-page: G
- pdf-view-fit-width-to-window

é¼ æ ‡
- ä¸Šä¸€é¡µ: mouse-9
- ä¸‹ä¸€é¡µ: mouse-10

** ä½¿ç”¨interleaveæ‰¹æ³¨æµç¨‹(old)
- åœ¨zoteroç•Œé¢, é€‰ä¸­å¾…æ‰¹æ³¨çš„PDF, "copy attachment path"
- æ‰“å¼€org-capture, ä½¿ç”¨interleaveæ¨¡æ¿, ç”Ÿæˆ~/annotation.note
- åœ¨zoteroç•Œé¢, ä½¿ç”¨zotfileçš„ "Attach New File"åŠŸèƒ½, è‡ªåŠ¨å°†annotation.noteåŠ å…¥é™„
  ä»¶. (æ³¨æ„éœ€è¦ä¿®æ”¹è®¾ç½®, å°†noteåˆ—å…¥zotfileå¯ç®¡ç†çš„æ–‡ä»¶ç±»å‹)
- åœ¨zoteroç•Œé¢, åŒå‡»æ‰“å¼€é™„å…¥çš„noteæ–‡ä»¶, è¿›å…¥interleaveç¼–è¾‘æ¨¡å¼.

** References
- [[https://codearsonist.com/reading-for-programmers][Piotr Limanowski: Reading for Programmers]]
- [[https://www.researchgate.net/post/What_reference_manager_is_used_for_Emacs_users][What reference manager is used for Emacs users?]]
- [[http://www.mkbehr.com/posts/a-research-workflow-with-zotero-and-org-mode/][A research workflow with Zotero and Org mode | mkbehr.com]]
- [[https://emacs.stackexchange.com/questions/24725/zotero-workflow-into-emacs][org mode - zotero workflow into emacs? - Emacs Stack Exchange]]

* Literate Programming Workflow
- åœ¨ä»£ç çª—å£ç¼–è¾‘æ—¶(org-edit-src), ä½¿ç”¨C-x C-sæ¥ä¿å­˜buffer(æˆ–SPC-f-s). ä¸è¦ä½¿ç”¨:wå‘½ä»¤.
- ä»£ç ä¿®æ”¹å, ä½¿ç”¨gwp/org-babel-tangle-dwimå‡½æ•°æ¥ä»…tangleå½“å‰blockå¯¹åº”çš„ä»£ç æ–‡
  ä»¶. å¯ä»¥åœ¨ä»£ç ç¼–è¾‘çª—å£ç›´æ¥ä½¿ç”¨, è¯¥å‡½æ•°ä¼šè‡ªåŠ¨ä¿å­˜ä»£ç . (SPC-o-b, SPC-m-b-b)
- ä½¿ç”¨counselæ¥å®ç°ä¸åŒheadlineé—´çš„å¿«é€Ÿè·³è½¬(counsel-org-goto, SPC-m-.)
- å¯ä»orgè·³è½¬è‡³tangled src, ä¹Ÿå¯ç”±tangled srcè·³è½¬è‡³org src. (SPC-j-t, SPC-j-o)
- é‡è¦çš„tangleå‚æ•°å·²åœ¨é…ç½®æ–‡ä»¶ä¸­åšå…¨å±€è®¾ç½®, æ¯”å¦‚: ~padline~ ~mkdirp~ ~comments~

* TODO scripts
** dired.sh
[[https://gist.github.com/alphapapa/9c4eea0f204f865d37e8c99963feb922][Standalone Dired launcher]]

#+begin_src shell
# Launch Dired in a plain Emacs configuration.

# Arguments are passed to Emacs, e.g. "-nw" works as expected.

emacs -q "$@" \
      --eval "(dired default-directory)" \
      --eval "(defun kill-window-or-emacs () (interactive) (if (one-window-p) (kill-emacs) (delete-window)))" \
      --eval "(setq dired-dwim-target t delete-by-moving-to-trash t)" \
      --eval "(define-key dired-mode-map (kbd \"q\") #'kill-window-or-emacs)"
#+end_src

** org-archive.py
:PROPERTIES:
:header-args: :tangle pkg/.local/bin/org-archive.py :comments link :padline yes :mkdirp yes :shebang #! /usr/bin/env python2
:END:
*** TODO [2015-11-29 Sun] ä½¿ç”¨ Kitchin çš„ ox-archive.el ä»£æ›¿æ—§çš„ org-archive.py [[https://github.com/jkitchin/jmax/blob/master/ox-archive.el][URL]]
*** header
#+begin_src python
# -*- coding: utf-8 -*-
#====================================================================#
#   DESCRIPTION:  create tar.xz archive of org-mode file including
#                 all files under current directory
#
#       OPTIONS:  ---
#  REQUIREMENTS:  ---
#         NOTES:  ---
#        AUTHOR:  Wenping Guo (ybyygu)
#         EMAIL:  winpng@gmail.com
#       LICENCE:  GPL version 2 or upper
#       CREATED:  <2011-11-18 Fri 13:29>
#       UPDATED:  <>
#====================================================================#
#+end_src

*** globals
#+begin_src python
__VERSION__ = '0.1'
__UPDATED__ = '2013-01-16 14:13:56 ybyygu'

import sys
import os
import re
import urllib

rex_file = re.compile(r'.*\[\[file:([^\]]+)\]')
rex_css = re.compile(r'.*href="([^"]+)".*')

#+end_src
*** main
#+begin_src python
def find_linked_files(filename):
    """
    find linked files (image or css style etc) from filename in
    org-mode syntax
    """
    files = []

    with open(filename) as fp:
        for line in fp:
            if rex_file.match(line):
                afile = rex_file.match(line).groups()[0]
                if afile:
                    files.append(afile)
            elif rex_css.match(line):
                afile = rex_css.match(line).groups()[0]
                if afile and not afile.startswith("http"):
                    files.append(afile)

    return files

def make_tar_archive(files, archive_name):
    import tarfile

    tar = tarfile.open(archive_name, mode="w", dereference=True)
    lists = set([])
    for afile in files:
        afile = urllib.unquote(afile)
        if os.path.exists(afile):
            print("included {}".format(afile))
            lists.add(afile)
        else:
            print("{} is not in current directory!".format(afile))
    for afile in lists:
        tar.add(afile)
    tar.close()


def main(argv=None):
    import optparse

    if argv == None: argv = sys.argv

    # parsing cmdline
    cmdl_usage = 'usage: %prog [options]...[queue_id]'
    cmdl_version = "%prog " + __VERSION__
    cmdl_parser = optparse.OptionParser(usage=cmdl_usage, \
                                        version=cmdl_version, \
                                        conflict_handler='resolve')
    cmdl_parser.add_option('-h', '--help',
                           action='help',
                           help='print this help text and exit')
    cmdl_parser.add_option('-v', '--version',
                           action='version',
                           help='print program version and exit')
    # cmdl_parser.add_option('-f', '--file', dest='file',
    #                         help='start from this gjf file')
    # cmdl_parser.add_option('-p', '--pause', dest='pause',
    #                         action="store_true", default=False,
    #                         help='pause running job.')
    (cmdl_opts, cmdl_args) = cmdl_parser.parse_args()

    filename = cmdl_args[0]

    files = find_linked_files(filename)
    files.append(filename)
    make_tar_archive(files, archive_name="{}.tar".format(filename))

if __name__ == '__main__':
    main()
#+end_src

** emacsclient-open
:PROPERTIES:
:header-args: :tangle pkg/.local/bin/emacsclient-open.py :comments link :padline yes :mkdirp yes :shebang #! /usr/bin/env python
:END:
[2021-09-09 Thu] è¿™ä¸ªç”¨ä¸ä¸Šäº†.
*** header
#+begin_src python
# -*- coding: utf-8 -*-
#==============================================================================#
#   DESCRIPTION:  open text file with emacsclient and register the it into the
#                 recently-used-files list (~/.recently-used.xbel)
#
#       OPTIONS:  ---
#  REQUIREMENTS:  ---
#         NOTES:
#        AUTHOR:  Wenping Guo (ybyygu)
#         EMAIL:  winpng@gmail.com
#       LICENCE:  GPL version 2 or upper
#       CREATED:  <2010-09-01 Wed 16:04>
#       UPDATED:  <>
#==============================================================================#
#
# basically, to make emacsclient perfect, there are three things need be done:
# 1. use parameter "-a ''", that is, use a void alternate-editor to automatically start
#    emacs daemon
# 2. open the file without "-n" option to make sure the file buffer will be killed when frame
#    is closed
# 3. if the file has been opened, use "-n" option.
#+end_src

*** main
#+begin_src python
import os
import sys
import subprocess

def check_emacs_client(path):
    """check if the file has been opened by emacsclient"""
    cmdlines = ["/usr/bin/pgrep", "-fa", "emacsclient -c"]
    output = subprocess.Popen(cmdlines,
                              universal_newlines=True,  # output is a str not bytes
                              stdout=subprocess.PIPE).stdout.read()
    print(output)
    if path in output:
        return True
    return False

if len(sys.argv) == 1:
    print("%s: open file using emacsclient." % (__file__))
    sys.exit(0)

path = os.path.abspath(sys.argv[1])
if check_emacs_client(path):
    print("{:} is opened.".format(path))
    args = ["emacsclient", "-n", path]
    subprocess.call(args)
else:
    args = ["emacsclient", "-c", "-a", "", path]
    subprocess.Popen(args)
#+end_src
** alacritty daemon
å¼€å¯tmux daemon, æ–¹ä¾¿alacrittyç­‰è°ƒç”¨. ä»¿dropdownå¼çš„guake terminal

#+begin_src shell :tangle ~/.local/bin/tmux.sh :shebang #! /bin/bash
tmux new-session -A -D -s ala
#+end_src

#+begin_src shell :tangle ~/.local/bin/ala-daemon.sh :shebang #! /bin/bash
alacritty -e tmux.sh
#+end_src

** pdf-view
ä»¥å…¨å±çª—å£æ‰“å¼€PDFæ–‡ä»¶
#+header: :shebang #! /usr/bin/env bash
#+begin_src sh :tangle pkg/.local/bin/emacs-pdf.sh
emacs --maximized --file "$*" --eval "(pdf-view-fit-width-to-window)"
#+end_src

** org-agenda
#+header: :mkdirp yes :comments yes :padline yes
#+header: :shebang #! /usr/bin/env bash
#+begin_src sh :tangle pkg/.local/bin/org-agenda.sh
emacsclient -c -e "(org-agenda nil \"gt\")" -e "(delete-other-windows)"
#+end_src

** org-scratch
#+header: :mkdirp yes :comments yes :padline yes
#+header: :shebang #! /usr/bin/env bash
#+begin_src sh :tangle pkg/.local/bin/org-scratch.sh
emacsclient -c -e "(find-file \"~/Notes/scratch.note\")" -e "(delete-other-windows)"
#+end_src


** org-capture
[2021-09-01 Wed] ç”¨doomè‡ªå¸¦çš„æ›´å¥½. doom-emacs/bin

å¯ç»‘å®šå…¨å±€æŒ‰é”®, éšæ—¶è®°å½•æ‰€æ€æ‰€æƒ³.

#+header: :tangle pkg/.local/bin/org-capture.sh :shebang #! /usr/bin/env bash
#+header: :mkdirp yes :comments yes :padline yes
#+begin_src shell
emacsclient -c -F "((fullscreen . maximized))" -e "(org-capture)"
#+end_src

** stop-daemon
#+begin_src shell
/usr/bin/emacsclient --no-wait --eval "(progn (setq kill-emacs-hook nil) (kill-emacs))"
#+end_src

** take-screenshot-dwim
[2020-03-08 Sun] ç”¨ä¸ä¸Šäº†, ç°åœ¨clipboardæ–¹æ¡ˆ.
å±å¹•æˆªå›¾æ—¶éšè—å½“å‰çª—å£, å®Œæˆåå†åˆ‡å›åŸçª—å£. éœ€è¦å®‰è£…xdotoolå·¥å…·.
#+header: :tangle no
#+begin_src shell
[[ $# < 1 ]] && echo "no image path" && exit 0

# switch to active window
xdotool keydown alt key Tab; xdotool keyup alt
# take a screenshot
deepin-screenshot -n -s "$1" 2>/dev/null
# switch back
xdotool keydown alt key Tab; xdotool keyup alt
#+end_src

** start-terminal
gnome-terminalä½¿ç”¨client/serveræ¶æ„, æ²¡æ³•åœ¨emacsä¸­ç›´æ¥æ‰“å¼€, éœ€è¦æ¸…é™¤å‡ ä¸ªç¯å¢ƒå˜é‡.
#+header: :tangle pkg/.local/bin/terminal-dwim.sh :shebang #! /usr/bin/env bash
#+begin_src shell
unset GNOME_TERMINAL_SCREEN
unset GNOME_TERMINAL_SERVICE
gnome-terminal $*
#+end_src

[2021-04-05 Mon] alacrittyç°åœ¨çœŸå¥½ç”¨. å¯ä»¥æ”¾å¼ƒgnome-terminaläº†.

** org-read-todo
#+BEGIN_SRC sh
dir_read_root=~/ToDo/READ/Research
dir_topic=$(basename "`pwd`")

dir_read="$dir_read_root"/"$dir_topic"

mkdir -p "$dir_read"

cp "$(pwd)/${1#file:}" "$dir_read"/
#+END_SRC

** org-read-done
#+BEGIN_SRC sh
dir_read_root=~/ToDo/READ/Research
dir_topic=$(basename "`pwd`")

dir_read="$dir_read_root"/"$dir_topic"

path="$dir_read"/$(basename "${1#file:}")

[[ -f "$path" ]] && rm -f "$path"
#+END_SRC

* TODO desktop integration
** emacs (no fcitx)
å±è”½æ‰fcitx, åªç”¨emacsè‡ªå¸¦çš„emacs-rime, æ¥å®ç°æ›´ä½³è¾“å…¥ä½“éªŒ
#+name: 73cd85b7
#+begin_src shell :tangle ~/.local/bin/emacs :shebang #! /usr/bin/env bash
unset GTK_IM_MODULE XMODIFIERS
/usr/bin/emacs $@
#+end_src

** TODO emacs daemon
- [[https://www.taingram.org/blog/emacs-client.html][Emacsclient Setup with Desktop Integration]]

** app launcher (æ›¿ä»£krunner, gnome-doç­‰)                          :ATTACH:
:PROPERTIES:
:ID:       c616356a-c1cf-450e-83e3-0e42afa72ebb
:END:
[2021-09-30 Thu] ä»¥ä¸‹emacsè„šæœ¬æ—¶çµæ—¶ä¸çµçš„. å¯åœ¨KDEä¸‹ä¸ºemacsç¨‹åºè®¾ç½®çª—å£å¿«æ·é”®,
æ¯”å¦‚win-u, æŒ‰é”®æ—¶ç›´è¾¾emacs, ç„¶åå†è°ƒç”¨ counsel-linux-app, counsel-wmctrlç­‰å‘½ä»¤å³
å¯.

#+caption: KDEè®¾ç½®ç•Œé¢
#+name: fig:394ff428
#+attr_org: :width 800
#+attr_odt: :width 10
[[attachment:2021-09-30_09-50-27_screenshot.png]]


ç¨‹åºè°ƒç”¨
- [[https://oremacs.com/2016/03/16/counsel-linux-app/][Emacs completion for launching Linux desktop apps.]]
- [[https://lchsk.com/launching-applications-from-emacs.html][Launching applications from Emacs]]
- [[https://github.com/mathiasdahl/emacs-launcher][emacs-launcher]]
- [[https://www.mattduck.com/emacs-fuzzy-launcher.html][Emacs as a fuzzy launcher and Alfred-replacement]]

  #+begin_src shell :tangle ~/.local/bin/counsel-linux-app.py :shebang #! /usr/bin/env python3
  import subprocess
  # wnd_id = subprocess.check_output(["xdotool", "search", "--name", "emacs"]).decode().split("\n")[-2]
  # subprocess.call(["wmctrl", "-ia", wnd_id])
  subprocess.call(["wmctrl", "-a", "emacs"])
  subprocess.call(["emacsclient", "--eval", "(counsel-linux-app)"])
  #+end_src

 åˆ‡æ¢çª—å£
- [[https://github.com/flexibeast/ewmctrl][Use wmctrl to manage desktop windows]]
  : wmctrl -a firefox
  : wmctrl -a emacs

- [[https://github.com/abo-abo/oremacs/blob/github/etc/bin/counsel-wmctrl.sh][oremacs/etc/bin/counsel-wmctrl.sh ]]
  : counsel-wmctrl

  #+begin_src shell :tangle ~/.local/bin/counsel-wmctrl.py :shebang #! /usr/bin/env python3
  import subprocess
  # wnd_id = subprocess.check_output(["xdotool", "search", "--name", "emacs"]).decode().split("\n")[-1]
  # subprocess.call(["wmctrl", "-ia", wnd_id])
  subprocess.call(["wmctrl", "-a", "emacs"])
  subprocess.call(["emacsclient", "--eval", "(counsel-wmctrl)"])
  #+end_src


** emacsclient-open
å¯ç”¨äºæ‰“å¼€.noteå’Œ.pdfæ–‡ä»¶
#+begin_src text :tangle pkg/.local/share/applications/gwp-emacsclient.desktop :mkdirp yes :comments no
[Desktop Entry]
Version=1.0
Name=Emacs Client - GWP
GenericName=Text Editor
Comment=View and edit files
MimeType=application/x-note;application/pdf;text/english;text/plain;text/x-makefile;text/x-c++hdr;text/x-c++src;text/x-chdr;text/x-csrc;text/x-java;text/x-moc;text/x-pascal;text/x-tcl;text/x-tex;application/x-shellscript;text/x-c;text/x-c++;
Exec=emacsclient --create-frame --alternate-editor="" --no-wait %F
TryExec=emacs
Icon=emacs
Type=Application
Terminal=false
Categories=Utility;Development;TextEditor;
#+end_src

** org-protocol
#+header: :tangle pkg/.local/share/applications/gwp-org-protocol.desktop :comments nil
#+BEGIN_SRC text
[Desktop Entry]
Name=org-protocol
Exec=emacsclient %U
Icon=emacs
Type=Application
Terminal=false
MimeType=x-scheme-handler/org-protocol;
#+END_SRC

æµ‹è¯•
: xdg-open 'org-protocol://store-link?url=https%3A%2F%2Forgmode.org%2Fworg%2Forg-contrib%2Forg-protocol.html'
: xdg-open 'org-protocol:///capture?template=n&url=http://www.baidu.com'

** firefox
- æ³¨å†Œ [[*org-protocol][org-protocol]]
- å¹¶ç”¨ update-desktop-database, æ›´æ–°MIMEæ•°æ®åº“
  #+begin_src shell
  update-desktop-database ~/.local/share/applications -vv
  #+end_src

- åœ¨Firefoxä¸­ç¦ç”¨security.csp.enableé€‰é¡¹
- ä½¿ç”¨bookmarkletsæ¥captureç½‘é¡µå†…å®¹

** org-capture
[2021-08-28 Sat] ä¼¼ä¹ç”¨å¤„ä¸å¤§äº†
#+begin_src text :tangle pkg/.local/share/applications/gwp-org-capture.desktop :mkdirp yes
[Desktop Entry]
Version=1.0
Name=Org Capture
Comment=Capture using emacs org-mode
Exec=org-capture.sh
TryExec=emacs
Icon=emacs
Type=Application
Terminal=false
Categories=Utility;Development;TextEditor;
#+end_src

** install
1. éªŒè¯æ¡Œé¢æ–‡ä»¶. æ¡Œé¢æ–‡ä»¶å¼€å¤´çš„gwp-ä¸ºvendor.
2. å®‰è£…æ¡Œé¢æ–‡ä»¶.
3. å°†pythonè„šæœ¬è½¯é“¾æ¥åˆ°$HOME/.local/binç›®å½•ä¸‹. æ³¨æ„è¿™é‡Œçš„è·¯å¾„è¦ä¸
   desktopæ–‡ä»¶æ‰€æŒ‡å®šçš„ä¸€å®š.

æ›´æ–°desktopæ•°æ®åº“
#+BEGIN_SRC shell :results none
update-desktop-database ~/.local/share/applications/
#+END_SRC

#+begin_src shell :dir ~/.local/share/applications
desktop-file-validate gwp-emacsclient.desktop
xdg-desktop-menu install gwp-emacsclient.desktop
# desktop-file-validate gwp-org-capture.desktop
# xdg-desktop-menu install gwp-org-capture.desktop
#+end_src


* é…ç½®å®‰è£…
** stowé…ç½®ç®¡ç†æ€è·¯
- tangleæ—¶ä»…å¯¼å‡ºåˆ°å½“ç›®å½•ä¸‹æˆ–å­ç›®å½•ä¸‹, æ–¹ä¾¿gitç®¡ç†.
- stowå† "install" åˆ°ä¸»ç›®å½•ä¸‹.

** docker
[[https://github.com/JAremko/docker-emacs][JAremko/docker-emacs: Dockerized Emacs (GUI)]]
#+name: bec94355
#+begin_src bash :tangle /tmp/run.sh
ip=$(ifconfig enp0s31f6 | grep inet | awk '$1=="inet" {print $2}')
xhost + $ip
docker run -ti --name emacs\
 -e DISPLAY=$ip:0\
 -e UNAME="ybyygu"\
 -e GNAME="ybyygu"\
 -e UID="1000"\
 -e GID="1000"\
 # -v <path_to_your_.emacs.d>:/home/emacs/.emacs.d\
 # -v <path_to_your_workspace>:/mnt/workspace\
 centaur/emacs emacs
#+end_src

** ä½¿ç”¨chemacsåšemacsåŒå¯åŠ¨ [[https://github.com/plexus/chemacs][plexus/chemacs: Emacs profile switcher]]
- [[https://github.com/plexus/chemacs2][plexus/chemacs2: Emacs version switcher, improved]]
- [[https://github.com/Silex/docker-emacs][Silex/docker-emacs: Run Emacs in docker containers!]]

ä½¿ç”¨
- è¿›å…¥chemacskç›®å½•, æ‰§è¡Œinstall.shå³å¯.
- ä¿®æ”¹ ~/.emacs-profiles.el

#+name: 0fe5ff8e
#+begin_src elisp :tangle ~/.emacs-profiles.el
(("default" . ((user-emacs-directory . "~/Workspace/Programming/emacs/doom-emacs")
               (env . (("DOOMDIR" . "~/.doom.d")))))
 ("gwp" . ((user-emacs-directory . "~/Install/configs/emacs/gwp")))
 ("centaur" . ((user-emacs-directory . "~/Install/configs/emacs/centaur/.emacs.d"))))
#+end_src

è°ƒç”¨
#+begin_src sh
emacs --with-profile centaur
#+end_src

** å®‰è£…doom-emacs
- è¿›å…¥doom-emacsç›®å½•, æ‰§è¡Œ:
  : bin/doom install

doomä¼šæ ¹æ®~/.doom.dä¸­çš„é…ç½®, æ›´æ–°doom-emacs/.localç›®å½•ä¸­çš„å†…å®¹. å¦‚æœdoom-emacsç›®
å½•ä½ç½®å‘ç”Ÿå˜åŒ–, éœ€è¦åˆ é™¤.local/straints/buildç›®å½•, å†é‡å»º:
: doom-emacs/bin/doom build

** .noteæ–‡ä»¶æœç´¢
- å®‰è£…locate/updatedbæœåŠ¡ (mlocate)
- åœ¨~/.cache/noteså»ºç«‹è½¯é“¾æ¥
  : notesearch.py -r ~/.cache/notes

[2021-08-29 Sun] ä½¿ç”¨counsel-rgæ¥å®ç°, ä»¥ä¸‹è®¾ç½®ä¸éœ€è¦äº†
- æ·»åŠ ripgrepé…ç½®æ–‡ä»¶, æ·»åŠ --follow symlinké€‰é¡¹.

#+begin_src sh :tangle ~/.ripgreprc
--follow
#+end_src

** syncthing .stignore
sycnthingåŒæ­¥æ—¶è¦é¿å…åŒæ­¥æŸäº›æ–‡ä»¶, ä»¥å…ä¸åŒæœºå™¨é—´emacså†²
çª

- https://docs.syncthing.net/users/ignoring.html

éœ€è¦å†™åœ¨~/Workspaceç›®å½•ä¸‹:
/Programming/emacs/doom-emacs/.local/cache

* è°ƒè¯•æ­¥éª¤
- [[https://github.com/hlissner/doom-emacs/blob/develop/docs/getting_started.org#testing-in-dooms-sandbox][doom-emacs/getting_started.org at develop Â· hlissner/doom-emacs]]

** How to extract a backtrace from an error
If you encounter an error while using Doom Emacs, youâ€™re probably about to head
off and file a bug report (or request help on our Discord server). Before you
do, please generate a backtrace to include with it.

To do so you must enable debug-on-error then recreate the error.

** Enabling debug-on-error
There are three ways to enable debug-on-error:

Start Emacs with emacs --debug-init. Use this for errors that occur at startup.
Evil users can press SPC h d d and non-evil users can press C-h d d. If the
above donâ€™t work, thereâ€™s always: M-x toggle-debug-on-error

Now that debug-on-error is on, recreate the error. A window should pop up with a
backtrace.
* doom notes
** project
- SPC p t         magit-todos-list
- SPC p x         doom/open-project-scratch-buffer

* install
** Makefile
ä½¿ç”¨gnu stowæ¥å°†pkgç›®å½•ä¸‹çš„æ–‡ä»¶å®‰è£…symlinkåˆ°$HOMEä¸‹å¯¹åº”çš„ç›®å½•

å®‰è£…:
: make

å­—ä½“:
: yay -S ttf-all-the-icons

å‡çº§:
: make doom-upgrade

åˆå¹¶åˆ°gwpåˆ†æ”¯:
: make gwp-merge
: make install && make

#+header: :tangle Makefile
#+name: 1f24e8ab
#+BEGIN_SRC makefile -i
# https://www.gnu.org/software/make/manual/html_node/One-Shell.html
.ONESHELL:

default: install doom-sync

install: stow
	stow --verbose --adopt --no-folding --target ~/ pkg
	rsync -rav ./doom-hacks/modules/tools/magit ~/.doom.d/modules/gwp/
	# rsync -rav ./doom-hacks/modules/lang/org ~/.doom.d/modules/gwp/
	rsync -rav ./doom-hacks/modules/lang/rust ~/.doom.d/modules/gwp/
	rsync -rav ./doom-hacks/modules/config/default ~/.doom.d/modules/gwp/
	rsync -rav ./doom-hacks/modules/tools/pdf ~/.doom.d/modules/gwp/
uninstall:
	stow --verbose --target ~/ --delete pkg

# doom ç›¸å…³æ“ä½œ
doom-sync: pkg/.doom.d/init.el pkg/.doom.d/packages.el # ä¿®æ”¹doomé…ç½®åæ‰§è¡Œ
	doom-emacs/bin/doom sync
doom-build:                                            # é‡å»º.localä¸‹buildç›®å½•
	doom-emacs/bin/doom build
doom-clean:                                            # æ¸…ç†è¿‡æœŸçš„.elcæ–‡ä»¶
	doom-emacs/bin/doom clean
doom-upgrade:                                          # å‡çº§doomåŠpackages
	doom-emacs/bin/doom upgrade
start:
	emacs --with-profile default
stow:
	which stow
# åˆå¹¶doom developåˆ†æ”¯ä¿®æ”¹
gwp-merge:
	cd doom-hacks
	git checkout develop
	git pull
	git checkout gwp
	git merge -e develop
#+END_SRC

** doom commands
#+begin_src text
1. Whenever you edit your doom! block in ~/.doom.d/init.el or modify your
   modules, run:

     bin/doom refresh

   This will ensure all needed packages are installed, all orphaned packages are
   removed, and your autoloads files are up to date. This is important! If you
   forget to do this you will get errors!

2. If something inexplicably goes wrong, try `bin/doom doctor`

   This will diagnose common issues with your environment and setup, and may
   give you clues about what is wrong.

3. Use `bin/doom upgrade` to update Doom. Doing it any other way may require
   additional work. When in doubt, run `bin/doom sync`.

4. Check out `bin/doom help` to see what else `bin/doom` can do (and it is
   recommended you add ~/.emacs.d/bin to your PATH).

5. You can find Doom's documentation via `M-x doom/help` or `SPC h D`.
#+end_src

#+begin_src shell :tangle no
./doom-emacs/bin/doom clean
./doom-emacs/bin/doom refresh
#+end_src


* doom/config
:PROPERTIES:
:VISIBILITY: children
:END:
å…±ä¸‰ä¸ªé…ç½®æ–‡ä»¶, tangleåˆ°pkg/.doom.dç›®å½•ä¸‹, å†ç”±stowè½¯é“¾åˆ°$HOME.
** init.el
:PROPERTIES:
:header-args: :tangle pkg/.doom.d/init.el :comments nil
:END:
*** docs
- [[https://github.com/hlissner/doom-emacs/blob/develop/docs/modules.org][doom-emacs/modules.org at develop Â· hlissner/doom-emacs]]

*** doom-dirs
è®¾ç½®åˆ°ésyncthingå…±äº«ç›®å½•ä¸‹, é¿å…å…±äº«å†²çª
#+name: ec526f44
#+begin_src elisp
;;; init.el -*- lexical-binding: t; -*-

;; This file controls what Doom modules are enabled and what order they load in.
;; Remember to run 'doom sync' after modifying it!

;; NOTE Press 'SPC h d h' (or 'C-h d h' for non-vim users) to access Doom's
;;      documentation. There you'll find information about all of Doom's modules
;;      and what flags they support.

;; NOTE Move your cursor over a module's name (or its flags) and press 'K' (or
;;      'C-c g k' for non-vim users) to view its documentation. This works on
;;      flags as well (those symbols that start with a plus).
;;
;;      Alternatively, press 'gd' (or 'C-c g d') on a module to browse its
;;      directory (for easy access to its source code).

(setq doom-etc-dir "~/.doom.d/local/etc/")
(setq doom-cache-dir "~/.doom.d/local/cache/")
(setq bookmark-default-file (expand-file-name "bookmarks" doom-etc-dir))
(setq recentf-save-file (expand-file-name "recentf" doom-cache-dir))
#+end_src

*** modules
åŸç‰ˆ: [[file:doom-emacs/init.example.el]]

#+name: a3e8335d
#+begin_src elisp
(doom! :input
       (chinese)

       :completion
       (company +tng)           ; the ultimate code completion backend
       ;;helm              ; the *other* search engine for love and life
       ;;ido               ; the other *other* search engine...
       (ivy +prescient)    ; a search engine for love and life

       :ui
       ;;deft              ; notational velocity for Emacs
       doom              ; what makes DOOM look the way it does
       doom-dashboard    ; a nifty splash screen for Emacs
       ;;doom-quit         ; DOOM quit-message prompts when you quit Emacs
       ;;fill-column       ; a `fill-column' indicator
       hl-todo           ; highlight TODO/FIXME/NOTE/DEPRECATED/HACK/REVIEW
       hydra
       ;;indent-guides     ; highlighted indent columns
       modeline          ; snazzy, Atom-inspired modeline, plus API
       nav-flash         ; blink the current line after jumping
       ;;neotree           ; a project drawer, like NERDTree for vim
       ;;ophints           ; highlight the region an operation acts on
       (popup            ; tame sudden yet inevitable temporary windows
        +defaults)       ; default popup rules
       ;;pretty-code       ; replace bits of code with pretty symbols
       ;;tabs              ; an tab bar for Emacs
       ;;treemacs          ; a project drawer, like neotree but cooler
       ;;unicode           ; extended unicode support for various languages
       vc-gutter         ; vcs diff in the fringe
       vi-tilde-fringe   ; fringe tildes to mark beyond EOB
       window-select     ; visually switch windows
       workspaces        ; tab emulation, persistence & separate workspaces
       zen               ; distraction-free coding or writing

       :editor
       (evil +everywhere); come to the dark side, we have cookies
       ;;file-templates    ; auto-snippets for empty files
       fold              ; (nigh) universal code folding
       format            ; æ ¼å¼åŒ–ä»£ç å—
       ;;god               ; run Emacs commands without modifier keys
       ;;lispy             ; vim for lisp, for people who don't like vim
       multiple-cursors  ; editing in many places at once
       ;;objed             ; text object editing for the innocent
       ;;parinfer          ; turn lisp into python, sort of
       ;;rotate-text       ; cycle region at point between text candidates
       snippets          ; my elves. They type so I don't have to
       ;;word-wrap         ; soft wrapping with language-aware indent

       :emacs
       (dired)           ; making dired pretty [functional]
       electric          ; smarter, keyword-based electric-indent
       ;; ibuffer           ; interactive buffer management
       ;undo              ; persistent, smarter undo for your inevitable mistakes
       vc                ; version-control and Emacs, sitting in a tree

       :term
       ;;eshell            ; a consistent, cross-platform shell (WIP)
       ;;shell             ; a terminal REPL for Emacs
       ;;term              ; terminals in Emacs
       vterm             ; another terminals in Emacs

       :checkers
       ;;syntax              ; tasing you for every semicolon you forget
       (spell +flyspell)     ; tasing you for misspelling mispelling
       ;;grammar           ; tasing grammar mistake every you make

       :tools
       ;;biblio
       ;;ansible
       ;;debugger          ; FIXME stepping through code, to help you add bugs
       ;;direnv
       ;;docker
       ;;editorconfig      ; let someone else argue about tabs vs spaces
       ;;ein               ; tame Jupyter notebooks with emacs
       (eval +overlay)     ; run code, run (also, repls)
       ;;gist              ; interacting with github gists
       lookup              ; navigate your code and its documentation
       lsp
       ;;macos             ; MacOS-specific commands
       ;;magit             ; a git porcelain for Emacs
       ;;make              ; run make tasks from Emacs
       ;;pass              ; password manager for nerds
       ;;pdf               ; pdf enhancements
       ;;prodigy           ; FIXME managing external services & code builders
       ;;rgb               ; creating color strings
       ;;terraform         ; infrastructure as code
       tmux              ; an API for interacting with tmux
       ;;upload            ; map local to remote projects via ssh/ftp

       :lang
       ;;agda              ; types of types of types of types...
       ;;assembly          ; assembly for fun or debugging
       ;;cc                ; C/C++/Obj-C madness
       ;;clojure           ; java with a lisp
       ;;common-lisp       ; if you've seen one lisp, you've seen them all
       ;;coq               ; proofs-as-programs
       ;;crystal           ; ruby at the speed of c
       ;;csharp            ; unity, .NET, and mono shenanigans
       data              ; config/data formats
       ;;elixir            ; erlang done right
       ;;elm               ; care for a cup of TEA?
       emacs-lisp        ; drown in parentheses
       ;;erlang            ; an elegant language for a more civilized age
       ;;ess               ; emacs speaks statistics
       ;;faust             ; dsp, but you get to keep your soul
       ;;fsharp           ; ML stands for Microsoft's Language
       ;;fstar             ; (dependent) types and (monadic) effects and Z3
       ;;go                ; the hipster dialect
       ;;(haskell +dante)  ; a language that's lazier than I am
       ;;hy                ; readability of scheme w/ speed of python
       ;;idris             ;
       ;;(java +meghanada) ; the poster child for carpal tunnel syndrome
       ;;javascript        ; all(hope(abandon(ye(who(enter(here))))))
       ;;julia             ; a better, faster MATLAB
       ;;kotlin            ; a better, slicker Java(Script)
       ;;latex             ; writing papers in Emacs has never been so fun
       ;;lean
       ;;factor
       ;;ledger            ; an accounting system in Emacs
       lua               ; one-based indices? one-based indices
       markdown          ; writing docs for people to ignore
       ;;nim               ; python + lisp at the speed of c
       ;;nix               ; I hereby declare "nix geht mehr!"
       ;;ocaml             ; an objective camel
       ;;perl              ; write code no one else can comprehend
       ;;php               ; perl's insecure younger brother
       ;;plantuml          ; diagrams for confusing people more
       ;;purescript        ; javascript, but functional
       python            ; beautiful is better than ugly
       ;;qt                ; the 'cutest' gui framework ever
       ;;racket            ; a DSL for DSLs
       rest              ; Emacs as a REST client
       ;;rst               ; ReST in peace
       ;;ruby              ; 1.step {|i| p "Ruby is #{i.even? ? 'love' : 'life'}"}
       ;; (rust +lsp)         ; Fe2O3.unwrap().unwrap().unwrap().unwrap()
       ;;scala             ; java, but good
       ;;scheme            ; a fully conniving family of lisps
       sh                ; she sells {ba,z,fi}sh shells on the C xor
       ;;solidity          ; do you need a blockchain? No.
       ;;swift             ; who asked for emoji variables?
       ;;terra             ; Earth and Moon in alignment for performance.
       ;;web               ; the tubes
       ;;org

       :email
       ;;(mu4e +gmail)
       ;;notmuch
       ;;(wanderlust +gmail)

       :app
       ;;calendar
       ;;irc               ; how neckbeards socialize
       ;;(rss +org)        ; emacs as an RSS reader
       ;;twitter           ; twitter client https://twitter.com/vnought

       ;; :config
       ;;literate
       ;; (default +smartparents)

       :gwp
       ;; (org +roam2)
       magit
       (default +smartparents)
       pdf
       ;; (rust)
       ;; è‡ªå®šä¹‰æ¨¡å—
       ui
       org
       develop
       edit
       bindings
       )
#+end_src

*** leader key
é»˜è®¤çš„alt leader keyä¸º M-SPC, ä¸KDEä¸­çš„krunneræœ‰å†²çª. ç°æ”¹ä¸ºF2, æ›´æ–¹ä¾¿. æ³¨æ„: alt leader keyä»…åœ¨insertçŠ¶æ€ä¸‹æœ‰æ•ˆ.

#+name: 56a9b4bd
#+begin_src elisp
;; å±è”½æ‰emacsé»˜è®¤çš„f2åŠŸèƒ½, é¿å…åœ¨normal stateä¸‹æŒ‰f2è¯¯æ“ä½œ
(global-unset-key (kbd "<f2>"))

(setq doom-leader-key "SPC"
      doom-leader-alt-key "<f2>"        ; ä»…åœ¨insert stateä¸‹æœ‰æ•ˆ
      doom-localleader-key ","
      doom-localleader-alt-key "M-,")   ; ä»…åœ¨insert stateä¸‹æœ‰æ•ˆ

;; (setq-default doom-leader-key "SPC"
;;               doom-leader-alt "<f13>"
;;               doom-localleader-key ""
;;               doom-localleader-alt-key "<M-f13>")

;; è‡ªå®šä¹‰ leader key, ç”¨äºæ¨¡å¼ä¸‹æœ€å¸¸ç”¨çš„å‘½ä»¤(w: wo, æˆ‘)
(after! evil
  (general-create-definer gwp-leader-def
    :states '(normal insert emacs)
    :keymaps 'override                  ; prevent your leader keybindings from ever being overridden
    :prefix "w"
    :non-normal-prefix "<f4>"
    ))
#+end_src

*** load path
è‡ªå®šä¹‰çš„elæ–‡ä»¶æ”¾åœ¨user-lispä¸‹, å¯è‡ªåŠ¨åŠ è½½
#+name: af34cd47
#+begin_src elisp
(setq gwp-emacs-directory "~/Workspace/Programming/emacs/")
(push (expand-file-name "user-lisp" gwp-emacs-directory) load-path)
#+end_src

** config.el
:PROPERTIES:
:header-args: :tangle pkg/.doom.d/config.el
:END:
*** orig
#+name: b70e7222
#+BEGIN_SRC emacs-lisp
;;; $DOOMDIR/config.el -*- lexical-binding: t; -*-

;; Place your private configuration here! Remember, you do not need to run 'doom
;; sync' after modifying this file!

;; Some functionality uses this to identify you, e.g. GPG configuration, email
;; clients, file templates and snippets.
(setq user-full-name "Wenping Guo"
      user-mail-address "ybyygu@gmail.com")

;; Doom exposes five (optional) variables for controlling fonts in Doom. Here
;; are the three important ones:
;;
;; + `doom-font'
;; + `doom-variable-pitch-font'
;; + `doom-big-font' -- used for `doom-big-font-mode'; use this for
;;   presentations or streaming.
;;
;; They all accept either a font-spec, font string ("Input Mono-12"), or xlfd
;; font string. You generally only need these two:
;; (setq doom-font (font-spec :family "Monaco" :size 13))

;; This determines the style of line numbers in effect. If set to `nil', line
;; numbers are disabled. For relative line numbers, set this to `relative'.
(setq display-line-numbers-type nil)

;; Here are some additional functions/macros that could help you configure Doom:
;;
;; - `load!' for loading external *.el files relative to this one
;; - `use-package' for configuring packages
;; - `after!' for running code after a package has loaded
;; - `add-load-path!' for adding directories to the `load-path', relative to
;;   this file. Emacs searches the `load-path' when you load packages with
;;   `require' or `use-package'.
;; - `map!' for binding new keys
;;
;; To get information about any of these functions/macros, move the cursor over
;; the highlighted symbol at press 'K' (non-evil users must press 'C-c g k').
;; This will open documentation for it, including demos of how they are used.
;;
;; You can also try 'gd' (or 'C-c g d') to jump to their definition and see how
;; they are implemented.
#+END_SRC
*** package
:PROPERTIES:
:header-args: :tangle no
:END:
#+name: 2a8c4264
#+begin_src elisp
;; Emacs China ELPA
(setq package-archives
      '(("gnu"   . "https://elpa.emacs-china.org/gnu/")
        ("melpa" . "https://elpa.emacs-china.org/melpa/")))

;; ;; TNUA ELPA
;; (setq package-archives
;;       '(("gnu"   . "http://mirrors.tuna.tsinghua.edu.cn/elpa/gnu/")
;;         ("melpa" . "http://mirrors.tuna.tsinghua.edu.cn/elpa/melpa/")))
#+end_src

*** load path
:PROPERTIES:
:header-args: :tangle no
:END:
è‡ªå®šä¹‰çš„elæ–‡ä»¶æ”¾åœ¨user-lispä¸‹, å¯è‡ªåŠ¨åŠ è½½
#+name: af34cd47
#+begin_src elisp
(setq gwp-emacs-directory "~/Workspace/Programming/emacs/")
(push (expand-file-name "user-lisp" gwp-emacs-directory) load-path)
#+end_src

*** scratch
[2021-10-01 Fri] è¿˜æ˜¯elispæ›´æ–¹ä¾¿äº›.
#+name: 11b27926
#+begin_src elisp
(setq doom-scratch-initial-major-mode 'emacs-lisp)
#+end_src

*** workspace
ç¦æ­¢workspaceåœ¨é€€å‡ºemacsæ—¶è‡ªåŠ¨ä¿å­˜, é¿å…ä¸åŒæœºå™¨åŒæ­¥å†²çª
#+name: 6b10b827
#+begin_src elisp
(setq persp-auto-save-opt 0)

(defun gwp/workspace/load-or-switch (name)
  "Load or switch to a workspace."
  (interactive
   (list
    (completing-read
     "Workspace to load: "
     (persp-list-persp-names-in-file
      (expand-file-name +workspaces-data-file persp-save-dir)))))
  (if (+workspace-exists-p name)
      (+workspace/switch-to name)
    (if (not (+workspace-load name))
        (+workspace-error (format "Couldn't load workspace %s" name))
      (+workspace/switch-to name)))
  (+workspace/display))
#+end_src

*** re-open-current-file
å¯ä»¥ç”¨revert-buffer SPC-b-r
#+name: 2588788c
#+begin_src elisp :tangle no
(defun gwp/reopen-current-file ()
  "Kill current buffer and re-open it again."
  (interactive)
  (call-interactively 'kill-current-buffer)
  (call-interactively 'recentf-open-most-recent-file))
#+end_src

*** open-file-externally
ä»spacemacsä¸­æ”¹è¿‡æ¥çš„
#+name: e13c7903
#+begin_src emacs-lisp
(defun spacemacs/open-in-external-app (file-path)
  "Open `file-path' in external application."
  (let ((process-connection-type nil))
    (start-process "" nil "xdg-open" file-path)))

(defun spacemacs/open-file-or-directory-in-external-app (arg)
  "Open current file in external application.
If the universal prefix argument is used then open the folder
containing the current file by the default explorer.
If two universal prefix arguments are used, then prompt for command to use."
  (interactive "P")
  (if (equal arg '(4))                  ; C-u
      (spacemacs/open-in-external-app (expand-file-name default-directory))
    (let ((file-path (if (derived-mode-p 'dired-mode)
                         (dired-get-file-for-visit)
                       buffer-file-name)))
      (if file-path
          (if (equal arg '(16))         ; C-u C-u
              (progn
                (let ((program (read-shell-command "Open current file with: ")))
                  (call-process program nil 0 nil file-path)))
            (spacemacs/open-in-external-app file-path))
        (message "No file associated to this buffer.")))))
#+end_src

*** open in terminal
emacsç‰ˆçš„ "Open in Terminal": åœ¨gnome-terminalä¸­æ‰“å¼€å½“å‰ç›®å½•.
#+name: 12a811d1
#+begin_src emacs-lisp
(defun gwp/open-in-gnome-terminal (the-directory)
  "Open `the-directory' in external gnome-terminal."
  (let ((process-connection-type nil))
    ;; (start-process "" nil "terminal-dwim.sh" (concat "--working-directory=" the-directory) "-e" "tmux")
    (start-process "" nil "alacritty" (concat "--working-directory=" the-directory) "-e" "tmux")
    ))

(defun gwp/open-terminal-here ()
  "Open the current dir in a new terminal window"
  (interactive)
  (let ((default-directory (or (and (eq major-mode 'dired-mode)
                                    (dired-current-directory))
                               default-directory)))
    (gwp/open-in-gnome-terminal (expand-file-name default-directory))))
#+end_src

*** recent files
#+name: 493c2a26
#+begin_src emacs-lisp
(require 'recentf)
;; the default is only 20
(setq recentf-max-saved-items 1000)
(add-to-list 'recentf-exclude "autosave$")
(add-to-list 'recentf-exclude "\.png$")
(add-to-list 'recentf-exclude "\.pdf$")
(add-to-list 'recentf-exclude "\.svg$")
(add-to-list 'recentf-exclude "\.odt$")
#+end_src

*** TODO bm
ä¸»è¦ç”¨ bm, ä¹¦ç­¾æŒä¹…åŒ–æ˜¯ä» bm.el é‡ŒæŠ„æ¥çš„.
[2019-07-11 Thu] spacemacsæœ‰bm layer, ç”¨é‚£ä¸ªå§.

#+BEGIN_SRC emacs-lisp :tangle no
(defun gwp/init-bm ()
  (defun gwp-mouse-toggle-bm (e)
    "Toggle bookmarking
This command should be bound to a mouse key.
Argument E is a mouse event used by `mouse-set-point'."
    (interactive "@e")
    (save-excursion
      (mouse-set-point e)
      (bm-toggle)
      ))

  ;; adopted from: https://github.com/joodland/bm
  (use-package bm
    :ensure t
    :demand t

    :init
    ;; restore on load (even before you require bm)
    (setq bm-restore-repository-on-load t)

    :config
    ;; Allow cross-buffer 'next'
    (setq bm-cycle-all-buffers nil)

    ;; save bookmarks
    (setq-default bm-buffer-persistence t)

    ;; Loading the repository from file when on start up.
    (add-hook 'after-init-hook 'bm-repository-load)

    ;; Saving bookmarks
    (add-hook 'kill-buffer-hook #'bm-buffer-save)

    ;; Saving the repository to file when on exit.
    ;; kill-buffer-hook is not called when Emacs is killed, so we
    ;; must save all bookmarks first.
    (add-hook 'kill-emacs-hook #'(lambda nil
                                   (bm-buffer-save-all)
                                   (bm-repository-save)))

    ;; The `after-save-hook' is not necessary to use to achieve persistence,
    ;; but it makes the bookmark data in repository more in sync with the file
    ;; state.
    (add-hook 'after-save-hook #'bm-buffer-save)

    ;; Restoring bookmarks
    (add-hook 'find-file-hooks   #'bm-buffer-restore)
    (add-hook 'after-revert-hook #'bm-buffer-restore)

    ;; The `after-revert-hook' is not necessary to use to achieve persistence,
    ;; but it makes the bookmark data in repository more in sync with the file
    ;; state. This hook might cause trouble when using packages
    ;; that automatically reverts the buffer (like vc after a check-in).
    ;; This can easily be avoided if the package provides a hook that is
    ;; called before the buffer is reverted (like `vc-before-checkin-hook').
    ;; Then new bookmarks can be saved before the buffer is reverted.
    ;; Make sure bookmarks is saved before check-in (and revert-buffer)
    (add-hook 'vc-before-checkin-hook #'bm-buffer-save)

    :bind (
            ([left-fringe mouse-3] . gwp-mouse-toggle-bm)
            ([left-margin mouse-3] . gwp-mouse-toggle-bm)
            ([left-fringe mouse-5] . bm-next-mouse)
            ([left-margin mouse-5] . bm-next-mouse)
            ([left-fringe mouse-4] . bm-previous-mouse)
            ([left-margin mouse-4] . bm-previous-mouse)
            )))
#+END_SRC

*** dired-sidebar
#+name: 38a0a087
#+begin_src elisp
(use-package dired-sidebar
  :commands (dired-sidebar-toggle-sidebar))
#+end_src

*** user-lisp
#+name: c54f13b5
#+begin_src elisp
(require 'init-proxy)
(require 'init-dired)
(require 'init-magit)
;; (require 'init-eaf)
#+end_src

** packages.el
:PROPERTIES:
:header-args: :tangle pkg/.doom.d/packages.el :comments nil
:END:
æ³¨æ„, ä¸ºäº†æ–¹ä¾¿æœ‰äº›è®¾ç½®(package!)åˆ†æ•£åœ¨ä¸åŒçš„headlineä¸‹, å¦‚æœä»…tangleè¯¥subtreeå¯
èƒ½ä¼šä¸¢å¤±é‡è¦çš„è®¾ç½®. å¯åœ¨ä¸‹é¢æŸä»£ç å—ä¸­tangleè¯¥æ–‡ä»¶æ‰€æœ‰çš„code blocks, ä¸è¦åœ¨
narrowed bufferä¸­tangle.
*** doc/header
#+name: ad772025
#+begin_src elisp
;; -*- no-byte-compile: t; -*-
;;; $DOOMDIR/packages.el

;; To install a package with Doom you must declare them here, run 'doom sync' on
;; the command line, then restart Emacs for the changes to take effect.
;; Alternatively, use M-x doom/reload.
;;
;; WARNING: Disabling core packages listed in ~/.emacs.d/core/packages.el may
;; have nasty side-effects and is not recommended.


;; All of Doom's packages are pinned to a specific commit, and updated from
;; release to release. To un-pin all packages and live on the edge, do:
;(unpin! t)

;; ...but to unpin a single package:
;(unpin! pinned-package)
;; Use it to unpin multiple packages
;(unpin! pinned-package another-pinned-package)


;; To install SOME-PACKAGE from MELPA, ELPA or emacsmirror:
;(package! some-package)

;; To install a package directly from a particular repo, you'll need to specify
;; a `:recipe'. You'll find documentation on what `:recipe' accepts here:
;; https://github.com/raxod502/straight.el#the-recipe-format
;(package! another-package
;  :recipe (:host github :repo "username/repo"))

;; If the package you are trying to install does not contain a PACKAGENAME.el
;; file, or is located in a subdirectory of the repo, you'll need to specify
;; `:files' in the `:recipe':
;(package! this-package
;  :recipe (:host github :repo "username/repo"
;           :files ("some-file.el" "src/lisp/*.el")))

;; If you'd like to disable a package included with Doom, for whatever reason,
;; you can do so here with the `:disable' property:
;(package! builtin-package :disable t)

;; You can override the recipe of a built in package without having to specify
;; all the properties for `:recipe'. These will inherit the rest of its recipe
;; from Doom or MELPA/ELPA/Emacsmirror:
;(package! builtin-package :recipe (:nonrecursive t))
;(package! builtin-package-2 :recipe (:repo "myfork/package"))

;; Specify a `:branch' to install a package from a particular branch or tag.
;; This is required for some packages whose default branch isn't 'master' (which
;; our package manager can't deal with; see raxod502/straight.el#279)
;(package! builtin-package :recipe (:branch "develop"))
#+end_src

*** ç”±äºç½‘ç»œåŸå› , æš‚æ—¶è¿‡æ¸¡
#+name: fbd6e323
#+begin_src elisp
(package! org-pdftools :recipe (:host github :repo "fuxialexander/org-pdftools"))
(package! org-superstar :recipe (:host github :repo "integral-dw/org-superstar-mode"))
#+end_src

*** éœ€è¦å®‰è£…çš„åŒ…
- cnfonts: ä¸­æ–‡æ˜¾ç¤º
- golden-ratio: è‡ªåŠ¨æ”¾å¤§å½“å‰window
- fcitx è‡ªåŠ¨ä¸­è‹±æ–‡åˆ‡æ¢
- ä¿®æ”¹ç‰ˆmaterial-theme
  - æ”¹å°org-headingå­—ä½“çš„scalingç³»æ•°
  - è°ƒæ•´TODO, DONEçš„è°ƒè‰², åˆ«é‚£ä¹ˆåˆºçœ¼

#+name: d8f41362
#+begin_src elisp
;; (package! berrys-theme)
;; (package! material-theme)
(package! material-theme
          :recipe (:host github :repo "ybyygu/emacs-material-theme"))
#+end_src

#+name: 8192c3d2
#+begin_src elisp
(package! el-patch)
#+end_src

ç»Ÿè®¡å‘½ä»¤ä½¿ç”¨é¢‘ç‡, æ–¹ä¾¿ä¼˜åŒ–å¿«æ·é”®
#+begin_src elisp
(package! keyfreq)
#+end_src

org-noter
#+begin_src emacs-lisp
(package! org-noter)
#+end_src

- ä½¿ç”¨deadgrepæœç´¢ .note ç¬”è®°
- ä¸doomçš„popupæœ‰å†²çª, ä¸èƒ½ç”¨
#+begin_src emacs-lisp :tangle no
(package! deadgrep
          :recipe (:host github :repo "ybyygu/deadgrep"))
#+end_src

ç¼–è¾‘nixåŒ…ç®¡ç†æ–‡ä»¶
#+begin_src elisp
(package! nix-mode)
#+end_src

*** éœ€è¦ç¦ç”¨çš„åŒ…
- TABè‡ªåŠ¨è¡¥å…¨å¾ˆå¯æ€•, æ— æ„æŒ‰é”®, è¡¥å‡ºå¾ˆå¤šæ²¡ç”¨çš„ä¸œè¥¿, ç¦ç”¨è‡ªå¸¦çš„æ¨¡æ¿.
#+name: 4916a8ab
#+begin_src emacs-lisp
(package! doom-snippets :ignore t)
#+end_src

githubæ”¯æŒ, å‡æ…¢é€Ÿåº¦.
#+name: e5ee47b4
#+begin_src emacs-lisp
(package! forge :ignore t)
;; ä¸èƒ½ç®€å•çš„ç¦ç”¨äº†äº‹
;; (package! github-review :ignore t)
#+end_src

*** æµ‹è¯•
#+name: 5dc509d3
#+begin_src elisp
(package! dired-sidebar)
(package! dockerfile-mode)
(package! yaml-mode)
(package! yaml-mode)

;; https://github.com/org-roam/org-roam-ui#doom
;; 2021-08-01 ç”¨ä¸èµ·æ¥
(package! websocket)
(package! simple-httpd)
(package! org-roam-ui :recipe (:host github :repo "org-roam/org-roam-ui" :files ("*.el" "out")))

(package! org-transclusion
  :recipe (:host github
           :repo "nobiot/org-transclusion"
           :branch "main"
           :files ("*.el")))
#+end_src
* user-lisp
é…ç½®å„ç§åŒ…æˆ–è‡ªå®šä¹‰çš„åŒ…
** dwim
ä¸´æ—¶æŒ‰é”®ç»‘å®š. è¿™å’Œhydraç­‰ç±»ä¼¼äº†
#+begin_src elisp :tangle no
(defun gwp::dwim ()
  (interactive)
  (set-temporary-overlay-map
   (let ((map (make-sparse-keymap)))
     (define-key map (kbd "<right>")	'org-next-block)
     (define-key map (kbd "<left>") 	'org-previous-block)
     map) t))

(defun my-setup-extra-keymap (extra-fn-list hint fn &rest args)
  "Map EXTRA-FN-LIST to new keymap and show HINT after calling FN with ARGS."
  (let ((echo-keystrokes nil))
    (when fn (apply fn args))
    (message hint)
    (set-transient-map
     (let ((map (make-sparse-keymap)))
       (dolist (item extra-fn-list)
         (define-key map (kbd (nth 0 item)) (nth 1 item)))
       map)
     t)))

(defun my-navigate ()
  (interactive)
  (my-setup-extra-keymap '(("k" org-up-element)
                           ("p" org-down-element)
                           ("f" my-open-pdf-from-history))
                         "PDF: [k]up [j]down [p]revious-page [n]ext-page [g]oto [f]rom-history [q]uit"
                         nil))
#+end_src

** init-proxy.el
:PROPERTIES:
:header-args: :tangle user-lisp/init-proxy.el
:END:
[[https://www.scanbuf.net/post/manual/proxy/][è®¾ç½®ä»£ç† - å¦‚ä½•è‡ªå®šä¹‰ç¼–è¾‘å™¨ - 7ym0n - ä¸ªäººæŠ€æœ¯åˆ†äº«ï¼Œè®°å½•ç”Ÿæ´»]]

#+name: 20064129
#+begin_src elisp
;; (defvar default-proxy "127.0.0.1:8889")
(defvar default-proxy "127.0.0.1:10808")
(defvar socks-server)
(defvar socks-noproxy)
;; Network Proxy
(defun proxy-http-show ()
  "Show HTTP/HTTPS proxy."
  (interactive)
  (if url-proxy-services
      (message "Current HTTP proxy is `%s'" default-proxy)
    (message "No HTTP proxy")))

(defun proxy-http-enable ()
  "Enable HTTP/HTTPS proxy."
  (interactive)
  (setq url-proxy-services
        `(("http" . ,default-proxy)
          ("https" . ,default-proxy)
          ("no_proxy" . "^\\(localhost\\|192.168.*\\|10.*\\)")))
  (proxy-http-show))

(defun proxy-http-disable ()
  "Disable HTTP/HTTPS proxy."
  (interactive)
  (setq url-proxy-services nil)
  (proxy-http-show))

(defun proxy-http-toggle ()
  "Toggle HTTP/HTTPS proxy."
  (interactive)
  (if (bound-and-true-p url-proxy-services)
      (proxy-http-disable)
    (proxy-http-enable)))

(defun proxy-socks-show ()
  "Show SOCKS proxy."
  (interactive)
  (when (fboundp 'cadddr)                ; defined 25.2+
    (if (bound-and-true-p socks-noproxy)
        (message "Current SOCKS%d proxy is %s:%d"
                 (cadddr socks-server) (cadr socks-server) (caddr socks-server))
      (message "No SOCKS proxy"))))

(defun proxy-socks-enable ()
  "Enable SOCKS proxy."
  (interactive)
  (require 'socks)
  (let* ((proxy (split-string default-proxy "\\s-*:\\s-*"))
         (addr (car proxy))
         (port (string-to-number (cadr proxy))))
    (setq url-gateway-method 'socks
          socks-noproxy '("localhost")
          socks-server `("Default server" ,addr ,port 5)))
  (proxy-socks-show))

(defun proxy-socks-disable ()
  "Disable SOCKS proxy."
  (interactive)
  (setq url-gateway-method 'native
        socks-noproxy nil)
  (proxy-socks-show))

(defun proxy-socks-toggle ()
  "Toggle SOCKS proxy."
  (interactive)
  (if (bound-and-true-p socks-noproxy)
      (proxy-socks-disable)
    (proxy-socks-enable)))
(provide 'init-proxy)
#+end_src

** init-dired.el
:PROPERTIES:
:header-args: :tangle user-lisp/init-dired.el
:END:
- [[https://www.emacswiki.org/emacs/DiredOmitMode][EmacsWiki: Dired Omit Mode]]

#+name: edd7000d
#+begin_src emacs-lisp
(use-package dired
  :config
  ;; Set this variable to non-nil, Dired will try to guess a default
  ;; target directory. This means: if there is a dired buffer
  ;; displayed in the next window, use its current subdir, instead
  ;; of the current subdir of this dired buffer. The target is used
  ;; in the prompt for file copy, rename etc.
  (progn
    ;; å®‰å…¨ç¬¬ä¸€
    (setq delete-by-moving-to-trash t)
    ;; æ–¹ä¾¿å¤šä¸ªæ–‡ä»¶å¤¹æ–‡ä»¶äº’åŠ¨
    (setq dired-dwim-target t)

    ;; Dired listing switches
    ;;  -a : Do not ignore entries starting with .
    ;;  -l : Use long listing format.
    ;;  -G : Do not print group names like 'users'
    ;;  -h : Human-readable sizes like 1K, 234M, ..
    ;;  -v : Do natural sort .. so the file names starting with . will show up first.
    ;;  -F : Classify filenames by appending '*' to executables,
    ;;       '/' to directories, etc.
    (setq dired-listing-switches "-alGhvF --group-directories-first") ; default: "-al"

    ;; ç”¨äºåœ¨diredä¸­å¤åˆ¶å½“å‰æ–‡ä»¶çš„å…¨è·¯å¾„.
    (defun gwp/dired-copy-file-path()
      (interactive)
      (let ((current-prefix-arg '(0)))
        (call-interactively 'dired-copy-filename-as-kill)))

    (map! :map dired-mode-map
          :localleader
          :desc "Copy file path"
          :n "y" #'gwp/dired-copy-file-path
          :desc "Make symlink"
          :n "l" #'dired-do-symlink
          :desc "Async shell command"
          :n "!" #'dired-do-async-shell-command
          )

    ;; ä½¿ç”¨BACKSPACEæ¥ä¸Šä¸€çº§ç›®å½•, ä½¿ç”¨Ctrl-shift-næ¥æ–°å»ºç›®å½•(é»˜è®¤ä¸º"+")
    (map! :map dired-mode-map
          :nv "DEL"   #'dired-up-directory       ; BACKSPACE
          :nv "C-S-n" #'dired-create-directory
          )))

;;;###autoload
(defun gwp::dired::symbol-link-at-point-to-home ()
  "åœ¨ dired ä¸­, å°†å…‰å‰æ–‡ä»¶è½¯é“¾æ¥åˆ° HOME ä¸‹, æ–¹ä¾¿å¿«é€Ÿè®¿é—®(æ¯”å¦‚åœ¨
virtualbox /windows ä¸­)"
  (interactive)

  (if (derived-mode-p 'dired-mode)
      (let ((this-file (dired-get-file-for-visit))
            (target-path "~/00-dired-tmp-entry-point"))
        (make-symbolic-link this-file target-path)
        (message "symlink to: %s" target-path))
    (user-error "not in dired buffer")))
#+end_src

éšè—.dotfiles, doomä¸­é»˜è®¤omitçš„å¤ªå°‘
#+name: 67102cd3
#+begin_src emacs-lisp
(use-package dired-x
  :config
  (progn
    (setq dired-omit-verbose t)
    ;; (add-hook 'dired-mode-hook #'dired-omit-mode)
    (setq dired-omit-files (concat dired-omit-files "\\|^\\..+$"))))

(provide 'init-dired)
#+end_src

** init-eaf.el
:PROPERTIES:
:header-args: :tangle user-lisp/init-eaf.el
:END:
å¯ä»¥å…ˆç”¨ eaf å®‰è£…è„šæœ¬è£…å¥½ç›¸å…³åŒ…å³å¯æ­£å¸¸ä½¿ç”¨.
- [[https://github.com/emacs-eaf/eaf-pdf-viewer][emacs-eaf/eaf-pdf-viewer: Fastest PDF Viewer in Emacs]]
- [[https://github.com/emacs-eaf/emacs-application-framework/pull/267][Eaf interleave by luhuaei Â· Pull Request #267 Â· emacs-eaf/emacs-application-framework]]

#+name: 7d6d2068
#+begin_src elisp
(use-package eaf
  :load-path "~/.emacs.d/site-lisp/emacs-application-framework"
  :after org
  :config
  ;;(use-package eaf-video-player)
  ;; (require 'eaf-file-manager)
  ;; (require 'eaf-browser)
  ;; (require 'eaf-image-viewer)
  (require 'eaf-pdf-viewer)
  (require 'eaf-demo)
  (require 'eaf-org)
  (require 'eaf-interleave)
  ;; (require 'eaf-terminal)

  (defun eaf-org-open-file (file &optional link)
    "An wrapper function on `eaf-open'."
    (eaf-open file))

  ;; use `emacs-application-framework' to open PDF file: link
  (add-to-list 'org-file-apps '("\\.pdf\\'" . eaf-org-open-file))

  ;; ä¿®å¤ evil æŒ‰é”®é—®é¢˜. è¿™é‡Œéœ€è¦å¯ç”¨ eaf-browser æ”¯æŒ, ä¸ç„¶ä¼šæŠ¥é”™
  (require 'eaf-evil)
  (define-key key-translation-map (kbd "SPC")
    (lambda (prompt)
      (if (derived-mode-p 'eaf-mode)
          (pcase eaf--buffer-app-name
            ("pdf-viewer" (kbd eaf-evil-leader-key))
            (_  (kbd "SPC")))
        (kbd "SPC"))))

  :custom
  ;; See https://github.com/emacs-eaf/emacs-application-framework/wiki/Customization
  ;; (eaf-browser-continue-where-left-off t)
  ;; (eaf-browser-enable-adblocker t)
  (eaf-pdf-dark-mode nil)
  ;; (browse-url-browser-function 'eaf-open-browser)
  )

(provide 'init-eaf)
#+end_src
** init-magit.el
:PROPERTIES:
:header-args: :tangle user-lisp/init-magit.el
:END:
git-timemachineå¯ç”¨æ¥çœ‹æ–‡ä»¶çš„ä¸åŒç‰ˆæœ¬(C-n, C-p): git-timemache-mode-map. é»˜è®¤ç”¨ SPC-g-t æ¥æ¿€æ´».

magit-todosç”¨æ¥æŸ¥çœ‹ä»£ç çš„TODO, FIXMEç­‰æ ‡è®°. æŒ‰é”®: SPC-p-t
- [[https://github.com/alphapapa/magit-todos][alphapapa/magit-todos: Show source files' TODOs (and FIXMEs, etc) in Magit status buffer]]

magit-status-mode-map

#+name: 5587631c
#+begin_src elisp
(use-package magit
  :config
  ;; éšè—untrackedæ–‡ä»¶åˆ—è¡¨. æ›´å¤šæ—¶å€™çš„æ“ä½œæ˜¯stage/commit
  (setq magit-section-initial-visibility-alist (quote ((untracked . hide))))
  ;;ç¦ç”¨magitä¸­çš„gravatarsæ”¯æŒ, å“åº”èƒ½å¿«ä¸€äº›.
  (setq magit-revision-show-gravatars nil)
  ;; è¿›å…¥ magit-status å, å°†å…‰æ ‡å®šåœ¨ unstaged ä¸€æ 
  (setq magit-status-initial-section '(2))
  )

(provide 'init-magit)
#+end_src

** init-note.el
:PROPERTIES:
:header-args: :tangle user-lisp/init-note.el
:END:
*** docs
ä»¿ org-noter ä½†, ç®€åŒ–æ“ä½œ, ä¸ä¾èµ–äº pdf-tools ç­‰åŒ…, å¯ä½¿ç”¨å¤–éƒ¨çš„ pdf é˜…è¯»å™¨æ¥å¤„
ç† pdf æ–‡ä»¶.

pdf-tools çš„ç¼ºç‚¹æ˜¯å¤ªæ…¢äº†, llpp è¦å¿«å¾—å¤š, é€‚åˆçœ‹ç¨å¤§ä¸€äº›çš„æ–‡ä»¶. ä½¿ç”¨ llpp æ¥æ‰“å¼€
org-noter ç”Ÿæˆçš„note, ç”¨äºæ‰“å¼€æ‰“å®šçš„ PDF é¡µé¢.

: okular foo.pdf -p 5
: evince foo.pdf -p 5
: llpp foo.pdf -page 5

æ‰¹æ³¨æµç¨‹
- ä½¿ç”¨ dired æ‰“å¼€æŸä¸ª pdf æ–‡ä»¶, ç„¶å ",nn", åœ¨ pdf æ‰€åœ¨ç›®å½•ç”Ÿæˆå¹¶æ‰“å¼€ annotation.note.
- åœ¨ org-mode ä¸‹, è‡ªå»º heading, ",ni", æ’å…¥ property, æ ‡æ˜ pdf é¡µç ä¿¡æ¯.
- åœ¨æŸ heading ä¸‹, ",no", æ‰“å¼€è¯¥ heading å¯¹åº”çš„ pdf æ–‡ä»¶åŠç›¸åº”çš„é¡µç 

å¦å¤–, é€šè¿‡ [[https://github.com/ymarco/paper-mode][ymarco/paper-mode]], ä¹Ÿå¯ä»¥æŠŠ llpp æ”¾åˆ° emacs buffer ä¸­.

*** require
è¿˜æ˜¯åŸºäº org-noter æ¥å¼€å‘, èƒ½çœä¸€äº›äº‹æ˜¯ä¸€äº›.
#+begin_src elisp
(require 'org-noter)
#+end_src

*** create file
#+name: 8a535ad4
#+begin_src elisp
(defun gwp::org-note::create-annotation-file (document-path)
  (let* ((note-file "annotation.note")
         (document-name (file-name-nondirectory document-path))
         (document-base (file-name-base document-name)))
    (with-current-buffer (switch-to-buffer (find-file-noselect note-file))
      (goto-char (point-max))
      (insert "* " document-base)
      (org-set-property org-noter-property-doc-file document-name)
      (save-buffer))))

;;;###autoload
(defun gwp::org-note::dired-annotate-file-at-point ()
  "æ ‡æ³¨ dired buffer ä¸­æ‰€å®šçš„(pdf)æ–‡ä»¶"
  (interactive)
  (if (derived-mode-p 'dired-mode)
      (gwp::org-note::create-annotation-file (dired-get-file-for-visit))
    (user-error "not in dired buffer")))
#+end_src

*** open
#+name: 1773f1a3
#+begin_src elisp
(defun gwp::org-note::get-pdf-file ()
  (save-excursion
    (if (search-backward ":NOTER_DOCUMENT" nil t)
        (progn
          (org-back-to-heading)
          (let ((pdf (org-element-property :NOTER_DOCUMENT (org-element-at-point))))
            (message "%s" pdf)))
      (message "no pdf doc found"))))

(defun gwp::org-note::get-pdf-page ()
  (save-excursion
    (org-back-to-heading)
    (let ((property (org-element-property :NOTER_PAGE (org-element-at-point))))
      (let ((value (car (read-from-string property))))
        (cond
         ((consp value) (car value))
         (t value))))))

;;;###autoload
(defun gwp::org-note::new-note ()
  "åœ¨å½“å‰ heading ä¸‹æ’å…¥æ–°çš„æ–‡çŒ®é˜…è¯»ç¬”è®°"
  (interactive)
  ;; (let ((current-prefix-arg '(4)))     ; C-u
  ;;   (call-interactively #'org-insert-heading))
  ;; (insert (read-string "ç¬”è®°æ ‡é¢˜: "))
  (if (org-at-heading-p)
      (let ((page (read-number "PDF é¡µç : " 1)))
        (org-set-property "NOTER_PAGE" (number-to-string page)))
    (user-error "not at org heading.")))

;;;###autoload
(defun gwp::org-note::open-pdf ()
  "ä½¿ç”¨ llpp æ¥æ‰“å¼€å½“å‰ç¬”è®°å¯¹åº”çš„ pdf æ–‡ä»¶, å¹¶è½¬åˆ°æŒ‡å®šçš„é¡µç "
  (interactive)
  (let ((page (gwp::org-note::get-pdf-page))
        (pdf (gwp::org-note::get-pdf-file)))
    (if page
        (start-process "llpp" nil "llpp" pdf "-page" (format "%s" page))
      ;; (start-process "okular" nil "okular" pdf "-p" (format "%s" page))
      (start-process "llpp" nil "llpp" pdf)
      ;; (start-process "okular" nil "okular" pdf)
      )))
#+end_src


*** provide
#+name: 8d4b377b
#+begin_src elisp
(provide 'init-note)
#+end_src

* modules/gwp
ä½¿ç”¨doomçš„æ–¹å¼æ¥ç»„ç»‡ä»£ç , è¿™æ ·çš„å¥½å¤„æ˜¯packageså¯ä»¥æ¨¡å—åŒ–æ¥å®šä¹‰, é¿å…tangleæ—¶ä¸å°å¿ƒå‡ºé—®é¢˜.
** ui
:PROPERTIES:
:header-args: :tangle pkg/.doom.d/modules/gwp/ui/config.el
:END:
*** wrap long line
æ›´ä¹ æƒ¯æ‰‹åŠ¨æŠ˜è¡Œ
#+name: a6f83332
#+begin_src elisp
;; é»˜è®¤ä¸è¦æ˜¾ç¤ºæŠ˜è¡Œ
(global-visual-line-mode -1)

(defun gwp::turn-off-wrap-long-line()
  (global-visual-line-mode -1))
(add-hook 'org-mode-hook 'gwp::turn-off-wrap-long-line)
#+end_src
*** blink cursor
è®©å…‰æ ‡åŠ¨èµ·æ¥, æ›´é†’ç›®
#+name: 4e3b4060
#+begin_src elisp
(blink-cursor-mode 1)
#+end_src

*** line numbers
å¦‚æœèƒ½æ˜¾ç¤ºç›¸å¯¹è¡Œå·, avy-goto-lineå¯èƒ½å°±æ²¡å¿…è¦äº†?
#+name: 885c9fa9
#+begin_src elisp
;; æ–¹ä¾¿ç»‘å®šåˆ° SPC-t-l
;;
;; ä»…åˆ‡æ¢relativeå’Œnoneä¸¤ç§çŠ¶æ€, doomçš„è¦åˆ‡ä¸‰ç§
(defun gwp::toggle-line-numbers ()
  (interactive)
  (if display-line-numbers
      (setq display-line-numbers 'nil)
    (setq display-line-numbers 'relative)))

(defun gwp::display-line-numbers ()
  (setq display-line-numbers 'relative))

;; NOTE: org-modeåœ¨æŠ˜å çŠ¶æ€ä¸‹, ç›¸å¯¹è¡Œå·æ˜¾ç¤ºçš„æ˜¯å®é™…æ•°ç›®, è€ŒéæŠ˜å åçš„, è¿™å¯¹ç¼–è¾‘æ“ä½œæ²¡å¤šå¤§å¸®åŠ©äº†.
;; ;; (add-hook 'org-mode-hook #'gwp::display-line-numbers)
(add-hook 'org-src-mode-hook #'gwp::display-line-numbers)
;; (add-hook 'prog-mode-hook #'gwp::display-line-numbers)
(add-hook 'rust-mode-hook #'gwp::display-line-numbers)

;; å…¨å±€è®¾ç½®
;; (setq display-line-numbers-type 'relative)
#+end_src

*** window/frame
**** ä¿®æ”¹ frame æ ‡é¢˜ æ–¹ä¾¿ gnome-shell æ¡Œé¢åˆ‡æ¢
#+begin_src elisp
;; workspace@buffer-name: ~/foo/bar
(setq frame-title-format
      '((:eval (+workspace-current-name)) ;
        " | %b : "
        (:eval (if (buffer-file-name)
                   (abbreviate-file-name (buffer-file-name))))
        ))
#+end_src

**** æ”¾å¤§çª—å£
è‡ªåŠ¨æ”¾å¤§å½“å‰çª—å£. æ³¨æ„, è¿™ç±»å·¥å…·é€šè¿‡å’Œdoomçš„popup windowæœ‰å†²çª. éœ€è¦çš„æ—¶å€™å‘½ä»¤æ‰‹
åŠ¨å¼€å¯.
- https://github.com/hlissner/doom-emacs/issues/2225

å¯¹åº”å‘½ä»¤: SPC-w z
#+name: bfacbb8e
#+begin_src elisp
(use-package! golden-ratio
  :config
  (map! :map evil-window-map
        "z" #'golden-ratio))
#+end_src

doomå†…ç½®äº†å‡ ä¸ªå‘½ä»¤:
- æ°´å¹³æ”¾å¤§: SPC-w-m-s
- å‚ç›´æ”¾å¤§: SPC-w-m-v

#+name: 9f0e3550
#+begin_src elisp
(map! :map evil-window-map
      "1"       #'doom/window-maximize-buffer
      "o"       #'doom/window-maximize-buffer ;show "only"
      "t"       #'doom/window-maximize-vertically ;show top
      )
#+end_src

æ–°å»ºframeæ—¶æœ€å¤§åŒ–çª—å£
#+name: 9a32eb12
#+begin_src elisp
(add-to-list 'default-frame-alist '(fullscreen . maximized))
#+end_src

**** çª—å£ç®¡ç†
[[https://github.com/abo-abo/ace-window][abo-abo/ace-window: Quickly switch windows in Emacs]]

ç”¨avyåœ¨å¤šä¸ªçª—å£ä¸‹è·³è½¬ä¹Ÿå¾ˆæ–¹ä¾¿

#+name: 19f082d3
#+begin_src elisp
(use-package! avy
  :config
  (setq avy-all-windows t))

;; æ›¿ä»£ SPC-w-w
;; (global-set-key [remap evil-window-next] #'ace-window)
;; (map! [remap evil-window-next] #'ace-window)

(map! :map evil-window-map
      "w" #'ace-window
      "r" #'ace-swap-window   ; rotate
      "c" #'ace-delete-window ; close
      "f" #'tear-off-window   ; ç±»ä¼¼äºfirefoxä¸­çš„æ ‡ç­¾å˜çª—å£ (float, move to new frame)
      "F" #'follow-mode       ; åŒæ­¥æ»šåŠ¨çª—å£, å¯ç”¨äºåŒçª—å£å†…å®¹å¯¹æ¯”ç­‰
      )
#+end_src

åˆ‡æ¢è‡³å‰ä¸€ä¸ªæœ€è¿‘è®¿é—®çš„bufferæ‰€åœ¨çš„window, evil-window-mru
: SPC-w-p

æ’¤æ¶ˆæˆ–æ¢å¤ä¹‹å‰çš„çª—å£å¸ƒå±€
: SPC-w-u, SPC-w C-r

**** å¼¹å‡ºçª—å£
æ‰“å¼€doom popupçª—å£, é»˜è®¤ä»…åœ¨normal stateä¸‹å¯ç”¨.
#+begin_src emacs-lisp
(map! :i "C-`" #'+popup/toggle)
#+end_src

**** çª—å£å¤§å°
ä½¿ç”¨æ»šè½®æ¥ä¿®æ”¹çª—å£å¤§å°. Ctrl-Alt-scroll-up, Ctrl-Alt-scroll-down
#+name: 032e71c0
#+begin_src elisp
(map! :nvi
      [C-M-mouse-4] #'evil-window-increase-width
      [C-M-mouse-5] #'evil-window-decrease-width
      )
#+end_src

- [[https://stackoverflow.com/questions/51879921/emacs-find-file-other-window-command-splits-buffer-vertically][Emacs find-file-other-window command splits buffer vertically - Stack Overflow]]

è®¾ç½®åˆ†å±é˜ˆå€¼, é¿å… find-file-other-window å‚ç›´å‘åˆ†å‰²ä¸ºå¤šä¸ªwindows
#+begin_src elisp
(setq split-width-threshold 200)        ; default is 160
#+end_src

hydraç‰¹åˆ«é€‚åˆéœ€è¦é‡å¤æŒ‰é”®æ¥å®Œæˆçš„æ“ä½œ, æ¯”å¦‚è°ƒæ•´çª—å£å¤§å°.
#+name: f07dc327
#+begin_src elisp
(defhydra gwp/adjust-window-size ()
  "resize-window"
  ("h" evil-window-decrease-width "decrease width")
  ("j" evil-window-decrease-height "decrease height")
  ("k" evil-window-increase-height "increase height")
  ("l" evil-window-increase-width "increase width")
  ("q" nil "quit")
  )

(map! :map evil-window-map
      "a"       #'gwp/adjust-window-size/body ; adjust
      )
#+end_src

**** new frame
tear-off-window
#+name: 19e08aef
#+begin_src elisp
(defun gwp::display-current-buffer-other-frame ()
  "åœ¨å…¶å®ƒ frame ä¸­æ˜¾å¼å½“å‰ buffer"
  (interactive)
  (switch-to-buffer-other-frame (current-buffer)))
#+end_src

**** clone buffer
clone å‡ºçš„ buffer å¯ç‹¬ç«‹ç¼–è¾‘, è§†å›¾å˜åŒ–äº’ä¸å½±å“. æœ‰ç”¨.
: clone-indirect-buffer-other-window
: clone-indirect-buffer

**** switch buffer
è¿™å‡ ä¸ªå‘½ä»¤æŒºæœ‰ç”¨, ä¸è¿‡åœ¨ ivy æ¡†æ¶ä¸‹ä½¿ç”¨åº”æ›´ä¾¿åˆ©. æ¯”å¦‚ ivy-switch-buffer æ—¶, å¯æŒ‰
C-o é€‰å–ç›¸åº”çš„ action, æ¥æ“ä½œé€‰å®šçš„ buffer.

: switch-to-buffer-other-window
: switch-to-buffer-other-frame
: switch-to-buffer-other-tab
: switch-to-buffer

ä»ä»¥ä¸‹å˜é‡å¯æŸ¥çœ‹ ivy é»˜è®¤å®šä¹‰çš„ actions
: ivy--actions-list

#+name: bf66c13f
#+begin_src elisp
(require 'ivy)
(ivy-set-actions
 ;; ä»¥ä¸‹ä¼šè¦†ç›–é»˜è®¤å®šä¹‰çš„, æ‰€ä»¥éœ€è¦è¡¥å›
 'ivy-switch-buffer
 '(
   ("f" ivy--find-file-action "find file")
   ("j" switch-to-buffer-other-window "other window")
   ("k" ivy--kill-buffer-action "kill")
   ("r" ivy--rename-buffer-action "rename")
   ("x" counsel-open-buffer-file-externally "open externally")
   ("f" switch-to-buffer-other-frame "other frame") ; é»˜è®¤æ²¡æœ‰
   ("t" switch-to-buffer-other-tab "other tab")     ; é»˜è®¤æ²¡æœ‰
   ))
#+end_src

*** big font mode
:PROPERTIES:
:header-args: :tangle no
:END:
#+begin_src elisp
;; HiDPIä¸‹å¯ç”¨å¤§å­—æ¨¡å¼: SPC-t-b
(setq doom-font (font-spec :family "Monaco" :size 14))
(setq doom-big-font-increment 4)

;; (add-hook! doom-big-font-mode-hook #'(gwp/set-fonts))
;; ä¸Šé¢çš„ä¸ç®¡ç”¨
(setq doom-big-font-mode-hook '(gwp/set-fonts))
(doom-big-font-mode -1)
#+end_src

*** chinese/input method
é»˜è®¤ä½¿ç”¨ Ctrl-\ åˆ‡æ¢è¾“å…¥æ³•
**** rime
- [[https://github.com/DogLooksGood/emacs-rime][DogLooksGood/emacs-rime: RIME ã„“ in Emacs]]

å¯ä»¥ç”¨TABæ¥ä¸´æ—¶è¾“å…¥è‹±æ–‡. å¯ä»¥ç”¨Ctrl-.æ¥ä¸´æ—¶åˆ‡æ¢ä¸­è‹±æ–‡æ ‡ç‚¹. åœ¨è¾“å…¥è¿‡ç¨‹ä¸­, æŒ‰zé”®ä¸´æ—¶æ‹¼éŸ³æ¨¡å¼.
rime-inline-predicates

rime ä¼šæ ¹æ®è¾“å…¥çŠ¶æ€, æ™ºèƒ½è¿›å…¥è‹±æ–‡è¾“å…¥æ¨¡å¼. æ­¤æ—¶, å¯ç”¨ C-i é”®æ¥å¼ºåˆ¶ä¸´æ—¶å½•å…¥(ä¸€ä¸ª)
ä¸­æ–‡å•å­—, éšåç»§ç»­è‹±æ–‡è¾“å…¥æ¨¡å¼. ä¸ºäº†æ›´æµç•…çš„ä¸­è‹±æ–‡çŠ¶æ€æ™ºèƒ½åˆ‡æ¢, å¾—è®°å¾—å›å½’ç©ºæ ¼åˆ†
éš”ä¸­è‹±æ–‡å­—ç¬¦è¿™ä¸€ä¼˜ç§€ä¼ ç»Ÿ.

***** setup
#+name: 155b72b3
#+begin_src elisp
(use-package! rime
  :custom
  (default-input-method "rime")
  :config
  (setq rime-user-data-dir "~/.local/share/fcitx5/rime")
  ;; è¿™ä¸ªè®¾ç½®ä¸rimeçš„ä¸€è‡´, ä¸ç„¶emacsä¸­çš„inline asciiæ— æ³•ç”Ÿæ•ˆ
  ;;; support shift-l, shift-r, control-l, control-r
  (setq rime-inline-ascii-trigger 'shift-l)
  ;; ä¸´æ—¶è‹±æ–‡ä¸­é˜»æ­¢æ ‡ç‚¹ç›´æ¥ä¸Šå±
  (setq rime-inline-ascii-holder ?x)      ; Any single character that not trigger auto commit
  ;; æ·»åŠ C-.å¿«æ·é”®, æ–¹ä¾¿åˆ‡æ¢ä¸­è‹±æ–‡æ ‡ç‚¹(éœ€è¦åœ¨rimeè¾“å…¥æ—¶æœ‰æ•ˆ)
  (setq rime-translate-keybindings
        '("C-f" "C-b" "C-n" "C-p" "C-g" "C-."))
  ;; åœ¨è¾“å…¥ä¸”æœ‰ç ä¸Šå±çš„çŠ¶æ€ä¸‹, å¯ç”¨TABä¸´æ—¶åˆ‡æ¢è‹±æ–‡.
  (map! :map rime-active-mode-map :after ivy [tab] 'rime-inline-ascii)
  ;; NOTE: ä»¥ä¸‹æœ‰æ—¶ä¼šè®©emacs crash
  (setq rime-posframe-properties
        (list :background-color "#333333"
              :foreground-color "#dcdccc"
              :internal-border-width 10))
  (setq default-input-method "rime"
        rime-show-candidate 'posframe)

  ;; è‡ªåŠ¨è¿›å…¥è‹±æ–‡å½•å…¥çŠ¶æ€, ç›¸å½“äºç›´æ¥è¾“å…¥è‹±æ–‡
  (setq rime-disable-predicates
        '(
          evil-normal-state-p
          ;; é¦–å­—æ¯ä¸ºæ˜¯è‹±æ–‡å­—æ¯æ—¶è¿›å…¥è‹±æ–‡æ¨¡å¼
          rime-predicate-after-alphabet-char-p
          ;; å°†è¦è¾“å…¥çš„ä¸ºå¤§å†™å­—æ¯æ—¶
          rime-predicate-current-uppercase-letter-p
          ;; åœ¨ prog-mode å’Œ conf-mode ä¸­é™¤äº†æ³¨é‡Šå’Œå¼•å·å†…å­—ç¬¦ä¸²ä¹‹å¤–çš„åŒºåŸŸ
          rime-predicate-prog-in-code-p
          ;; åœ¨ (La)TeX æ•°å­¦ç¯å¢ƒä¸­æˆ–è€…è¾“å…¥ (La)TeX å‘½ä»¤æ—¶
          rime-predicate-tex-math-or-command-p
          ;; åœ¨ä¸­æ–‡å­—ç¬¦ä¸”æœ‰ç©ºæ ¼ä¹‹å
          ;; rime-predicate-space-after-cc-p
          ))
  ;; è¿›å…¥è¿ç»­è‹±æ–‡çŠ¶æ€, ç©ºæ ¼æˆ–å›è½¦é”®ä¸Šå±
  (setq rime-inline-predicates
        '(
          rime-predicate-space-after-cc-p
          )))
#+end_src

***** convert string at point
æœ‰æ—¶æ²¡å¼€ä¸­æ–‡è¾“å…¥, ä¼šè¯¯è¾“å‡ ä¸ªè‹±æ–‡, æ­¤æ—¶åˆ‡æ¢ä¸­æ–‡æ—¶è‡ªåŠ¨å°†è¯¯å½•çš„è‹±æ–‡è½¬æˆä¸­æ–‡
#+name: b254d4bc
#+begin_src elisp
;; https://github.com/jadestrong/dotfiles/blob/master/home/.doom.d/modules/input/chinese2/config.el
(defun gwp::rime-convert-string-at-point (&optional return-cregexp)
  "å°†å…‰æ ‡å‰çš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºä¸­æ–‡."
  (interactive "P")
  (let ((string
         (if mark-active
             (buffer-substring-no-properties
              (region-beginning) (region-end))
           (buffer-substring-no-properties
            (point) (max (line-beginning-position) (- (point) 80)))))
        code
        length)
    (cond ((string-match "\\([a-z]+\\|[[:punct:]]\\) *$" string)
           (setq code (match-string 0 string))
           (setq length (length code))
           (setq code (replace-regexp-in-string " +" "" code))
           (if mark-active
               (delete-region (region-beginning) (region-end))
             (when (> length 0)
               (delete-char (- 0 length))))
           (when (> length 0)
             (setq unread-command-events
                   (append (listify-key-sequence code)
                           unread-command-events))))
          (t (message "`rime-convert-string-at-point' did nothing.")))))
#+end_src

***** toggle
#+name: 37aafacc
#+begin_src elisp
(defun gwp::rime-toggle-input ()
  "åˆ‡æ¢ rime ä¸­æ–‡è¾“å…¥çŠ¶æ€."
  (interactive)

  (let ((input-method "rime"))
    (toggle-input-method)
    ;; evil ä¸‹, ç›´æ¥è¿›å…¥ insert æ¨¡å¼
    (when (rime-predicate-evil-mode-p)
      (if (= (+ 1 (point)) (line-end-position))
          (evil-append 1)
        (evil-insert 1)))

    ;; è¿›å…¥ rime è¾“å…¥çŠ¶æ€å, æŠŠè¯¯æŒ‰çš„å­—ç¬¦è½¬æ¢ä¸­æ–‡
    (when (string= current-input-method input-method)
      (gwp::rime-convert-string-at-point))

    ;; æç¤ºå½“å‰è¾“å…¥çŠ¶æ€, æ¯”çœ‹å›¾æ ‡æ›´é†’ç›®
    (if current-input-method
        (message "IME on")
      (message "IME off"))))
#+end_src

***** bindings
#+name: c457613c
#+begin_src elisp
;; è¿™é‡Œéœ€è¦ä¸fcitxé…åˆ: å»æ‰GTK_IM_MODULE, XMODIFIERSç­‰FCITXè¾“å…¥æ³•è®¾ç½®å˜é‡.
(map! :nieg "C-SPC" 'gwp::rime-toggle-input)
;; (map! :nieg "C-SPC" 'gwp::rime-force-enable)
;; NOTE: å› ä¸ºä¸ivyçš„é»˜è®¤ç»‘å®šæœ‰å†²çª, minibufferä¸‹ä¸èƒ½åˆ‡æ¢
;; ivy-call-and-recenter
;; 2021-10-13: ç›´æ¥mapä¸å¤ªæœ‰æ•ˆ, æ—¶çµä¸çµçš„
;; (map! :map ivy-minibuffer-map "C-SPC" #'toggle-input-method)
;; NOTE: å¯ç”¨M-RETæ¥é¢„è§ˆé€‰ä¸­æ¡ç›®, è€Œä¸é€€å‡ºivyçª—å£
(map! :after ivy :map ivy-minibuffer-map [remap ivy-call-and-recenter] 'toggle-input-method)

;; å°†å…‰æ ‡è‹±æ–‡å­—ç¬¦è½¬åŒ–ä¸ºä¸­æ–‡å½•å…¥
(map! :map rime-mode-map "M-i" #'gwp::rime-convert-string-at-point)
;; åœ¨è‡ªåŠ¨è‹±æ–‡æ¨¡å¼ä¸‹å¼ºåˆ¶è¿›å…¥ä¸­æ–‡çŠ¶æ€
(map! :map rime-mode-map "C-i" #'rime-force-enable)
#+end_src

**** pyim
:PROPERTIES:
:header-args: :tangle no
:END:
- [[https://tumashu.github.io/pyim/][A Chinese input method which support quanpin, shuangpin, wubi and cangjie. - pyim]]

#+name: 15078428
#+begin_src elisp
(use-package! pyim
  :config
  ;; (setq default-input-method "pyim")

  ;; æˆ‘ä½¿ç”¨äº”ç¬”
  (use-package! pyim-wbdict
    :config (pyim-wbdict-v98-enable))
  (setq pyim-default-scheme 'wubi)

  ;; å¯ç”¨æ‹¼éŸ³å¤§è¯åº“ï¼Œæ–¹ä¾¿å¿˜è¯ç”¨æ‹¼éŸ³åæŸ¥
  (use-package pyim-basedict
    :config (pyim-basedict-enable))
  ;; å¦‚æœç”¨æˆ·åœ¨ä½¿ç”¨äº”ç¬”è¾“å…¥æ³•çš„è¿‡ç¨‹ä¸­ï¼Œå¿˜è®°äº†æŸä¸ªå­—çš„äº”ç¬”ç ï¼Œå¯ä»¥æŒ‰ TAB(F2-TAB)é”®ä¸´æ—¶åˆ‡æ¢åˆ°è¾…åŠ©è¾“å…¥æ³•æ¥è¾“å…¥ï¼Œé€‰è¯å®Œæˆä¹‹åè‡ªåŠ¨é€€å‡ºã€‚
  (setq pyim-assistant-scheme 'quanpin)

  ;; å…¨è§’åŠè§’
  (setq-default pyim-punctuation-half-width-functions
                '(pyim-probe-punctuation-line-beginning
                  pyim-probe-punctuation-after-punctuation))

  ;; ä¸ä½¿ç”¨ä¸­æ–‡æ ‡ç‚¹, å¦‚éœ€è¾“å…¥å¯åˆ‡æ¢è‡³fcitx.
  ;; (delete '("/" "ã€")  pyim-punctuation-dict)
  ;; (add-to-list 'pyim-punctuation-dict '("\\" "ã€"))
  (setq pyim-punctuation-dict nil)
  ;; 2021-10-16 ivyä¸­æ–‡æ‹¼éŸ³æœç´¢. è®¾ç½®ä¸é€š
  (setq ivy-re-builders-alist
        '((t . pyim-cregexp-ivy)))

  ;; è®¾ç½® pyim æ¢é’ˆè®¾ç½®ï¼Œè¿™æ˜¯ pyim é«˜çº§åŠŸèƒ½è®¾ç½®ï¼Œå¯ä»¥å®ç° *æ— ç—›* ä¸­è‹±æ–‡åˆ‡æ¢ :-)
  ;; æˆ‘è‡ªå·±ä½¿ç”¨çš„ä¸­è‹±æ–‡åŠ¨æ€åˆ‡æ¢è§„åˆ™æ˜¯ï¼š
  ;; 1. å…‰æ ‡åªæœ‰åœ¨æ³¨é‡Šé‡Œé¢æ—¶ï¼Œæ‰å¯ä»¥è¾“å…¥ä¸­æ–‡ã€‚
  ;; 2. å…‰æ ‡å‰æ˜¯æ±‰å­—å­—ç¬¦æ—¶ï¼Œæ‰èƒ½è¾“å…¥ä¸­æ–‡ã€‚
  ;; 3. ä½¿ç”¨ M-j å¿«æ·é”®ï¼Œå¼ºåˆ¶å°†å…‰æ ‡å‰çš„æ‹¼éŸ³å­—ç¬¦ä¸²è½¬æ¢ä¸ºä¸­æ–‡ã€‚
  ;; (setq-default pyim-english-input-switch-functions
  ;;               '(
  ;;                 ;; pyim-probe-dynamic-english
  ;;                 pyim-probe-isearch-mode
  ;;                 pyim-probe-program-mode
  ;;                 pyim-probe-org-structure-template
  ;;                 ))

  ;; ä¸ pyim-probe-dynamic-english é…åˆï¼Œæ–¹ä¾¿åˆ‡æ¢è‡³ä¸­æ–‡æ¨¡å¼
  :bind
  (
   ;; ("<f2> SPC" . pyim-convert-string-at-point)
   ;; ("M-SPC" . toggle-input-method)
   (:map pyim-mode-map
    ;; ("<f2> TAB" . pyim-toggle-assistant-scheme)
    ("/" . pyim-toggle-assistant-scheme)
    ("_" . pyim-toggle-input-ascii)
    ("\\" . pyim-toggle-input-ascii)
    ))
  )
#+end_src

**** fcitx
è‡ªåŠ¨ä¸­è‹±æ–‡åˆ‡æ¢, è§£å†³vimæ¨¡å¼ä¸‹çš„ä¸€å¤§ç—›ç‚¹.
#+BEGIN_SRC emacs-lisp :tangle no
(use-package! fcitx
  :after evil
  :config
  (when (executable-find "fcitx-remote")
    ;; (fcitx-prefix-keys-add "M-m")
    ;; å½±å“æœç´¢ç•Œé¢, ä¸åº”è¯¥å¼€
    ;; (setq fcitx-use-dbus t)
    (fcitx-aggressive-setup)
    ))
#+END_SRC

*** chinese/fonts setup
æœ€æ—©ç”¨cnfonts, ä¸è¿‡è¿™ä¸ªä¹Ÿæ¯”è¾ƒéº»çƒ¦. ç°åœ¨ç”¨Sarasaä¹‹ç±»çš„ä¸­è‹±æ–‡ç­‰å®½å­—ä½“, å¯è¾ƒå®Œç¾è§£
å†³ä¸­è‹±æ–‡è¡¨æ ¼å¯¹é½é—®é¢˜

æŸ¥çœ‹å­—ä½“:
: describe-char
#+begin_src elisp :comments nil
;; 2021-08-25: ç•™ç€, ä½†æš‚æ—¶ç”¨ä¸ä¸Š
;; https://emacs-china.org/t/doom-emacs/10390
(defun gwp/set-fonts()
  (interactive)
  (if (display-graphic-p)
      (progn
        ;; english font
        ;; (set-face-attribute 'default nil :font (format "%s:pixelsize=%d" "Monaco" 16)) ;; 11 13 17 19 23
        ;; (setq doom-font (font-spec :family "Monaco" :size 16))
        ;; (setq doom-font (font-spec :family "Monaco"))
        ;; chinese font
        (dolist (charset '(kana han symbol cjk-misc bopomofo))
          (set-fontset-font (frame-parameter nil 'font)
                            charset
                            (font-spec :family "Adobe Heiti Std")))) ;; 14 16 20 22 28
    ))

;; 2021-08-25: ä¸éœ€è¦å•ç‹¬è®¾ç½®äº†
;; org-modeè¡¨æ ¼ä¸­æ–‡æ··æ’å¯¹é½
;; (after! org
;;   ;; (call-interactively 'gwp/set-fonts)
;;   (custom-set-faces!
;;     `(org-table :family "Ubuntu Mono")
;;     )
;;   )

;; for doom-emacs only
;; https://emacs-china.org/t/emacs/15676/20
;; https://github.com/ztlevi/doom-config/blob/main/%2Bui.el
(when (display-graphic-p)
  (setq user-font
        (cond
         ((find-font (font-spec :name  "Sarasa Fixed SC")) "Sarasa Fixed SC")
         ((find-font (font-spec :name  "Iosevka")) "Iosevka")
         ((find-font (font-spec :name  "Inconsolata Nerd Font")) "Inconsolata Nerd Font")
         ((find-font (font-spec :name  "Ubuntu Mono")) "Ubuntu Mono")))
  ;; (setq resolution-factor (eval (/ (x-display-pixel-height) 1080)))
  (setq resolution-factor 2)
  (setq ideal-font-size (eval (* 15 resolution-factor)))
  (setq big-font-size (eval (* 18 resolution-factor)))
  (setq doom-font (font-spec :family user-font :size ideal-font-size)
        ;; doom-serif-font (font-spec :family user-font)
        doom-variable-pitch-font (font-spec :family user-font)
        ;; doom-unicode-font (font-spec :family user-font)
        doom-big-font (font-spec :family user-font :size big-font-size))
  )
#+end_src

*** theme
#+begin_src elisp
;; There are two ways to load a theme. Both assume the theme is installed and
;; available. You can either set `doom-theme' or manually load a theme with the
;; `load-theme' function. This is the default:
;; (setq doom-theme 'doom-acario-light)
;; (setq doom-theme 'doom-one)
;; (setq doom-theme 'doom-material)
(setq doom-theme 'doom-nova)
;; (setq doom-theme 'doom-vibrant)
;; (load-theme 'material t)
(custom-set-faces!
  '(org-todo :foreground "yellow" :weight bold :background "#263238")
  '(org-done :foreground "yellow" :weight bold :background "#263238")
  '(org-table :foreground "#e3f2fd")
  '(hl-line :background "#37474f")
  '(org-level-1 :foreground "#e3f2fd" :height 1.1 :background nil :weight bold :box nil)
  '(org-level-2 :foreground "#e3f2fd" :height 1.0 :background nil :weight normal :box nil)
  '(org-headline-done :foreground "gray" :weight normal)
  )

;; å½“å‰è¡Œ
(custom-set-faces!
  '(hl-line :background "#37474f")
  '(solaire-hl-line-face :background "#37474f")
  '(region :background "#555555")
  )
#+end_src
*** highlight
- [[https://emacs-china.org/t/package-symbol-overlay-symbol/7706][è®ºå›è®¨è®º]]

éå¸¸å¥½ç”¨. è¦ç‚¹:
- å…‰æ ‡ç½®äºsymbolå·¦å³, symbol-overlay-put å¯åˆ‡æ¢é«˜äº®çŠ¶æ€. åˆ‡n/på¯è·³è½¬è‡³å‰åé«˜äº®çš„ä½ç½®.
- å¯åŒæ—¶é«˜äº®å¤šç»„symbols. æ¯ç»„ç‹¬ç«‹æ§åˆ¶.
- å½“å…‰æ ‡åœ¨symbolå¤–æ—¶, å¯ç”¨ symbol-overlay-switch-forward æ¥è·³å›åˆ°æœ€è¿‘é‚£ç»„é«˜äº®çš„
  symbols. è¦è·³å›èµ·è·³ä½ç½®å¯æŒ‰eé”®.
- symbol-overlayæ²¡æ³•å®šä¹‰æœç´¢çš„å­—ç¬¦, è¿™æ—¶å¯ç”¨highlight-regexpå‘½ä»¤æ¥æ›¿ä»£.

#+name: fae9a6ea
#+begin_src elisp
;; symbol-overlay
;;;  a highlight-symbol replacement.
(use-package symbol-overlay
  :config
  ;; ç”¨ transient ä¸å¦‚ä¸‹é¢çš„å¥½. ä¸‹é¢çš„å¯ä»¥ç”¨"."å‘½ä»¤æ¥é‡åšä¸Šæ¬¡çš„æ“ä½œ.
  (general-define-key :prefix-map 'gwp::symbol-overlay-map
                      "h" 'symbol-overlay-put
                      "r" 'symbol-overlay-rename
                      "t" 'symbol-overlay-toggle-in-scope
                      "n" 'symbol-overlay-switch-forward ; å½“åœ¨é«˜äº®çš„å­—ç¬¦å¤–æ—¶, å¯å¿«é€Ÿè¿”å›.
                      "p" 'symbol-overlay-switch-backward
                      "d" 'symbol-overlay-remove-all
                      "R" 'symbol-overlay-query-replace)
  ;; ç­‰ä»·è®¾ç½®; å¤‡å¿˜
  ;; (setq symbol-overlay-map (make-sparse-keymap))
  ;; (setq gwp::symbol-overlay-map (make-sparse-keymap))
  ;; (define-key gwp::symbol-overlay-map (kbd "h") 'symbol-overlay-put)
  ;; (define-key gwp::symbol-overlay-map (kbd "n") 'symbol-overlay-jump-next)
  ;; (define-key gwp::symbol-overlay-map (kbd "p") 'symbol-overlay-jump-prev)
  ;; (define-key gwp::symbol-overlay-map (kbd "w") 'symbol-overlay-save-symbol)
  ;; (define-key gwp::symbol-overlay-map (kbd "t") 'symbol-overlay-toggle-in-scope)
  ;; (define-key gwp::symbol-overlay-map (kbd "e") 'symbol-overlay-echo-mark)
  ;; (define-key gwp::symbol-overlay-map (kbd "d") 'symbol-overlay-jump-to-definition)
  ;; (define-key gwp::symbol-overlay-map (kbd "s") 'symbol-overlay-isearch-literally)
  ;; (define-key gwp::symbol-overlay-map (kbd "q") 'symbol-overlay-query-replace)
  ;; (define-key gwp::symbol-overlay-map (kbd "r") 'symbol-overlay-rename)
  )
#+end_src

*** misc
#+name: 6013493c
#+begin_src elisp
;; View images inside Emacs
(auto-image-file-mode t)

;; set line space wider than default
(setq-default line-spacing 4)
#+end_src

*** packages.el
:PROPERTIES:
:header-args: :tangle pkg/.doom.d/modules/gwp/ui/packages.el
:END:
#+name: d6a037d0
#+begin_src elisp
;; (package! fcitx)
(package! rime)
(package! golden-ratio)
; (package! pyim)
;; äº”ç¬”è¾“å…¥æ³•
;; (package! pyim-wbdict)

;; pangu-spacing è‡ªåŠ¨ç»™ä¸­è‹±æ–‡å­—åŠ ç©ºæ ¼, è¿™ä¸¥é‡å½±å“å“åº”é€Ÿåº¦.
(disable-packages! pangu-spacing)
;; é¿å…ä¸rimeçš„è®¾ç½®æœ‰å†²çª
(disable-packages! pyim)
#+end_src
** develop
:PROPERTIES:
:header-args: :tangle pkg/.doom.d/modules/gwp/develop/config.el
:END:
*** imenu
- [[https://emacs.stackexchange.com/questions/30673/next-prev-imenu-item-function/33747#33747][motion - next/prev-imenu-item function - Emacs Stack Exchange]]
- ä¹Ÿå¯ä»¥å‚è€ƒè¿™ä¸ªæ”¹(åŸºäº counsel) [[file:redguardtoo-emacs.d/lisp/init-utils.el::defun my-closest-imenu-item-internal][my-closest-imenu-item-internal]]

#+name: f28734ed
#+begin_src elisp
;; https://emacs.stackexchange.com/a/33747
(defun gwp::imenu-goto--closest-dir (direction)
  "Jump to the closest imenu item on the current buffer.
If direction is 1, jump to next imenu item.
If direction is -1, jump to previous imenu item.
See https://emacs.stackexchange.com/questions/30673
Adapted from `which-function' in::
https://github.com/typester/emacs/blob/master/lisp/progmodes/which-func.el"
  ;; Ensure `imenu--index-alist' is populated.
  (imenu--make-index-alist)

  (let ((alist imenu--index-alist)
        (minoffset (point-max))
        offset pair mark imstack destination)
    ;; Elements of alist are either ("name" . marker), or
    ;; ("submenu" ("name" . marker) ... ). The list can be
    ;; Arbitrarily nested.
    (while (or alist imstack)
      (if alist
          (progn
            (setq pair (car-safe alist)
                  alist (cdr-safe alist))
            (cond
             ((atom pair)) ;; Skip anything not a cons.

             ((imenu--subalist-p pair)
              (setq imstack   (cons alist imstack)
                    alist     (cdr pair)))

             ((number-or-marker-p (setq mark (cdr pair)))
              (when (> (setq offset (* (- mark (point)) direction)) 0)
                (when (< offset minoffset) ;; Find the closest item.
                  (setq minoffset offset
                        destination mark))))))

        (setq alist   (car imstack)
              imstack (cdr imstack))))
    (when destination
      (imenu-default-goto-function "" destination ""))))

(defun gwp::imenu-goto-next ()
  (interactive)
  (unless (gwp::imenu-goto--closest-dir 1)
    (goto-char (point-max)))
  (recenter))

(defun gwp::imenu-goto-prev ()
  (interactive)
  (unless (gwp::imenu-goto--closest-dir -1)
    (goto-char (point-min)))
  (recenter))

;; vimé‡Œæ²¡æœ‰Altä¿®é¥°, M-xç±»ç»‘å®šå¯ä»¥æ”¾å¿ƒç”¨
(map! :n "M-n" #'gwp::imenu-goto-next)
(map! :n "M-p" #'gwp::imenu-goto-prev)
#+end_src

*** vterm
å®‰è£… vterm-toggle package. è¿™ä¸ªæ¯”doomå†…ç½®çš„å¼º, æ”¯æŒtramp buffer.
#+begin_src elisp :tangle pkg/.doom.d/packages.el
(package! vterm-toggle)
#+end_src

*** completion
å…³äº [[https://github.com/universal-ctags/citre/blob/master/docs/user-manual/citre-peek.md][citre-peek]]
: M-n, M-p: Next/prev line.
: M-N, M-P: Next/prev definition.
: M-l j: Jump to the definition.
: C-g: Close the peek window.

#+name: d28bc89a
#+begin_src elisp
;; Use hippie-expand instead of dabbrev-expand
;; (global-set-key (kbd "M-/") #'dabbrev-expand)
(global-set-key (kbd "M-/") #'hippie-expand)
;; the same behavior as the original `dabbrev-expand'
(setq hippie-expand-dabbrev-skip-space t)

;; adjust the list of functions that hippie-expand will try
(setq hippie-expand-try-functions-list
      '(
        try-expand-dabbrev-visible      ; first try the expansions from the currently visible parts
        try-expand-dabbrev
        try-expand-dabbrev-all-buffers
        try-complete-file-name-partially
        try-complete-file-name
        try-expand-line
        try-expand-dabbrev-from-kill
        ;; try-expand-all-abbrevs
        ;; try-expand-list
        try-complete-lisp-symbol-partially
        try-complete-lisp-symbol
        ))

(after! company
  (setq company-idle-delay 1.5
        company-minimum-prefix-length 2))

(use-package! citre
  :defer t
  :init
  ;; This is needed in `:init' block for lazy load to work.
  (require 'citre-config)
  (map! :leader
        (:prefix-map ("j" . "jump")
         (:prefix-map ("c" . "citre")
          :desc "citre jump to definition"                    "d" #'citre-jump
          :desc "citre jump back"                             "b" #'citre-jump-back
          :desc "citre peek"                                  "p" #'citre-peek
          ))))
#+end_src
*** find file in project
- [[https://github.com/redguardtoo/find-file-in-project][redguardtoo/find-file-in-project: Quick access to project files in Emacs]]

#+name: 81cb1ab5
#+begin_src elisp
(use-package find-file-in-project
  :config
  (setq ffip-use-rust-fd t))
#+end_src

*** vc commit
è‡ªåŠ¨æ›´æ–°æ—¶é—´æˆ³
#+name: 3ac9a958
#+BEGIN_SRC emacs-lisp
(use-package vc
  :init
  (add-hook 'vc-before-checkin-hook #'time-stamp))

(use-package vc-hooks
  :init
  ;; Don't ask if I want to visit a sym-linked file under VC. I always want to!
  (setq vc-follow-symlinks t))
#+END_SRC

*** yadm [[https://github.com/TheLocehiliosan/yadm/blob/master/yadm.md][yadm/yadm.md at master Â· TheLocehiliosan/yadm]]
å¿«æ·é”® SPC g y
#+name: 0717be82
#+begin_src emacs-lisp
;; (magit-status  "/yadm::")
(after! tramp
  (add-to-list 'tramp-methods
             '("yadm"
               (tramp-login-program "yadm")
               (tramp-login-args (("enter")))
               (tramp-login-env (("SHELL") ("/bin/sh")))
               (tramp-remote-shell "/bin/sh")
               (tramp-remote-shell-args ("-c")))))
#+end_src

*** rust-mode
**** task [0/2]
- [ ] (define-key rust-mode-map (kbd "C-c C-c") 'rust-run)
- [ ] [[https://github.com/ayrat555/cargo-mode][ayrat555/cargo-mode: Emacs minor mode which allows to dynamically select cargo command]]

**** docs
- å…³äºè¡¥å…¨: lsp/rust-analyzeå¤ªé‡äº†, raceræ›´ç®€å•ä¸€äº›.
- è§£å†³èŠ±æ‹¬å·ä¸­ "{|}" ä¸­æ¢è¡Œè¡Œä¸º, ä¸spacemacsä¿æŒä¸€è‡´.
- https://emacs.stackexchange.com/questions/2837/automatically-formatting-brackets

é‡è¦èµ„æº
- [[https://github.com/rust-lang/rust-mode][rust-lang/rust-mode]]
- rusticç›¸å…³ [[https://github.com/brotzeit/rustic][brotzeit/rustic: Rust development environment for Emacs]]
  (rustic-modeä»¥åä¼šæ˜¯ä¾èµ–äºrust-modeçš„å¢å¼ºç‰ˆ [[https://github.com/rust-lang/rust-mode/issues/405][Towards making rustic use rust-mode #405]])

**** edit
#+begin_src emacs-lisp
(after! smartparens
  (sp-local-pair 'rust-mode "{" nil :post-handlers '(:add ("||\n[i]" "RET")))
  ;; Rust closureä¸­ä½¿ç”¨
  (sp-with-modes '(rust-mode)
    (sp-local-pair "|" "|"))
  )

(add-hook 'rust-mode-hook
          (lambda () (require 'smartparens-rust)))

(after! org-src
  (add-to-list 'org-src-lang-modes '("rust" . rust)))
#+end_src

**** cargo/rust-mode
ä½¿ç”¨ rust-modeä¸­çš„cargo
- [[https://github.com/rust-lang/rust-mode/blob/master/rust-compile.el][rust-mode/rust-compile.el]]

åŸºäºcompilation modeå®šåˆ¶
- [[https://www.gnu.org/software/emacs/manual/html_node/emacs/Compilation-Mode.html][Compilation Mode - GNU Emacs Manual]]

ä»¥ä¸‹è‡ªå®šä¹‰cargoå‘½ä»¤, æ¯”åœ¨termä¸‹æ‰§è¡Œæ›´å¥½ä¸€äº›.
- ä½¿ç”¨Alt-n, Alt-på¯ä»¥å¿«é€Ÿå®šä½erroræˆ–warning æˆ–C-j, C-k
- é“¾æ¥åˆ°çš„srcæ–‡ä»¶å¯ç›´æ¥æ‰“å¼€.

ç°æœ‰å¦‚ä¸‹é—®é¢˜, å¯¼è‡´ç¼–è¯‘bufferæ— æ³•åŸºäºå‡ºé”™ä¿¡æ¯è·³è½¬åˆ°å¯¹åº”æ–‡ä»¶:
- [[https://github.com/rust-lang/cargo/issues/5895][Error messages use relative paths differently if in a workspace Â· Issue #5895 Â· rust-lang/cargo]]

ä¸ºæ­¤, æˆ‘ä»¬éœ€è¦cargo.sh, åŒ…è£…ä¸‹cargoå‘½ä»¤, åœ¨emacsè°ƒç”¨å‰, åˆ‡åˆ°workspaceæ ¹ç›®å½•, ä½†æ‰§è¡Œcargoæ—¶å†æ¢ä¸ºåˆ°åŸbufferå¯¹åº”ç›®å½•.
è¿™æ ·, å¯ä»…ç¼–è¯‘å½“å‰åŒ…, æ— ä¸æ˜¯æ‰€æœ‰workspaceä¸­çš„åŒ…, åŒæ—¶è¿˜èƒ½è§£å†³errorè·³è½¬çš„é—®é¢˜.

cargoé»˜è®¤è¾“å‡ºwarningå¤ªå¤š, ä»¥ä¸‹å‘½ä»¤è°ƒç”¨cargo, ä½†å¿½ç•¥warnings. åŒæ—¶ç¼–è¯‘ä¿¡æ¯é‡Œå¼ºåˆ¶è¾“å‡ºæ–‡ä»¶å…¨è·¯å¾„

#+begin_src shell :tangle ~/.local/bin/cargo.sh :shebang #! /bin/bash
# a wrapper for cargo command to work around a cargo issue:
# https://github.com/rust-lang/cargo/issues/5450#issuecomment-732954248

# goto current workspace memeber directory
cd "$1"
shift

# supress warnings and print full file paths in compilation
export RUSTFLAGS="$RUSTFLAGS -Awarnings"
cargo $@
#+end_src

#+begin_src elisp
(require 'rust-mode)
(require 'cargo)

;; taken from rust-cargo.el
(defun gwp/cargo-compile (args)
  ;; taken from cargo.el
  ;;
  ;; workaround cargo issue: https://github.com/rust-lang/cargo/issues/5895
  ;;
  ;; to make "jump-to-error" work, we need start compilation in workspace root dir
  (let (
        ;; save current directory
        (old-directory default-directory)
        (default-directory (or (cargo-process--workspace-root)
                               default-directory))
        )
    (compile (format "cargo.sh \"%s\" %s" old-directory args))
    ))

(defun gwp/rust-cargo-tangle-watch-check ()
  "Compile using `cargo watch and check`
The org src will be tangled first before compiling.
"
  (interactive)
  (gwp/org-babel-tangle-dwim)
  (gwp/rust-cargo-watch-check))

(defun gwp/rust-cargo-watch-check ()
  "Compile using `cargo watch and check`
"
  (interactive)
  (gwp/cargo-compile "check -q"))

(defun gwp/rust-cargo-tangle-watch-test ()
  "Compile using `cargo watch and test`
The org src will be tangled first before compiling.
"
  (interactive)
  (gwp/org-babel-tangle-dwim)
  (gwp/rust-cargo-watch-test))

(defun gwp/rust-cargo-watch-test ()
  "Compile using `cargo watch and test`
The org src will be tangled first before compiling.
"
  (interactive)
  (gwp/cargo-compile "d"))

(defun gwp/rust-cargo-update ()
  "Execute `cargo update` command"
  (interactive)
  (gwp/cargo-compile "update"))

(defun gwp/rust-cargo-doc-open ()
  "Execute `cargo doc --open` command"
  (interactive)
  (gwp/cargo-compile "doc --open --no-deps"))

(defun gwp/rust-cargo-edit-upgrade ()
  "Execute `cargo upgrade --dry-run` command"
  (interactive)
  (gwp/cargo-compile "upgrade --dry-run"))

;; ;; ä¿®æ”¹popup window, æ”¾å¤§ä¸€äº›, æ–¹ä¾¿æŸ¥çœ‹.
;; (set-popup-rule! "^\\*compilation\\*" :size 0.85 :quit t :select t :ttl nil)
;; gwp/org-babel-tangle-dwim

(require 'transient)
(transient-define-prefix gwp/rust-cargo-transient ()
  "rust development tools"
  [["compile org src:"
    :if org-in-src-block-p
    ("o b" "tangle src only" gwp/org-babel-tangle-dwim)
    ("o c" "tangle src & cargo check" gwp/rust-cargo-tangle-watch-check)
    ("o t" "tangle src & cargo test" gwp/rust-cargo-tangle-watch-test)
    ]]
  [["compile rust project:"
    ("c" "cargo check" gwp/rust-cargo-watch-check)
    ("t" "cargo test" gwp/rust-cargo-watch-test)
    ("d" "cargo doc" gwp/rust-cargo-doc-open)
    ("u" "cargo update" gwp/rust-cargo-update)
    ("U" "cargo upgrade" gwp/rust-cargo-edit-upgrade)
    ]]
  )

(map! :map org-mode-map
      :localleader
      "1" #'gwp/rust-cargo-transient
      )
(map! :map rust-mode-map
      :localleader
      "1" #'gwp/rust-cargo-transient
      )
#+end_src

**** cargo/cargo.el
:PROPERTIES:
:header-args: :tangle no
:END:
- [[https://github.com/kwrooijen/cargo.el][kwrooijen/cargo.el: Emacs Minor Mode for Cargo, Rust's Package Manager.]]

[2021-09-20 Mon] è¿™é‡Œçš„é—®é¢˜: æ‰§è¡Œæ—¶ä¼šåˆ‡åˆ°workspace rootæ‰§è¡Œ, å¦‚æœhackå, å°±ä¸rust-modeä¸­çš„åŠŸèƒ½ç›¸å½“äº†.

cargoå‘½ä»¤å¦‚æœä½¿ç”¨C-u è°ƒç”¨, å¯åœ¨minibufferä¸­ä¿®æ”¹cargoå‚æ•°.

ä»¥ä¸‹è‡ªå®šä¹‰cargo-watchå‘½ä»¤, æ¯”åœ¨termä¸‹æ‰§è¡Œæ›´å¥½ä¸€äº›.
- p, næ¥è·³è½¬åˆ°å‰ä¸€ä¸ªæˆ–ä¸‹ä¸€ä¸ªerror
- ä½¿ç”¨Alt-n, Alt-på¯ä»¥å¿«é€Ÿå®šä½erroræˆ–warning æˆ–C-j, C-k
- é“¾æ¥åˆ°çš„srcæ–‡ä»¶å¯ç›´æ¥æ‰“å¼€.
- æŒ‰qé€€å‡º

ä½¿ç”¨el-pathä¿®æ”¹cargo-processè°ƒç”¨æ–¹å¼, ä¸è¦åˆ‡æ¢è‡³workspaceæ ¹ç›®å½•æ‰§è¡Œcargoå‘½ä»¤, æ›´
åŒ¹é…å‘½ä»¤è¡Œä½¿ç”¨ä¹ æƒ¯.
#+begin_src elisp
(eval-when-compile (require 'el-patch))

(use-package cargo
  :defer t
  :hook (rust-mode . cargo-minor-mode)
  :custom
  (cargo-process--custom-path-to-bin "cargo.sh")
  (cargo-process--command-check "check -q")
  (cargo-process--command-test "test -- --nocapture --test-threads=1")
  ;;   :config/el-patch
  ;;   (defun cargo-process--start (name command &optional last-cmd opens-external)
  ;;     "Start the Cargo process NAME with the cargo command COMMAND.
  ;; OPENS-EXTERNAL is non-nil if the COMMAND is expected to open an external application.
  ;; Returns the created process."
  ;;     (set-rust-backtrace command)
  ;;     (let* ((buffer (concat "*Cargo " name "*"))
  ;;            (project-root (cargo-process--project-root))
  ;;            (cmd
  ;;             (or last-cmd
  ;;                 (cargo-process--maybe-read-command
  ;;                  (cargo-process--augment-cmd-for-os opens-external
  ;;                                                     (mapconcat #'identity (list (shell-quote-argument cargo-process--custom-path-to-bin)
  ;;                                                                                 command
  ;;                                                                                 ;; (manifest-path-argument name)
  ;;                                                                                 cargo-process--command-flags)
  ;;                                                                " ")))))
  ;;            ;; (default-directory (or project-root default-directory))
  ;;            )
  ;;       (save-some-buffers (not compilation-ask-about-save)
  ;;                          (lambda ()
  ;;                            (and project-root
  ;;                                 buffer-file-name
  ;;                                 (string-prefix-p project-root (file-truename buffer-file-name)))))
  ;;       (setq cargo-process-last-command (list name command cmd))
  ;;       ;; (let ((default-directory (or (cargo-process--workspace-root)
  ;;       ;;                              default-directory)))
  ;;       ;;   (compilation-start cmd 'cargo-process-mode (lambda(_) buffer)))
  ;;       (compilation-start cmd 'cargo-process-mode (lambda(_) buffer))
  ;;       (let ((process (get-buffer-process buffer)))
  ;;         (set-process-sentinel process 'cargo-process--finished-sentinel)
  ;;         process)))

  :init
  (add-hook 'conf-toml-mode-hook 'cargo-minor-mode) ; when edit Cargo.toml
  )

(require 'cargo)
(require 'transient)
(transient-define-prefix gwp/rust-cargo-transient ()
  "Search zotero database"
  [["Search zotero items:"
    ("c" "cargo check" cargo-process-check)
    ("t" "cargo test" cargo-process-test)
    ("u" "cargo update" cargo-process-update)
    ("d" "cargo doc" cargo-process-doc-open)
    ]]
  )

(map! :map org-mode-map
      :localleader
      "1" #'gwp/rust-cargo-transient
      )
(map! :map rust-mode-map
      :localleader
      "1" #'gwp/rust-cargo-transient
      )
#+end_src

**** racer
ç”¨äºè‡ªåŠ¨è¡¥å…¨, æ¯”lspæ›´è½»ä¾¿äº›.
#+begin_src elisp
(use-package cargo
  :defer t
  :init
  (progn
    (add-hook 'rust-mode-hook #'racer-mode)
    (add-hook 'racer-mode-hook #'eldoc-mode)
    (add-hook 'racer-mode-hook #'company-mode)
    ))
#+end_src

**** rust-format
rustç‰ˆæ¯”doomç‰ˆçš„æ›´å¥½, å¯è‡ªåŠ¨è·³è½¬åˆ°å‡ºé”™ç‚¹(c-c c-n)
#+name: 151a16d0
#+begin_src elisp
(map! :map rust-mode-map
      :localleader
      "f" #'rust-format-buffer
      "C-f" #'rust-format-buffer
      "=" #'rust-format-buffer)

(use-package rust-mode
  :hook (rust-mode . gwp/override-doom-format-buffer)
  )

(defun gwp/override-doom-format-buffer ()
  (evil-local-set-key 'normal (kbd "SPC =") 'rust-format-buffer)
  ;; æ— æ•ˆ
  ;; (evil-local-set-key 'normal (kbd "SPC c f") 'rust-format-buffer)
  )

(gwp-leader-def
  :keymaps 'rust-mode-map
  "f" 'rust-format-buffer
  )
#+end_src

**** edit
#+name: 72f0d377
#+begin_src elisp
(defun gwp/rust-insert-option (&optional result)
  "Insert the Option type."
  (interactive)

  (when (region-active-p)
    (sp-wrap-with-pair "<")
    (backward-char)
    (insert (or result "Option"))
    ))

(defun gwp/rust-unwrap-option (&optional result)
  "Remove Option type wrapper"
  (interactive)

  (when (region-active-p)
    (when (> (mark) (point))
      (exchange-point-and-mark))
    (sp-unwrap-sexp)
    (when (search-backward (or result "Option") (line-beginning-position) t)
      (delete-region (match-beginning 0) (match-end 0))
      )))


;; https://github.com/Wilfred/.emacs.d/blob/gh-pages/user-lisp/rust-customisations.el
(defun gwp/rust-toggle-pub ()
  "Toggle the public visibility of the function at point."
  (interactive)
  (save-excursion
    ;; If we're already at the beginning of the function definition,
    ;; `beginning-of-defun' moves to the previous function, so move elsewhere.
    (end-of-line)
    (beginning-of-defun)
    (if (looking-at "pub ")
        (delete-char 4)
      (insert "pub "))))

(defun gwp/rust-insert-result ()
  (interactive)
  (gwp/rust-insert-option "Result"))

(defun gwp/rust-unwrap-result ()
  (interactive)
  (gwp/rust-unwrap-option "Result"))

(transient-define-prefix gwp/rust-edit-transient ()
  "rust development tools"
  [["Result"
    ("o" "Wrap in Option" gwp/rust-insert-option)
    ("u" "Unwrap Option" gwp/rust-unwrap-option)
    ]]
  [["Result"
    ("r" "Wrap in Result" gwp/rust-insert-result)
    ("k" "Unwrap Result" gwp/rust-unwrap-result)
    ]]
  [["Pub"
    ("p" "toggle pub at point" gwp/rust-toggle-pub)
    ]]
  )

;; (defhydra gwp/rust-edit-hydra ()
;;   ("o" gwp/rust-insert-option "wrap with Option")
;;   ("u" gwp/rust-unwrap-option "unwrap Option")
;;   ("q" nil "quit")
;;   )

(map! :map rust-mode-map
      :localleader
      "e" #'gwp/rust-edit-transient
      :desc "select inner type" "m" (general-simulate-key "vi<")
      )
#+end_src

xx <=> Option<xx>

*** rustic-mode
:PROPERTIES:
:header-args: :tangle no
:END:
#+begin_src elisp
(use-package rustic
  :custom
  (rustic-lsp-client nil)
  (rustic-format-on-save nil)
  (rustic-display-spinner nil)
  )
#+end_src

*** python
[[file:doom-emacs/modules/tools/eval/README.org::+TITLE: tools/eval]]

: SPC-o-r æ‰“å¼€repl
: SPC-c-s send-region
é»˜è®¤çš„æŒºéš¾ç”¨çš„
#+begin_src elisp :tangle no
(after! python
  (setq python-shell-interpreter "ipython"))
#+end_src

ä½¿ç”¨tmux/ipythonç»„åˆæ¥å®ç°

#+name: 44b70ed9
#+begin_src elisp
(defun gwp/tmux-ipython-paste-region (beg end &optional region)
  "Execute \"%paste\" in tmux session"
  (interactive "r")
  (kill-ring-save beg end)
  (+tmux/run "%paste"))
#+end_src

*** packages.el
:PROPERTIES:
:header-args: :tangle pkg/.doom.d/modules/gwp/develop/packages.el
:END:
éœ€è¦å®‰è£…cargo.elç­‰åŒ…
#+name: e86dc54d
#+begin_src elisp
(package! magit)
(package! magit-todos)
(package! cargo)
(package! racer)
(package! rust-mode)
(package! citre)
(package! find-file-in-project)
#+end_src

** edit
:PROPERTIES:
:header-args: :tangle pkg/.doom.d/modules/gwp/edit/config.el
:END:
*** duplicate
å¯ç”¨çš„
- delete-duplicate-lines

#+name: 3eff5fa2
#+begin_src elisp
(defun gwp::duplicate-region (beg end)
  (interactive "r")
  (save-excursion
    (let* ((beg (or beg (region-beginning)))
           (end (or end (region-end)))
           (region (buffer-substring beg end)))
      (goto-char end)
      (insert region))))

(defun gwp::duplicate-line (&optional stay)
  (save-excursion
    (move-end-of-line nil)
    (save-excursion
      (insert (buffer-substring (point-at-bol) (point-at-eol))))
    (newline)))

(defun gwp::duplicate-line-or-region()
  "å¤åˆ¶å½“å‰è¡Œæˆ–é€‰å®šåŒºåŸŸ"
  (interactive)
  (if (region-active-p)
      (call-interactively #'gwp::duplicate-region)
    (gwp::duplicate-line)))

(map! :leader "C-d" #'delete-duplicate-lines)

;; (use-package move-dup
;;   :config
;;   (map! :iv "M-j" #'move-dup-move-lines-down)
;;   (map! :iv "M-k" #'move-dup-move-lines-up)
;;   (map! :iv "C-M-j" #'move-dup-duplicate-down)
;;   (map! :iv "C-M-k" #'move-dup-duplicate-up))
#+end_src
*** clipboard
#+name: e571c476
#+begin_src elisp
(use-package simpleclip)

;; ä»å…¶å®ƒç¨‹åºå¤åˆ¶çš„å†…å®¹ä¹Ÿæ”¾è‡³åœ¨kill-ringä¸­, ä¸ä¼šå› ä¸ºemacsçš„æ“ä½œè€Œè¦†ç›–ä¹‹å‰çš„å†…å®¹
(setq save-interprogram-paste-before-kill t)
#+end_src

*** kill/delete/yank
#+name: b5a74212
#+begin_src elisp
(setq kill-ring-max 999)

;; ç²˜è´´æ—¶åˆ é™¤åŒºåŸŸä¸­çš„å†…å®¹, ä¸æ±¡æŸ“clipboard, æ–¹ä¾¿è¿ç»­yank.
(defun gwp::yank-dwim (arg)
  "ç²˜è´´å¹¶è¦†ç›–é€‰å®šåŒºåŸŸ. å¦‚æœä»¥C-uè°ƒç”¨åˆ™æç¤ºä»kill-ringä¸­é€‰æ‹©"
  (interactive "P")
  (when (region-active-p)
    (call-interactively #'delete-region))
  (if (equal arg '(4))                  ; C-u
      (call-interactively #'counsel-yank-pop)
    (call-interactively #'yank)))
(map! :nv "C-y" #'gwp::yank-dwim)

;; ä¿æŒå’Œterminalä¸­çš„è¡Œä¸ºä¸€è‡´: åˆ é™¤é€‰å®šåŒºåŸŸæˆ–å‘åä¸€ä¸ªå•è¯
(defun gwp::ctrl-w-dwim ()
  (interactive)
  (if (region-active-p)
      (call-interactively #'kill-region)
    (call-interactively #'backward-kill-word)))

(map! :vi "C-w" #'gwp::ctrl-w-dwim); cut, copy: Alt-w
;; é»˜è®¤ä¸ºset-faceä¹‹ç±»çš„ä¸œè¥¿
(map! "M-o" #'just-one-space)
;; åˆ é™¤åˆ°è¡Œå°¾
(map! :i "C-k"  #'kill-line)
; åˆ é™¤å¤šä½™ç©ºè¡Œ, ä»…ä¿ç•™ä¸€è¡Œ
;; C-x C-o
(map! :leader "C-o" #'delete-blank-lines)
#+end_src

åˆ é™¤å­—ç¬¦æˆ–é€‰å®šåŒºåŸŸ, ä½†ä¸ç»è¿‡kill-ring
: delete-char (C-d, DELETE), delete-backward-char (BACKSPACE)
: delete-region

æ¯”å¦‚, å¸Œæœ›åˆ é™¤é€‰å®šå†…å®¹, ç²˜è´´ä¹‹å‰å¤åˆ¶çš„å†…å®¹. å› ä¸ºä¸æ±¡æŸ“clipboard, è¿™æ ·å°±æ²¡å¿…è¦ä»clipboardä¸­é€‰æ‹©å†…å®¹äº†.
#+name: 7d5caf69
#+begin_src elisp
(defun gwp::ctrl-d-dwim (prefix)
  "æ¸…é™¤åŒºåŸŸæˆ–å¤åˆ¶åŒºåŸŸ"
  (interactive "P")
  (if prefix                  ; C-u
      (call-interactively #'gwp::duplicate-line-or-region)
    (call-interactively #'gwp::delete-char-or-region)))

(defun gwp::delete-char-or-region()
  "æ¸…é™¤å…‰æ ‡å‰å­—ç¬¦æˆ–é€‰å®šåŒºåŸŸ"
  (interactive)
  (if mark-active
      (call-interactively #'delete-region)
    (delete-char 1)))
#+end_src

ä¾›å‚è€ƒ
[[https://github.com/Wilfred/.emacs.d/blob/gh-pages/init.el][.emacs.d/init.el at gh-pages Â· Wilfred/.emacs.d]]
#+begin_src elisp :tangle no
;; I sometimes want to simply delete a region, rather than
;; saving it to the kill-ring. I've added a function that allows me to
;; type =C-u C-w= to delete the region, whilst =C-w= works as normal.

(defun gwp::kill-or-delete-region (beg end prefix)
  "Delete the region, storing it in the kill-ring.
If a prefix argument is given, don't change the kill-ring."
  (interactive "r\nP")
  (if prefix
      (delete-region beg end)
    (kill-region beg end)))
#+end_src

*** evil
å¯ä»¥ç”¨æ¥å®šä¹‰ leader çš„é”®
- z
- b: evil-backward-word-begin
- w/W
- q/Q
- ,
- \: evil-execute-in-emacs-state
- -: evil-previous-line-first-non-blank
- =: evil-indent
- F5

#+name: 73388047
#+begin_src elisp
;; é»˜è®¤qä¸ºmacroé”®, æˆ‘å¾ˆå°‘ç”¨. æ”¹ä¸ºå¿«é€Ÿç§»åŠ¨ç±»æŒ‰é”®.
(map! :n "q" #'evil-forward-paragraph)
(map! :n "Q" #'evil-backward-paragraph)

;; é»˜è®¤ä¸ºword-endç±»ç§»åŠ¨
(map! :n "e" #'evil-forward-sentence-begin)
(map! :n "E" #'evil-backward-sentence-begin)

;; ä¸‹é¢å¯ä»¥ç”¨ M-f/M-b ä»£æ›¿
;; (map! :n "w" #'evil-forward-word-begin)
;; (map! :n "W" #'evil-backward-word-begin)

;; C-v: evilé»˜è®¤ä¸ºquoted-insert, å¯ä»¥ ctrl-qä»£æ›¿
(map! :i "C-v" #'yank)
(map! :i "C-y" #'yank)

;; ç¦ç”¨evilä¸­çš„ctrl-e, é»˜è®¤ä¸ºå‘ä¸Šæ»šåŠ¨, ä¸å¤ªä¹ æƒ¯.
(map! :nvim "C-a" nil)
(map! :nvim "C-e" nil)
(map! :nvim "C-d" #'gwp::ctrl-d-dwim)
(map! :nvim "C-k" nil)
(map! :nvim "C-n" nil)
(map! :nvim "C-p" nil)
(map! :nvim "C-u" nil)                  ; universal argument

(after! evil-org
  (map! :map evil-org-mode-map
        :nvim "C-d" #'gwp::ctrl-d-dwim
        :nvim "C-k" nil
        :i "M-l" nil))

;; insert stateä¸‹ç”¨emacsé»˜è®¤æŒ‰é”®
;; 2021-10-13: è®¾ç½®æ— æ•ˆ
;; (setq evil-disable-insert-state-bindings t)
#+end_src

*** undo
æ„Ÿè§‰emacsçš„undoæ¯”evilçš„å¼º

é»˜è®¤ç»‘å®š:
C-x u, C-_ C-/

C-u C-/ å¦‚æœé€‰ä¸­åŒºåŸŸ, åˆ™ä»…æ’¤é”€å½“å‰å†…å®¹.

#+name: 9f41280c
#+begin_src elisp
(defun gwp::undo-dwim ()
  (interactive)
  (if (region-active-p)
      (let ((current-prefix-arg '(4)))     ; C-u
        (call-interactively #'undo))
    (call-interactively #'evil-undo)))

(map! :nv "u" #'gwp::undo-dwim)

;; é»˜è®¤evilçš„undoä¼šå°†å¤šä¸ªå°æ“ä½œåˆå¹¶ä¸ºä¸€ä¸ªå¤§çš„, undoæ—¶å¾ˆä¸é€‚åº”.
(setq evil-want-fine-undo t)
#+end_src

*** newline
åœ¨æ³¨é‡Šç¯å¢ƒä¸‹æ›´å®¹æ˜“ä½¿ç”¨, ç”¨ctrl-enterå®¹æ˜“è¯¯æŒ‰.
#+name: 1a0721e0
#+begin_src elisp
(map! :ni  "C-j"           #'+default/newline-below)
#+end_src

*** search/replace
emacsé»˜è®¤æœç´¢å…‰æ ‡å¤„çš„å­—è¯:
: C-s C-w
æŒ‰C-c ;åå¯è·³è½¬(avy)

åœ¨evilä¸­å¯ç”¨*æˆ–/. æ„Ÿè§‰evilæ›´æ–¹ä¾¿.
#+name: b23f833f
#+begin_src elisp
(defun gwp::swiper-from-clipboard (prefix)
  "ä»clipboardå–è¯æ¥æœç´¢"
  (interactive "P")
  (let ((keyword
         (simpleclip-get-contents)))
    (swiper-isearch keyword)))
#+end_src

*** hydra
ç‰¹åˆ«é€‚åˆéœ€è¦é‡å¤æŒ‰é”®æ¥å®Œæˆçš„æ“ä½œ, æ¯”å¦‚è°ƒæ•´çª—å£å¤§å°.
#+name: 356a926a
#+begin_src elisp
(use-package hydra)
#+end_src

*** keyfreq
[[https://github.com/dacap/keyfreq][dacap/keyfreq: Track Emacs commands frequency]]
å¯ç”¨keyfreq-showæŸ¥çœ‹æŒ‰é”®ç»Ÿè®¡æ’åº
#+begin_src elisp
(require 'keyfreq)
(keyfreq-mode 1)
(keyfreq-autosave-mode 1)
#+end_src

*** auto-save
å¼€å¯è‡ªåŠ¨ä¿å­˜
#+begin_src elisp
(setq
 ;; doomé‡Œå·²é»˜è®¤ä¸ºtrue
 auto-save-default t
 ;; é»˜è®¤ä¸º5ç§’. è¿™é‡Œæ”¹å¤§ä¸€äº›, é¿å…ç¼–è¾‘æ—¶è‡ªåŠ¨ä¿å­˜å¤ªå¿«, å…‰æ ‡å‰çš„ç©ºæ ¼è¢«åæ‰
 auto-save-visited-interval 30)

;; è‡ªåŠ¨ä¿å­˜è‡³å½“å‰æ–‡ä»¶å, è€Œä¸´æ—¶æ–‡ä»¶
(auto-save-visited-mode +1)
#+end_src

*** ctrl-z
é»˜è®¤åˆ‡æ¢ä¸ºemacs-state, ç»å¸¸æŒ‰é”™.
#+name: 9edb7f25
#+begin_src elisp
(after! evil
  ;; å¦‚ä½•è¯¯å…¥evil-emacs-state, æŒ‰ESCè¿”å›normal state
  (define-key evil-emacs-state-map [escape] 'evil-normal-state))
#+end_src

*** upcase/downcase
è§£å†³å¤§å°å†™, é¦–å­—æ¯å¤§å†™ç­‰é—®é¢˜. åœ¨evil visual stateä¸­, ä¹Ÿå¯ç›´æ¥ç”¨u/Uæ¥å®ç°ç›¸åŒåŠŸèƒ½.
#+name: b9054953
#+begin_src elisp
(map! :vi "M-u" #'upcase-dwim
      :vi "M-l" #'downcase-dwim
      :vi "M-c" #'capitalize-dwim)
#+end_src

*** smartparens
[2021-10-05 Tue] åŸºæœ¬ä¸Šæ²¡ä½¿ç”¨è¿‡, ç¦ç”¨ä¹‹
#+begin_src elisp :tangle no
(map! :leader
      :nvi
      "DEL" #'sp-backward-kill-sexp     ; BACKSPACE
      [deletechar] #'sp-kill-sexp       ; DELETE
      [right] #'sp-forward-slurp-sexp   ; Array right ==>
      [left]  #'sp-backward-slurp-sexp  ; Array left  <==
      "C-k"   #'sp-unwrap-sexp
      )
#+end_src

kill
: (foo |(abc) bar)  -> (foo | bar) ;; nil, defaults to 1
: (1 2 3 |4 5 6)    -> (|)         ;; 0
: (foo |(bar) baz)  -> |           ;; SPC u SPC u
: (1 |2 3 4 5 6)    -> (1|)        ;; SPC u

slurp
: (foo |bar) baz        -> (foo |bar baz)
: [(foo |bar)] baz      -> [(foo |bar) baz]
: ((|foo) bar baz quux) -> ((|foo bar baz quux)) ;; with SPC u

unwrap
: |(foo bar baz)     -> |foo bar baz
: (foo bar| baz)     -> foo bar| baz

*** mark ring
mark-ringç”¨äºä¿å­˜ä¸Šæ¬¡æ ‡è®°æˆ–é€‰æ‹©çš„ä½ç½®, ç”¨äºè·³è½¬å¾ˆæœ‰ç”¨.

emacs çš„ mark ring [[http://www.gnu.org/software/emacs/manual/html_node/emacs/Mark-Ring.html#Mark-Ring][doc]]. emacs ä¼šè‡ªåŠ¨è®°å½•æ ‡è®°, ç§°ä¸º mark ring. é¼ æ ‡é€‰æ‹©, shift é€‰
æ‹©éƒ½ç®—C-x C-x: äº¤æ¢å½“å‰å…‰æ ‡ä½ç½®å’Œ mark, è¿™æ ·ä¼šè·³è½¬åˆ°ä¸Šå‰ mark çš„ä½ç½®ä¸Š, ä¸è¿‡ä¼šæœ‰
é«˜äº®, æŒ‰ C-g å–æ¶ˆ

: set-mark-command
C-x C-@: è¿™æ˜¯è½®æ¢å…¨å±€ mark
C-u C-@: è¿™æ˜¯è½®æ¢å½“å‰çš„ mark ring

- [[https://github.com/rolandwalker/back-button][rolandwalker/back-button: Visual navigation through mark rings in Emacs]]
- [[https://stackoverflow.com/questions/3393834/how-to-move-forward-and-backward-in-emacs-mark-ring][How to move forward and backward in Emacs' mark ring - Stack Overflow]]
- https://github.com/rolandwalker/back-button/blob/master/back-button.el
- [[https://github.com/slewsys/emacs-extensions/blob/main/mark-navigation.el][emacs-extensions/mark-navigation.el]]
- [[https://github.com/rolandwalker/back-button][rolandwalker/back-button: Visual navigation through mark rings in Emacs]]

**** core
#+name: e4fc036b
#+begin_src elisp
;; è¦ä¿è¯ C-u C-@ è¿ç»­è°ƒç”¨æœ‰æ•ˆ
(setq set-mark-command-repeat-pop nil)

(defun gwp::jump-to-previous-mark ()
  (interactive)
  (let ((current-prefix-arg '(4)))     ; C-u
    (call-interactively #'set-mark-command)))

;; æ ¹æ®æ‰‹å†Œ: C-SPC C-SPCä¸¤æ¬¡
;; ä»…æ ‡è®°å½“å‰ä½ç½®(push to mark ring), ä½†ä¸é€‰æ‹©
(defun gwp::mark-current-position ()
  (interactive)
  (call-interactively #'set-mark-command)
  (deactivate-mark)
  )

(setq global-mark-ring-max 99
      mark-ring-max 99)
#+end_src

**** global mark ring
#+name: e48dc36a
#+begin_src elisp
;; https://stackoverflow.com/a/27661338
(defun marker-is-point-p (marker)
  "test if marker is current point"
  (and (eq (marker-buffer marker) (current-buffer))
       (= (marker-position marker) (point))))

(defun push-mark-maybe ()
  "push mark onto `global-mark-ring' if mark head or tail is not current location"
  (if (not global-mark-ring) (error "global-mark-ring empty")
    (unless (or (marker-is-point-p (car global-mark-ring))
                (marker-is-point-p (car (reverse global-mark-ring))))
      (push-mark))))


(defun backward-global-mark ()
  "use `pop-global-mark', pushing current point if not on ring."
  (interactive)
  (push-mark-maybe)
  (when (marker-is-point-p (car global-mark-ring))
    (call-interactively 'pop-global-mark))
  (call-interactively 'pop-global-mark))

(defun forward-global-mark ()
  "hack `pop-global-mark' to go in reverse, pushing current point if not on ring."
  (interactive)
  (push-mark-maybe)
  (setq global-mark-ring (nreverse global-mark-ring))
  (when (marker-is-point-p (car global-mark-ring))
    (call-interactively 'pop-global-mark))
  (call-interactively 'pop-global-mark)
  (setq global-mark-ring (nreverse global-mark-ring)))
#+end_src

**** marker-visit.el
#+name: ebb32bb1
#+begin_src elisp
;; https://github.com/deestan/emacs/blob/master/emacs-goodies-el/marker-visit.el
;;
;;; marker-visit.el --- navigate through a buffer's marks in order

;; Copyright (C) 2001 Benjamin Rutt
;;
;; Maintainer: Benjamin Rutt <brutt@bloomington.in.us>
;; Version: 1.1

;; This file is not part of GNU Emacs.

;; This file is free software; you can redistribute it and/or modify
;; it under the terms of the GNU General Public License as published
;; by the Free Software Foundation; either version 2, or (at your
;; option) any later version.

;; This program is distributed in the hope that it will be useful,
;; but WITHOUT ANY WARRANTY; without even the implied warranty of
;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
;; GNU General Public License for more details.

;; You should have received a copy of the GNU General Public License
;; along with GNU Emacs; see the file COPYING.  If not, send e-mail to
;; this program's maintainer or write to the Free Software Foundation,
;; Inc., 59 Temple Place, Suite 330; Boston, MA 02111-1307, USA.

;;; Commentary:

;; This file provides a simple way to navigate among marks in a
;; buffer.  C-u C-SPC is similar, but takes you haphazardly around the
;; buffer.  Setting bookmarks is a lot of extra work if you just want
;; to jump around your buffer quickly; plus, you have to come up with
;; a name for every bookmark.

;; All the marks you've left while editing a buffer serve as bread
;; crumb trails of areas in the buffer you've edited.  It is
;; convenient to navigate back and forth among these marks in order.
;; This file provides two methods to do just that, marker-visit-prev
;; and marker-visit-next.  These two functions will take you, from
;; point, to the nearest mark in either direction.  The function
;; marker-visit-truncate-mark-ring will truncate the mark ring.

;; The marks you can visit in a buffer consist of: "the mark" plus the
;; contents of the mark-ring.

;;; Usage:

;; put this file in your load-path and add the line
;;
;; (require 'marker-visit)
;;
;; to your ~/.emacs file.
;;
;; This package is most useful when some easy-to-press keys are bound
;; to the functions marker-visit-prev and marker-visit-next.  See C-h
;; i m Emacs RET m Key Bindings RET for info on emacs key bindings.

;;; History:

;; 1.0 -> 1.1 Incorporated patch from Colin Walters to make the code
;; consistent with elisp code conventions mentioned in
;; (Info-goto-node "(elisp) Coding Conventions").

;;; Code:

;;utility remove-dupes function
(defun marker-visit-remove-dupes (ls)
  (cond
   ((null ls) '())
   ((member (car ls) (cdr ls)) (marker-visit-remove-dupes (cdr ls)))
   (t (cons (car ls) (marker-visit-remove-dupes (cdr ls))))))

;;create a sorted list of marks, including the point as mark, the
;;mark, and the contents of the mark-ring.
(defun marker-visit-get-sorted-mark-set (current-point-mark)
  (marker-visit-remove-dupes
   (sort
    (append (cons current-point-mark
		  (if (mark-marker) (list (mark-marker)) nil))
	    (mapcar (lambda (id) id) mark-ring))
    (lambda (a b) (< a b)))))

(defun marker-visit-no-markers-p ()
  (and (null mark-ring)
       (or (not (mark-marker))
	   (not (marker-position (mark-marker))))))

(defun marker-visit-warn (error-message)
  (message error-message)
  (beep))

;;;###autoload
(defun marker-visit-prev ()
  "From point, visit the nearest mark earlier in the buffer."
  (interactive)
  (if (marker-visit-no-markers-p)
      (marker-visit-warn "Mark does not point anywhere")
    (let* ((current-point-mark (point-marker))
	   (sorted-marks (marker-visit-get-sorted-mark-set current-point-mark))
	   (dest-mark nil))
      (while (not (equal current-point-mark (car sorted-marks)))
	(setq dest-mark (car sorted-marks))
	(setq sorted-marks (cdr sorted-marks)))
      (if dest-mark
	  (goto-char dest-mark)
	(marker-visit-warn "No previous mark to visit")))))

;;;###autoload
(defun marker-visit-next ()
  "From point, visit the nearest mark later in the buffer."
  (interactive)
  (if (marker-visit-no-markers-p)
      (marker-visit-warn "Mark does not point anywhere")
    (let* ((current-point-mark (point-marker))
	   (sorted-marks (marker-visit-get-sorted-mark-set current-point-mark))
	   (dest-mark nil)
	   (done nil))
      (while (not done)
	(if (equal current-point-mark (car sorted-marks))
	    (progn
	      (setq dest-mark (cadr sorted-marks))
	      (setq done t))
	  (setq sorted-marks (cdr sorted-marks))))
      (if dest-mark
	  (goto-char dest-mark)
	(marker-visit-warn "No next mark to visit")))))

;;;###autoload
(defun marker-visit-truncate-mark-ring ()
  "Truncate the `mark-ring'."
  (interactive)
  (setq mark-ring nil))
#+end_src

**** hydra
#+name: 00b43976
#+begin_src elisp
(defhydra gwp::hydra-mark-ring-pop ()
  "goto last location"
  ("SPC" gwp::jump-to-previous-mark "prev mark")          ; åœ¨orgä¸­å¯è‡ªåŠ¨æ‰“å¼€æŠ˜å çš„å†…å®¹
  ("n" marker-visit-next "next mark")
  ("p" marker-visit-prev "prev mark")                     ; NOTE: orgæŠ˜å çš„å†…å®¹ä¸ä¼šæ‰“å¼€
  ("P" backward-global-mark "prev mark (global)")         ;
  ("N" forward-global-mark "next mark (global)")          ;
  ("o" gwp::org-show-context-at-point "org show context") ; åœ¨orgæ—¶: è·³è½¬åˆ°è¢«æŠ˜å çš„headlineä¸­å¾ˆæœ‰ç”¨
  ("q" nil "quit"))
#+end_src

*** jump
ä½¿ç”¨é¼ æ ‡æ»šè½®æ¥è·³è½¬ä½ç½®
- [[https://github.com/gilbertw1/better-jumper][gilbertw1/better-jumper: A configurable jump list implementation for Emacs]]

è¿˜æœ‰ä»¥ä¸¤ä¸ªå­—ç¬¦ä¸ºæœç´¢ä¾æ®çš„, æ¯”å¦‚avy-goto-char-2
#+name: 6ded2bf1
#+begin_src elisp
(map! :nm
      [M-mouse-4] #'better-jumper-jump-backward
      [M-mouse-5] #'better-jumper-jump-forward)

(map! :leader
      (:prefix-map ("j" . "jump")
       (:prefix-map ("a" . "avy")
        :desc "Search and jump (pinyin)"        "c" #'evil-avy-goto-char-2
        :desc "Search and jump"                 "s" #'evil-avy-goto-char-timer
        :desc "jump to line"                    "l" #'avy-goto-line
        )))
#+end_src

å¯ä»¥ç”¨isearch(C-s)æ—¶, è°ƒç”¨avyå®ç°ä¾¯é€‰é¡¹è·³è½¬.
#+name: 08a09ddb
#+begin_src elisp
(map! :map isearch-mode-map
      :desc "avyè·³è½¬" "C-c ;" #'avy-isearch
      )
#+end_src

ä¹Ÿå¯ä»¥åœ¨evilç”¨"/"æœç´¢åå†jump
#+name: 0ed10c98
#+begin_src elisp
(defun gwp/evil-ex-search-avy-jump ()
  (interactive)
  (when evil-ex-search-pattern
    (let ((regex (car evil-ex-search-pattern)))
      (avy-jump regex)
      (evil-ex-search-stop-session))))

;; (map! :map evil-ex-search-keymap
;;       :desc "avy jump" "C-c ;" #'gwp/evil-ex-search-avy-jump)
;;
#+end_src

*** ivy
swiperæœç´¢ä¸­, å¦‚æœä¸€è¡Œå†…æœ‰å¤šä¸ªç»“æœ, å¾—æŒ‰å¥½å‡ æ¬¡C-næ‰èƒ½åˆ°ä¸‹ä¸€æ¡. è¿™é‡Œç”¨avyæ¥è·³è½¬å°±æ–¹ä¾¿äº†.

- å¯ç”¨ ivy-restrict-to-matchesè¿›è¡ŒäºŒæ¬¡è¿‡æ»¤, é»˜è®¤æŒ‰é”®ä¸ºS-SPC.
- ivy-avyç”¨äºå¿«é€Ÿè·³è½¬, é»˜è®¤æŒ‰é”®ä¸ºC-', å¾—æ¢ä¸ªå¥½æŒ‰ä¸€äº›çš„.

#+name: dde3ee55
#+begin_src elisp
(map! :map ivy-minibuffer-map
      ;; ä¿®æ”¹åçš„å‘½ä»¤ä¼šæŠ¥é”™, åŸæŒ‰é”®å¯ä»¥. åŸå› ä¸æ˜.
      ;; "C-c ;" #'ivy-avy
      :desc "äºŒæ¬¡è¿‡æ»¤" "C-c r" (general-simulate-key "S-SPC")
      :desc "avyè·³è½¬" "C-c ;" (general-simulate-key "C-'")
      :desc "ä¸Šä¸€é¡µ" "C-c C-p" #'ivy-scroll-down-command
      :desc "ä¸‹ä¸€é¡µ" "C-c C-n" #'ivy-scroll-up-command
      )
#+end_src


*** insert date
#+name: ab440ea2
#+begin_src emacs-lisp
(defun gwp/insert-date (arg)
  "Insert date at point. With prefix argument, insert date and time."
  (interactive "P")
  (insert (format-time-string "%Y-%m-%d"))
  (when arg
    (insert (format-time-string " %H:%M"))))

;; make it easier to update time-stamp
(map! :i "C-c i" #'gwp/insert-date)
#+end_src

*** white space
#+name: f75f80bd
#+begin_src emacs-lisp
(setq show-trailing-whitespace t)
;; ä¿ç•™æ—¶ä¼šè‡ªåŠ¨æ¸…ç†, ä»¥ä¸‹å·²ä¸å¿…è¦
;; (global-set-key (kbd "<f5> SPC") 'delete-trailing-whitespace)
;; (global-set-key (kbd "C-x C-o") 'delete-blank-lines)
#+end_src

*** join next line
doomçš„å¼•å…¥çš„"æ”¹è¿›"å¯¼è‡´å¾ˆè¯¡å¼‚çš„è¡Œä¸º, åº”ç¦ç”¨æ‰.

[[https://github.com/hlissner/doom-emacs/commit/40cf6139ed53b635fec37ce623c4b1093c78a11e][Make evil-join remove comment delimiters Â· hlissner/doom-emacs@40cf613]]

#+name: 2286a7d2
#+begin_src elisp
(after! evil
  (advice-remove #'evil-join #'+evil-join-a))
#+end_src

*** disable mouse
ç¬”è®°æœ¬è¾“å…¥æ—¶å¤§æ‹‡æŒ‡å®¹æ˜“è¯¯ç¢°è§¦æ§æ¿, ç¦ç”¨é¼ æ ‡å¯é¿å…è¿™ä¸€é—®é¢˜.
**** æ–¹æ¡ˆ1: disable mouse event
ä»¥ä¸‹ä»£ç ä»æœ‰é—®é¢˜, evilä¸­ä»èƒ½ç‚¹å‡»é¼ æ ‡. ä¸ºç®€æ˜“è§, åœ¨KDEä¸­ç¦ç”¨touchpadçš„tapåŠŸèƒ½.
#+name: 7628d03d
#+begin_src elisp
;; https://endlessparentheses.com/disable-mouse-only-inside-emacs.html
(define-minor-mode disable-mouse-mode
  "A minor-mode that disables all mouse keybinds."
  :global t
  :lighter " ğŸ­"
  :keymap (make-sparse-keymap)

  (dolist (type '(mouse
                  down-mouse
                  drag-mouse
                  double-mouse
                  triple-mouse))
    (dolist (prefix '("" C- M- S- M-S- C-M- C-S- C-M-S-))
      ;; Yes, I actually HAD to go up to 7 here.
      (dotimes (n 3)
        (let ((k (format "%s%s-%s" prefix type n)))
          (define-key disable-mouse-mode-map
            (vector (intern k)) #'ignore))))))

(map! :leader
      (:prefix-map ("t" . "toggle")
       :desc "ç¦ç”¨é¼ æ ‡" "m" #'disable-mouse-mode
       ))

(defun turn-off-disable-mouse-mode ()
  (disable-mouse-mode -1))

(defun turn-on-disable-mouse-mode ()
  (disable-mouse-mode 1))

;; åœ¨insertçŠ¶æ€ä¸‹ç¦ç”¨é¼ æ ‡, é¿å…è¯¯ç¢°è§¦æ§æ¿
(add-hook! 'evil-insert-state-entry-hook #'turn-on-disable-mouse-mode)
(add-hook! 'evil-insert-state-exit-hook #'turn-off-disable-mouse-mode)
#+end_src

**** æ–¹æ¡ˆ2: disable-mouse package
:PROPERTIES:
:header-args: :tangle no
:END:
ä»¥ä¸‹ä»£ç å¯å½»åº•ç¦ç”¨é¼ æ ‡äº‹ä»¶, ä½†evilå¾—é‡å¯åæ‰èƒ½é‡æ–°å¯ç”¨, æ— æ³•åŠ¨æ€åˆ‡æ¢. è¿™ä¸ªé—®é¢˜æ¯”
è¾ƒå¤æ‚, ä¸å¥½è§£å†³. [[https://github.com/purcell/disable-mouse/issues/7][requiring restart #7]]
#+name: a791c065
#+begin_src elisp
(defun gwp/disable-mouse ()
  (interactive)
  (require 'disable-mouse)
  (global-disable-mouse-mode)
  (mapc #'disable-mouse-in-keymap
        (list evil-motion-state-map
              evil-normal-state-map
              evil-visual-state-map
              evil-insert-state-map))
  )
#+end_src

**** æ–¹æ¡ˆ3: xinput
:PROPERTIES:
:header-args: :tangle no
:END:
[[https://www.reddit.com/r/emacs/comments/38o0tr/i_have_to_share_this_switch_your_touchpad_off/][I have to share this: Switch your touchpad off when emacs gets focus and on again when she loses focus. : emacs]]

éœ€è¦xinputå‘½ä»¤
: pac -S xorg-xinput
: xinput list
: xinput enable "SYNA2393:00 06CB:CD48 Touchpad"
: xinput disable "SYNA2393:00 06CB:CD48 Touchpad"

#+begin_src elisp
(defun gwp/turn-off-touchpad (&optional frame)
  (interactive)
  (let ((inhibit-message t) (default-directory "~"))
    (shell-command "xinput disable \"SYNA2393:00 06CB:CD48 Touchpad\""))
  (message "touchpad disabled.")
  )

(defun gwp/turn-on-touchpad (&optional frame)
  (interactive)
  (let ((inhibit-message t) (default-directory "~"))
    (shell-command "xinput enable \"SYNA2393:00 06CB:CD48 Touchpad\""))
  (message "touchpad enabled.")
  )

(map! :leader
      (:prefix-map ("t" . "toggle")
       :desc "ç¦ç”¨é¼ æ ‡" "m" #'gwp/turn-off-touchpad
       :desc "ç¦ç”¨é¼ æ ‡" "M" #'gwp/turn-on-touchpad
       ))
#+end_src
*** mark/selection
**** advanced selection
- [[https://stackoverflow.com/questions/18102004/emacs-evil-mode-how-to-create-a-new-text-object-to-select-words-with-any-non-sp][create a new text object in Evil]]

#+name: be09bc09
#+begin_src emacs-lisp
;; expand selection
;; http://xahlee.org/emacs/modernization_mark-word.html
;; by Nikolaj Schumacher, 2008-10-20. Released under GPL.
(defun semnav-up (arg)
  (interactive "p")
  (when (nth 3 (syntax-ppss))
    (if (> arg 0)
        (progn
          (skip-syntax-forward "^\"")
          (goto-char (1+ (point)))
          (decf arg))
      (skip-syntax-backward "^\"")
      (goto-char (1- (point)))
      (incf arg)))
  (up-list arg))

(defun gwp/select-text-in-quote ()
  "Select text between the nearest left and right delimiters.
Delimiters are paired characters: ()[]<>Â«Â»â€œâ€â€˜â€™ã€Œã€, including \"\"."
  (interactive)
  (let (b1)
    (skip-chars-backward "^<>(â€œ{[ã€ŒÂ«\"â€˜")
    (setq b1 (point))
    (skip-chars-forward "^<>)â€}]ã€Â»\"â€™")
    (point)
    (set-mark (- b1 1))))

(defun gwp/select-none-blank-text ()
  "é€‰æ‹©å…‰æ ‡ä¸‹éç©ºæ ¼æ–‡å­—"
  (interactive)
  (let (b1)
    (skip-chars-backward "^ \n")
    (setq b1 (point))
    (skip-chars-forward "^ \n")
    (backward-char 1)
    (point)
    (set-mark b1)))

(defun gwp/select-word-dwim ()
  "é€‰æ‹©è¿ç»­çš„è‹±æ–‡å­—è¯(ä¸åŒ…æ‹¬æ±‰å­—)"
  (interactive)
  (let ((regexp "[\.-_A-Za-z0-9]") b1)
    (when (or (looking-at regexp)
              (er/looking-back-on-line regexp))
      (skip-chars-backward regexp)
      (setq b1 (point))
      (skip-chars-forward regexp)
      (backward-char)
      (point)
      (set-mark b1))))

;; https://github.com/magnars/expand-region.el
;; (require 'expand-region)
;; (global-set-key (kbd "M-4") 'er/expand-region)
#+end_src

#+begin_src elisp
;; https://stackoverflow.com/a/22418983
(defmacro define-and-bind-text-object (key start-regex end-regex)
  (let ((inner-name (make-symbol "inner-name"))
        (outer-name (make-symbol "outer-name")))
    `(progn
       (evil-define-text-object ,inner-name (count &optional beg end type)
         (evil-select-paren ,start-regex ,end-regex beg end type count nil))
       (evil-define-text-object ,outer-name (count &optional beg end type)
         (evil-select-paren ,start-regex ,end-regex beg end type count t))
       (define-key evil-inner-text-objects-map ,key (quote ,inner-name))
       (define-key evil-outer-text-objects-map ,key (quote ,outer-name)))))

; between pipe characters:
(define-and-bind-text-object "|" "|" "|")
(define-and-bind-text-object "d" "\"" "\"")
#+end_src

**** transient key
#+name: 8fac8bf1
#+begin_src elisp
;; (use-package expand-region :after evil :config
;;   (map! :leader :v "v"
;;         (function er/expand-region)))

(require 'transient)
(transient-define-prefix gwp/advanced-selection ()
  "Advanced selection"
  [["å¸¸è§„é€‰æ‹©"
    ("p" "select paragraph" er/mark-paragraph)
    ("c" "select comment" er/mark-comment)
    ("b" "select none blank" gwp/select-none-blank-text)
    ("t" "select text in quote" gwp/select-text-in-quote)
    ("w" "select word" gwp/select-word-dwim)
    ]]
  [["ç‰¹æ®Šé€‰æ‹©"
    ("u" "mark url" er/mark-url)
    ("c" "mark org code block" er/mark-org-code-block)
    ("e" "mark email" er/mark-email)
    ]]
  )
#+end_src

*** multiedit
: SPC-v-m-m
è¿›è¡Œå¤šç‚¹ç¼–è¾‘æ¨¡å¼, é€‰ä¸­å½“å‰symbolæˆ–é€‰ä¸­çš„è¯. æŒ‰n/Né€‰æ‹©ä¸‹ä¸€ä¸ªæˆ–å‰ä¸€ä¸ª. ä¸éœ€
è¦çš„å¯ç”¨Enterå–æ¶ˆæ‰. C-n/C-pè·³åˆ°åä¸€ä¸ªmatchæˆ–å‰ä¸€ä¸ª.
: SPC-v-m-i
è¿›å…¥å¤šç‚¹ç¼–è¾‘æ¨¡å¼, æ’å…¥ä¸€ä¸ªå…‰æ ‡. æˆ–M-iåå†æ’å…¥å¦ä¸€ä¸ª.

#+name: 4593181c
#+begin_src elisp
(use-package evil-multiedit
  :after evil
  :config
  (setq evil-multiedit-follow-matches t))

(defhydra gwp::hydra-multiedit ()
  "resize-window"
  ("i" evil-multiedit-toggle-marker-here "insert cursor here")
  ("m" evil-multiedit-match-and-next "match symbol at point")
  ("r" evil-multiedit-restore "restore prev matches")
  ("q" nil "quit"))

(map!
 (:after evil-multiedit
  (:map evil-multiedit-state-map
   "n"  #'evil-multiedit-match-and-next
   "N"  #'evil-multiedit-match-and-prev
   "M-i"  #'evil-multiedit-toggle-marker-here
   "C-p"  #'evil-multiedit-prev
   "C-n"  #'evil-multiedit-next
   "RET"    #'evil-multiedit-toggle-or-restrict-region
   [return] #'evil-multiedit-toggle-or-restrict-region)))
#+end_src

*** bibtex
ç”¨äºæœç´¢zoteroå¯¼å‡ºçš„bibtexæ–‡çŒ®. bibtexä¸­keywordså¯¹åº”zoteroä¸­çš„tags
#+begin_src elisp
(setq bibtex-completion-bibliography
      '("~/Data/zotero/my.bib"))
(setq bibtex-completion-pdf-field "file")
(setq bibtex-completion-additional-search-fields '(keywords annotation note))
#+end_src

*** parens
#+name: 9786fedc
#+begin_src elisp
(defhydra gwp/hydra-smartparens (:hint nil)
  ("v" evil-visual-char)
  ("u" evil-undo)
  ("h" evil-backward-char)
  ("l" evil-forward-char)
  ("j" evil-next-line)
  ("k" evil-previous-line)
  ("(" sp-wrap-round "wrap in (round)")
  ("[" sp-wrap-square)
  ("{" sp-wrap-curly)
  ("'"  (lambda (&optional arg) (interactive "P") (sp-wrap-with-pair "'")))
  ("\""  (lambda (&optional arg) (interactive "P") (sp-wrap-with-pair "\"")))
  ("d" sp-unwrap-sexp "unwrap pair")
  ("q" nil "quit")
  )
#+end_src

*** last changes
å¿«é€Ÿè·³è½¬åˆ°ä¿®æ”¹çš„ä½ç½®, éå¸¸æ–¹ä¾¿.
#+name: 1c79ba79
#+begin_src elisp
(defhydra gwp::hydra-last-change ()
  ("N" goto-last-change "last change")  ; ç”¨ p æŒ‰é”®å®¹æ˜“è¯¯æ“ä½œ, ç”¨N å®‰å…¨äº›
  ("n" goto-last-change-reverse "previous change")
  ("c" recenter "recenter")
  ("o" gwp::org-show-context-at-point "org show context")
  ("q" nil "quit"))
#+end_src
*** packages
:PROPERTIES:
:header-args: :tangle pkg/.doom.d/modules/gwp/edit/packages.el
:END:
#+name: 1dfc22ab
#+begin_src elisp
(package! symbol-overlay)
(package! move-dup)
(package! simpleclip)
#+end_src

** org
*** config.el
:PROPERTIES:
:header-args: :tangle pkg/.doom.d/modules/gwp/org/config.el
:END:
#+name: abd5e254
#+begin_src emacs-lisp
;; If you use `org' and don't want your org files in the default location below,
;; change `org-directory'. It must be set before org loads!
(setq org-directory "~/Notes/")
(setq org-roam-directory "~/Notes/roam")
(setq org-roam-file-extensions '("note" "org"))

(use-package! org
  :init
  ;; treat .note files as org-mode
  (add-to-list 'auto-mode-alist '("\\.note\\'" . org-mode))
  (add-to-list 'auto-mode-alist '("NOTE" . org-mode))
  :config
  (load! "org"))

;; https://github.com/org-roam/org-roam-ui#doom
(use-package! websocket
  :after org-roam)

(use-package! org-roam-ui
  :after org-roam ;; or :after org
  :hook (org-roam . org-roam-ui-mode)
  :config)

(use-package! evil-org-agenda
  :hook (org-agenda-mode . evil-org-agenda-mode)
  :config
  (evil-org-agenda-set-keys)
  (evil-define-key* 'motion evil-org-agenda-mode-map
    (kbd doom-leader-key) nil))

(use-package! init-note)
#+end_src

*** org.el
:PROPERTIES:
:header-args: :tangle pkg/.doom.d/modules/gwp/org/org.el
:END:
**** docs
è¿™é‡Œæ”¾orgé…ç½®ç›¸å…³çš„å†…å®¹, åœ¨config.elä¸­ä»¥load!å®æ¥åŠ è½½.

å…³äºTabé”®
- é»˜è®¤æ˜¯expand outline. å¦‚æœè¿ç»­æŒ‰ä¼šå±•å¼€æ›´æ·±å±‚çš„. æ­¤æ—¶å¯ç§»åŠ¨ä¸‹å…‰æ ‡, å†å›å»æŒ‰TABå°±ä¼šç¼©å›outlineçŠ¶æ€.

é…ç½®å‚è€ƒ:
- [[http://doc.norang.ca/org-mode.html][Org Mode - Organize Your Life In Plain Text!]]
- [[https://github.com/kaushalmodi/.emacs.d/blob/master/setup-files/setup-org.el][.emacs.d/setup-org.el at master Â· kaushalmodi/.emacs.d]]

**** åŸºæœ¬è®¾ç½®
#+name: b28b06dc
#+begin_src elisp
(setq org-blank-before-new-entry nil)
(setq org-default-notes-file (concat org-directory "/life.note"))

;; ä¿ç•™ä»¥å‰çš„ Alt-Return é”®è¡Œä¸º, Alt-Return
(org-defkey org-mode-map [(meta return)] 'org-meta-return)

;; ç¦ç”¨å­—è¯æ£€æŸ¥, éœ€è¦äº†å†å¼€
(remove-hook! 'org-mode-hook #'flyspell-mode)
(flyspell-mode 0)

;; https://orgmode.org/manual/Clean-view.html
(setq org-startup-indented t)      ;Enable `org-indent-mode' on Org startup
(with-eval-after-load 'org-indent
  (setq org-indent-indentation-per-level 1)) ;; default = 2

;; å¯¹é½headlineä¸­çš„TAGs
(setq org-tags-column -80)

;; é¿å…è¯¯ç¼–è¾‘
(setq org-catch-invisible-edits 'show-and-error)
#+end_src

**** æŒ‰é”®è¡Œä¸º
#+name: d3c71916
#+begin_src elisp
;; ç»å¸¸æŒ‰é”™è¿™ä¸ªé”®, ç¦ç”¨ä¹‹ (Ctrl-c ;)
(put 'org-toggle-comment 'disabled t)
#+end_src

**** view
#+name: 7341aa84
#+begin_src elisp
;; æ–¹ä¾¿ç”¨ property æ¥æ§åˆ¶ image æ˜¾ç¤ºå¤§å°
(setq org-image-actual-width nil)

;; 2021-10-13: ç°ä¸ç”¨doomä¸­çš„org moduleäº†
;; å¯ä»¥è®¾ç½® :VISIBILITY: å±æ€§æ¥æ§åˆ¶subtreeçš„å¯è§†åº¦. doomé‡Œä¿®æ”¹äº†startupè®¾ç½®, èµ·
;; åä½œç”¨, å»æ‰:
;; (remove-hook! 'org-mode-hook #'+org-unfold-to-2nd-level-or-point-h)

;; 2021-10-13: FIXME: æ”¹äº†ä¹Ÿä¸è¡Œ
;; orgé»˜è®¤è®¾ç½®æœ‰äº›é—®é¢˜: å…‰æ ‡åœ¨propertiesæ—¶ä¸èƒ½å±•å¼€
;; See http://emacs.stackexchange.com/a/22540/304
;; (remove-hook 'org-cycle-hook #'org-cycle-hide-drawers)

;; é¿å…åˆ‡æ¢æ—¶é—ªçƒ
;; (setq org-startup-indented nil)
;; (remove-hook! 'org-mode-hook #'org-indent-mode)

;; é¿å…æ˜¾ç¤ºsubtreeä¹‹é—´å¤šä½™çš„ç©ºè¡Œ
(setq org-cycle-separator-lines 0)

;; toggle outlineæ—¶éšè—properties drawer. ä¸å¤ªç®¡ç”¨
;;
;; (setq org-startup-folded nil)
;; (setq org-hide-block-startup t)
;; (after! org
;;   (add-hook 'org-cycle-hook 'org-cycle-hide-drawers)
;;   )

(use-package org-superstar
  :init
  ;; â—‰ â—‹ â—† Â» â—‡ â–¶ â–·
  (setq org-superstar-headline-bullets-list '("â˜°" "â–¶" "â–·" "Â»"))
  (add-hook 'org-mode-hook (lambda () (org-superstar-mode 1))))

;; æ˜¾ç¤ºå…‰æ ‡æ‰€åœ¨å¤„çš„headline
(defun gwp::org-show-context-at-point ()
  (interactive)
  ;; ä»ä¸‹é¢çš„å‘½ä»¤çœ‹æ¥çš„
  ;; (call-interactively 'org-mark-ring-goto)
  ;; (org-show-context 'mark-goto)
  (org-show-subtree)
  (when (or (org-invisible-p) (org-invisible-p2)) (org-show-context 'mark-goto))
  (call-interactively 'org-reveal))

(map! :map org-mode-map
      :n "zo" #'gwp::org-show-context-at-point
      :n "zc" #'org-hide-entry)
#+end_src

**** dwim
***** enter-at-point
+org/dwim-at-point, åœ¨org-srcç¯å¢ƒ, ç›´æ¥ç¼–è¾‘ä»£ç , è€Œéæ‰§è¡Œ

#+name: fbbec921
#+begin_src elisp
;; å–è‡ªdoom org moudle
(defun gwp::org-dwim-at-point (&optional arg)
  "Do-what-I-mean at point.

If on a:
- checkbox list item or todo heading: toggle it.
- clock: update its time.
- footnote reference: jump to the footnote's definition
- footnote definition: jump to the first reference of this footnote
- table-row or a TBLFM: recalculate the table's formulas
- table-cell: clear it and go into insert mode. If this is a formula cell,
  recaluclate it instead.
- babel-call: edit org-src
- statistics-cookie: update it.
- latex fragment: toggle it.
- link: follow it
- otherwise, refresh all inline images in current tree."
  (interactive "P")
  (if (button-at (point))
      (call-interactively #'push-button)
    (let* ((context (org-element-context))
           (type (org-element-type context)))
      ;; skip over unimportant contexts
      (while (and context (memq type '(verbatim code bold italic underline strike-through subscript superscript)))
        (setq context (org-element-property :parent context)
              type (org-element-type context)))
      (pcase type
        (`clock (org-clock-update-time-maybe))

        (`footnote-reference
         (org-footnote-goto-definition (org-element-property :label context)))

        (`footnote-definition
         (org-footnote-goto-previous-reference (org-element-property :label context)))

        ((or `planning `timestamp)
         (org-follow-timestamp-link))

        (`babel-call
         (org-babel-lob-execute-maybe))

        (`statistics-cookie
         (save-excursion (org-update-statistics-cookies arg)))

        ;; Hacked by ybyygu at 2021-04-13
        ((or `src-block `inline-src-block)
         (org-edit-special arg))

        ((or `latex-fragment `latex-environment)
         (org-latex-preview arg))

        (`link
         (let* ((lineage (org-element-lineage context '(link) t))
                (path (org-element-property :path lineage)))
           (if (or (equal (org-element-property :type lineage) "img")
                   (and path (image-type-from-file-name path)))
               (org-toggle-inline-images)
             ;; å¼ºåˆ¶åœ¨æœ¬çª—å£æ‰“å¼€
             (let ((current-prefix-arg '(4)))     ; C-u
               (call-interactively #'gwp::org-open-at-point-dwim)))))

        ((guard (org-element-property :checkbox (org-element-lineage context '(item) t)))
         (let ((match (and (org-at-item-checkbox-p) (match-string 1))))
           (org-toggle-checkbox (if (equal match "[ ]") '(16)))))

        (_
         (if (or (org-in-regexp org-ts-regexp-both nil t)
                 (org-in-regexp org-tsr-regexp-both nil  t)
                 (org-in-regexp org-link-any-re nil t))
             (call-interactively #'org-open-at-point)
           ;; (+org--toggle-inline-images-in-subtree
           ;;  (org-element-property :begin context)
           ;;  (org-element-property :end context))
           ))))))

(map! :map org-mode-map
      :n [return]   #'gwp::org-dwim-at-point
      :n "RET"      #'gwp::org-dwim-at-point
      )
#+end_src


***** open-at-point
é»˜è®¤åœ¨å¦ä¸€çª—å£æ‰“å¼€é“¾æ¥, å¦‚æœä½¿ç”¨C-uå‚æ•°, åˆ™å¼ºåˆ¶åœ¨æœ¬çª—å£æ‰“å¼€.
#+name: 2f61258f
#+begin_src elisp
;; https://stackoverflow.com/questions/17590784/how-to-let-org-mode-open-a-link-like-file-file-org-in-current-window-inste
;; Depending on universal argument try opening link
(defun gwp::org-open-at-point-dwim (&optional arg)
  (interactive "P")
  (if arg (let ((org-link-frame-setup (quote ((file . find-file)))))
            (org-open-at-point))
    (let ((org-link-frame-setup (quote ((file . find-file-other-window)))))
      (org-open-at-point)
      (golden-ratio))))

;; æ³¨é‡Šä»£ç æ—¶, åœ¨org code blockä¸‹ç‰¹æ®Šå¤„ç†. ä¸ç„¶å…‰æ ‡ä¼šè·³å¼€å¾ˆè¿œ.
(defun gwp/comment-or-uncomment-dwim ()
  (interactive)
  (save-excursion
    (if (org-in-src-block-p)
        (progn
          (org-edit-src-code)
          (call-interactively 'evilnc-comment-or-uncomment-lines)
          (org-edit-src-exit))
      (call-interactively 'evilnc-comment-or-uncomment-lines))))

;; è¦†ç›–é»˜è®¤æŒ‰é”®
(map! :map org-mode-map "C-c C-o" #'gwp::org-open-at-point-dwim)
(map! :map org-mode-map
      :localleader
      "o" #'gwp::org-open-at-point-dwim)
#+end_src
**** move/movment
#+name: bbdcd834
#+begin_src elisp
(map! :map org-mode-map
      :n "gh" #'org-up-element
      :n "gl" #'org-down-element ; doomä¸­é»˜è®¤ä¸º: evil-lion-left
      :n "gk" #'org-backward-heading-same-level
      :n "gj" #'org-forward-heading-same-level
      :n "M-l" #'org-metaright   ; doomä¸­é»˜è®¤ä¸º demote-subtree
      :n "M-h" #'org-metaleft    ; doomä¸­é»˜è®¤ä¸º promote-subtree
      :n "M-k" #'org-metaup
      :n "M-j" #'org-metadown
      :n "M-p" #'org-backward-element
      :n "M-n" #'org-forward-element
      )
#+end_src

**** screenshot
- org-contrib: [[file:doom-emacs/.local/straight/repos/org-mode/contrib/lisp/org-screenshot.el][org-screenshot.el]]

ç›®å‰æœ€ä½³æ–¹æ¡ˆ: ä½¿ç”¨org-downloadæ¥å®ç°å±å¹•æˆªå›¾çš„åŠŸèƒ½
- åœ¨firefoxæˆ–screenshotç­‰æˆªå›¾åå¤åˆ¶åˆ°X11å‰ªè´´æ¿.
- è°ƒç”¨org-download-clipboardå®Œæˆå›¾ç‰‡æ’å…¥æ“ä½œ.
  - å›¾ç‰‡è‡ªåŠ¨ä¿å­˜åˆ°org attachmentç›®å½•
  - è‡ªåŠ¨æ·»åŠ å›¾ç‰‡æ˜¾ç¤ºå‚æ•°, è®¾å®šåœ¨orgä¸­æ˜¾ç¤ºçš„å¤§å°
- å¯ä»¥ä½¿ç”¨org-download-deleteæ¥åˆ é™¤å½“å‰image

ç›®å‰çš„é—®é¢˜ ([2020-03-06 Fri])
- ç¬¬äºŒæ¬¡æ‰§è¡Œæˆªå›¾æ—¶, å¦‚æœclipboardæ— å›¾, emacsä¼šæŒ‚ä½, ç°åœ¨æ— è§£.

#+begin_src emacs-lisp
(defun gwp/org-image-attributes-default (&optional caption)
  "default image attributes: caption, name label, width ..."
  "Annotate LINK with the time of download."
  (format (concat
           (concat  "#+caption: " (read-string "Caption: " caption) "\n")
           ;; set unique figure name
           (format "#+name: fig:%s\n" (substring (org-id-new) 0 8))
           ;; unit in px; for displaying in org-mode
           "#+attr_org: :width 800\n"
           ;; unit in cm; for exporting as odt
           "#+attr_odt: :width 10\n"
           )))

(defun gwp/org-insert-image-attributes (&optional caption)
  "insert image attributes such as caption and labels"
  (interactive)
  (insert (gwp/org-image-attributes-default caption)))

(defun gwp/org-download-annotate (link)
  "Annotate LINK with the time of download."
  (gwp/org-image-attributes-default))

(use-package! org-download
  :commands
  org-download-delete
  org-download-yank
  org-download-clipboard
  :bind (:map org-mode-map
         ("C-c v" . org-download-clipboard))
  :config
  (progn
    (setq org-download-method 'attach
          org-download-annotate-function 'gwp/org-download-annotate
          ;; org-download-image-html-width 900 ; in px
          ;; org-download-image-latex-width 16 ; in cm
          ;; 2021-09-03: ç›´æ¥è°ƒç”¨org-download-clipboardå³å¯, ä»¥ä¸‹ä»£ç ä¸å¿…è¦
          ;; org-download-screenshot-method
          ;; (cond ((executable-find "txclip")  "txclip paste --image -o %s")
          ;;       ((executable-find "scrot") "scrot -s %s"))
          )))
#+end_src

å®‰è£…org-downloadåŒ…
#+begin_src emacs-lisp :tangle pkg/.doom.d/packages.el
(package! org-download)
#+end_src

**** latex preview
é»˜è®¤å…¬å¼é¢„è§ˆå›¾ç‰‡å¤ªå°, æ”¹å¤§ä¸€äº›([[https://emacs.stackexchange.com/questions/19880/font-size-control-of-latex-previews-in-org-files][URL]]).
- [[https://emacs.stackexchange.com/questions/30309/latex-preview-on-hidpi-display/30318#30318][LaTeX preview on HiDPI display - Emacs Stack Exchange]]
#+begin_src elisp
(setq org-format-latex-options (plist-put org-format-latex-options :scale 2.5))
#+end_src

**** org-babel
***** docs
å‚è€ƒ
- [[https://org-babel.readthedocs.io/en/latest/][Org Babel reference card]]

å¦‚ä½•å¯Ÿçœ‹nowebå±•å¼€åçš„ä»£ç :
- C-c C-v v: org-babel-expand-src-block

***** init
#+begin_src emacs-lisp
;; ä¸ç¼©è¿›org-srcå—ä¸­çš„ä»£ç .
;; æ³¨æ„: ä¸ç›´æ¥è®¾ç½®ä¸º"org-src-preserve-indentation t",
;; åªè®¾ç½®org-edit-src-content-indentationä¸º0, è¿™æ ·ä»…å½±å“ç¼–è¾‘çš„org, ä¸å½±å“tangle
;; å‡ºçš„ä»£ç . ä»¥å‰çš„orgæ–‡æ¡£å¯ä»¥é€æ­¥è°ƒå›æ¥
(setq org-src-preserve-indentation nil)
(setq org-edit-src-content-indentation 0) ;Default = 2

;; helper functions for literate programming
;; taking from: https://github.com/grettke/help/blob/master/Org-Mode_Fundamentals.org
(defun help/set-org-babel-default-header-args (property value)
  "Easily set system header arguments in org mode.

PROPERTY is the system-wide value that you would like to modify.

VALUE is the new value you wish to store.

Attribution: URL `http://orgmode.org/manual/System_002dwide-header-arguments.html#System_002dwide-header-arguments'"
  (setq org-babel-default-header-args
        (cons (cons property value)
              (assq-delete-all property org-babel-default-header-args))))

;; å‡ ä¸ªé‡è¦çš„header args:
(help/set-org-babel-default-header-args :padline "yes")
(help/set-org-babel-default-header-args :mkdirp "yes")
(help/set-org-babel-default-header-args :comments "link")
#+end_src
***** load
æ–¹ä¾¿åœ¨ org ä¸­ç›´æ¥æ‰§è¡ŒæŸäº›è„šæœ¬æ“ä½œ.
#+name: 0d8e352a
#+begin_src elisp
;; activate languages for evaluation
(org-babel-do-load-languages
 'org-babel-load-languages
 '(
   (python . t)
   (shell . t)
   (emacs-lisp . t) ;; this is the default
   ))
#+end_src

***** enter
#+begin_src emacs-lisp
;; ç¦ç”¨ä»£ç ç€è‰², å½±å“é€Ÿåº¦
;; (setq org-src-fontify-natively nil)

;; ç¼–è¾‘ä»£ç æ—¶åœ¨ä¸‹æ–¹æ–°å¼€çª—å£
;;(setq org-src-window-setup 'split-window-below)
(setq org-src-window-setup 'current-window)
;(setq org-src-window-setup 'reorganize-frame)
;;(setq org-src-window-setup 'other-frame)

;; è¿›å…¥ä»£ç ç¼–è¾‘æ¨¡å¼, æ”¹æˆå®¹æ˜“æŒ‰çš„
(map! :map org-mode-map
      :ni "C-c ;" #'org-edit-special
      :ni "C-c C-;" #'org-edit-special
      :localleader ";" #'org-edit-special
      )
#+end_src

***** toml
æ–¹ä¾¿å†™Cargo.toml, æŒ‡å®šä¸ºtomlä¸ºconf-toml-mode, è€Œä¸ç”¨å†™å…¨ "conf-toml".
#+begin_src elisp
;; Add convenience lang alias for markdown blocks
(add-to-list 'org-src-lang-modes '("toml" . conf-toml))
#+end_src

***** edit
- org-babel-demarcate-block: å¯ä»¥ç”¨æ¥å°†é€‰ä¸­ä»£ç åˆ†å‰²ä¸ºä¸åŒçš„ä»£ç å—.
- org-babel-do-key-sequence-in-edit-buffer: åœ¨å½“å‰ä»£ç ä¸‹ç›´æ¥æ‰§è¡Œsrc codeè¯­å¢ƒä¸‹çš„å‘½ä»¤

#+name: 84623fc4
#+begin_src emacs-lisp
;; ç”¨äºæ¿€æ´» localleader
(add-hook 'org-src-mode-hook #'evil-normalize-keymaps)

;; é»˜è®¤çš„ä¸å¤ªå¥½æŒ‰. ä¸èƒ½ç”¨C-c C-c, å®¹æ˜“ä¸åˆ«çš„æ¨¡å—å†²çª.
(map! :map org-src-mode-map
      "C-c ;"   #'org-edit-src-exit  ; ä¿å­˜é€€å‡º
      "C-c C-;" #'org-edit-src-exit  ; ä¿å­˜é€€å‡º
      "C-c C-k" #'org-edit-src-abort ; æ”¾å¼ƒä¿®æ”¹
      )
(map! :map org-src-mode-map
      :localleader
      ";" #'org-edit-src-exit
      "k" #'org-edit-src-abort
      )
(gwp-leader-def
  :keymaps 'org-src-mode-map
  "q" #'org-edit-src-exit
  )
#+end_src

***** jump to org blocks/links
#+name: 8aa4aca8
#+begin_src elisp
(defhydra gwp/org-jump-block ()
  "jump to org blocks"
  ("n" org-next-block "next block")
  ("p" org-previous-block "prev block")
  ("q" nil "quit")
  )

(defhydra gwp/org-jump-link ()
  "jump to org links"
  ("n" org-next-link "next link")
  ("p" org-previous-link "prev link")
  ("q" nil "quit")
  )
#+end_src

***** jump to file
ä»orgæ–‡ä»¶è·³è½¬åˆ°tangled file
- è¿™ä¸ªåŒ…å¯ç”¨äºä¸compileç­‰è·³è½¬é…åˆä½¿ç”¨ [[https://github.com/EricCrosson/help-find-org-mode][help-find-org-mode]]

#+name: fa928b1c
#+begin_src elisp
(defun gwp/org-babel-tangle-jump-to-file ()
  "Jump to tangle file for the source block at point."
  (interactive)
  (let ((mid (point))
        (element (org-element-at-point))
        (body-start (save-excursion
                      (progn
                        (org-babel-goto-src-block-head)
                        (next-line)
                        (point)
                        )))
        (tangle-file (cdr (assq :tangle (nth 2 (org-babel-get-src-block-info 'light)))))
        offset)
    (if tangle-file
        (let ((block-name (org-element-property :name element))
              (tangle-file (expand-file-name tangle-file)))
          (if (file-readable-p tangle-file)
              (progn
                ;; open tangled file
                (find-file tangle-file)
                ;; if code block has a name, we jump to that block
                (when block-name
                  (beginning-of-buffer)   ; if point restored, the searching could fail
                  (when (search-forward (format "::%s" block-name) nil t)
                    (next-line)
                    (beginning-of-line)
                    (setq offset (- mid body-start))
                    (forward-char offset)
                    (recenter)
                    )))
            (error "Cannot open tangle file %S" tangle-file)))
      (message "not in source block"))))
#+end_src

ä»¥ä¸‹ä¸ºç½‘ä¸Šæ·˜æ¥çš„ä»£ç , å¯å¼ƒ.
#+begin_src elisp :tangle no
;; https://emacs.stackexchange.com/questions/50649/jumping-from-a-source-block-to-the-tangled-file
(defun gwp/org-babel-tangle-jump-to-file ()
  "Jump to tangle file for the source block at point."
  (interactive)
  (let (file org-babel-pre-tangle-hook org-babel-post-tangle-hook)
    (cl-letf (((symbol-function 'write-region) (lambda (start end filename &rest _ignore)
                                                 (setq file filename)))
              ((symbol-function 'delete-file) #'ignore))
      (org-babel-tangle '(4)))
    (when file
      (setq file (expand-file-name file))
      (if (file-readable-p file)
          (find-file file)
        (error "Cannot open tangle file %S" file)))))
#+end_src

è·³å›æ¥å¯ç”¨(éœ€è¦é…åˆsrc block nameä¸€èµ·ä½¿ç”¨):
: org-babel-tangle-jump-to-org

å°†tangle fileä¸­çš„ä¿®æ”¹è¿”å›ç»™org
: org-babel-detangle

è¿˜æœ‰ä¸€ä¸ªhttps://github.com/mtekman/org-tanglesync.el. ä½†ä½¿ç”¨ä¸Šæœ‰é™åˆ¶ [[https://github.com/mtekman/org-tanglesync.el/issues/13][issue 13]].
***** jump to org
åŸç‰ˆçš„ä¼¼æœ‰bug, ä¸èƒ½ç²¾ç¡®å¤åŸå…‰æ ‡ä½ç½®.
#+name: 9b40c7cf
#+begin_src elisp
(defun gwp/org-babel-tangle-jump-to-org ()
  "Jump from a tangled code file to the related Org mode file."

  (require 'ol)
  (interactive)
  (let ((mid (point))
	start body-start end target-buffer target-char link block-name body)
    (save-window-excursion
      (save-excursion
    (while (and (re-search-backward org-link-bracket-re nil t)
            (not ; ever wider searches until matching block comments
             (and (setq start (line-beginning-position))
              (setq body-start (line-beginning-position 2))
              (setq link (match-string 0))
              (setq block-name (match-string 2))
              (save-excursion
                (save-match-data
                  (re-search-forward
                   (concat " " (regexp-quote block-name)
                       " ends here")
                   nil t)
                  (setq end (line-beginning-position))))))))
	(unless (and start (< start mid) (< mid end))
	  (error "Not in tangled code"))
        (setq body (buffer-substring body-start end)))
      ;; Go to the beginning of the relative block in Org file.
      (org-link-open-from-string link)
      (message "%s" link)
      (setq target-buffer (current-buffer))
      ;; (search-forward body)
      (if (string-match "[^ \t\n\r]:\\([[:digit:]]+\\)" block-name)
          (let ((n (string-to-number (match-string 1 block-name))))
            (if (org-before-first-heading-p) (goto-char (point-min))
              (org-back-to-heading t))
            ;; Do not skip the first block if it begins at point min.
            (cond ((or (org-at-heading-p)
                       (not (eq (org-element-type (org-element-at-point))
                		'src-block)))
                   (org-babel-next-src-block n))
                  ((= n 1))
                  (t (org-babel-next-src-block (1- n)))))
        (org-babel-goto-named-src-block block-name))
      (goto-char (org-babel-where-is-src-block-head))
      (forward-line 1)
      ;; Try to preserve location of point within the source code in
      ;; tangled code file.
      (let ((offset (- mid body-start)))
        (when (< end (+ offset (point))) ; ybyygu hacked here
          (forward-char offset)))
      (setq target-char (point)))
    (org-src-switch-to-buffer target-buffer t)
    (goto-char target-char)))
#+end_src

***** noweb
org-babel-expand-src-block (å¯ä»¥å±•å¼€noweb macro)

***** tangle
æ³¨æ„: tangle-subtreeæ—¶å¾—æ³¨æ„, å¯èƒ½ä¼šä»¥éƒ¨åˆ†å†…å®¹è¦†ç›–æ€»æ–‡ä»¶.
#+name: f1b57cf1
#+begin_src elisp
;; tangle blocks for current file at point
;; http://stackoverflow.com/questions/28727190/org-babel-tangle-only-one-code-block
;; call org-babel-tangle with C-u C-u
(defun gwp/org-babel-tangle-blocks()
  (interactive)
  ;; tangle blocks only for target file at point
  (let ((current-prefix-arg '(16)))     ; C-u C-u
    (call-interactively 'org-babel-tangle)))

;; narrow to subtree before calling org-babel-tangle
(defun gwp/org-tangle-subtree()
  "Tange src blocks in current subtree"
  (interactive)
  (org-narrow-to-subtree)
  (org-babel-tangle)
  (widen)
  )
#+end_src

å¦‚ä½•åœ¨ä»£ç ç¼–è¾‘çª—å£ä¸­tangle?
#+name: 566a6ed9
#+begin_src elisp
(defun gwp/org-edit-save-and-tangle ()
  "When in a sub-editing buffer, swith to the parent buffer and tangle the file blocks"
  (interactive)
  (save-excursion
    (org-edit-src-exit)
    ;; insert an unique code block name
    (gwp/org-src-insert-name)
    (call-interactively 'gwp/org-babel-tangle-blocks)
    (org-edit-src-code)))

(defun gwp/org-babel-tangle-dwim()
  "Tangle current file at point whenever in a sub-editing buffer or not"
  (interactive)
  ;; æ ‡è®°å½“å‰ä½ç½®
  (gwp::mark-current-position)
  (if (org-src-edit-buffer-p)
      (gwp/org-edit-save-and-tangle)
    (if (eq 'src-block (org-element-type (org-element-at-point)))
        (progn
          ;; insert an unique code block name
          (gwp/org-src-insert-name)
          (call-interactively 'gwp/org-babel-tangle-blocks))
      (message "not in source block"))))
#+end_src

ç¦ç”¨å½“å‰ä»£ç å—æˆ–æ•´ä¸ªheadline. å¦‚æœå†æ¬¡ä½¿ç”¨å³å–æ¶ˆæ’å…¥çš„header args. è¿˜å¯ä»¥ç”¨
org-delete-property åˆ é™¤ header-args
#+name: 661f0512
#+begin_src elisp
(defun gwp/org-babel-tangle-no()
  "Turn on or turn off tangling current code block"
  (interactive)
  (if (eq 'src-block (org-element-type (org-element-at-point)))
      (save-excursion
        (org-babel-goto-src-block-head)
        (if (re-search-forward ":tangle no" (line-end-position) t)
            (delete-region (match-beginning 0) (match-end 0))
          (org-babel-insert-header-arg "tangle" "no")))
    (org-set-property "header-args" ":tangle no")))
#+end_src

æ’å…¥ä¸€ä¸ªå”¯ä¸€çš„block name, æ–¹ä¾¿è·³è½¬
#+name: 1a4b128e
#+begin_src elisp
(defun gwp/org-src-insert-name ()
  "If it doesn't have a NAME property then assign it an unique name."
  (interactive)
  (let ((element (org-element-at-point)))
    (if (eq 'src-block (org-element-type element))
        (if (not (org-element-property :name element))
            (save-excursion
              (goto-char (org-babel-where-is-src-block-head))
              (let ((i (current-indentation)))
                (save-excursion (insert "#+name: " (substring (org-id-new) 0 8) "\n"))
                (indent-to i)))
          (message "source block alread named"))
      (message "not in source block"))))
#+end_src

***** template
- http://orgmode.org/manual/Languages.html

#+name: e9fca5dc
#+begin_src emacs-lisp
(with-eval-after-load 'ob
  (setq org-structure-template-alist
        '(
          ("py" . "src python :results output")
          ("rs" . "src rust")
          ("el" . "src emacs-lisp")
          ("sh" . "src sh")
          ))

  (defun gwp/org-babel-edit-structure-in-place (arg)
    "Insert source strcture and edit the source"
    (interactive "P")
    (call-interactively 'org-insert-structure-template)
    (call-interactively 'org-edit-src-code)
    ))
#+end_src

***** auto time-stamp
æ ¼å¼è®¾ç½®ä¸ºç±»org-mode, æ–¹ä¾¿æ’å…¥å’Œä¿®æ”¹. å‚è€ƒ: [[http://nullman.net/emacs/files/init-emacs.org][URL]]

#+begin_src emacs-lisp
(with-eval-after-load "ob-tangle"
  ;; update timestamps on tangled files
  (setq time-stamp-pattern "100/UPDATED:[ \t]+\\\\?[\"<]+%:y-%02m-%02d %3a %02H:%02M\\\\?[\">]")
  (defun org-babel-post-tangle-hook--time-stamp ()
    "Update timestamps on tangled files."
    (time-stamp)
    (save-buffer))
  (add-hook 'org-babel-post-tangle-hook 'org-babel-post-tangle-hook--time-stamp))
#+end_src

**** org-noter/pdf-view
pdf-view-fit-width-to-window
#+name: 37fef008
#+begin_src elisp
(use-package! org-noter
  :custom
  (org-noter-default-notes-file-names '("annotation.note")))

(use-package! pdf-tools
  :custom
  ;; ä¸€é¡µé¡µçœ‹æ›´æ–¹ä¾¿
  (pdf-view-continuous nil)
  :config
  ;; å®¹æ˜“è¢«doomçš„pdf moduleä¸­çš„è®¾ç½®è¦†ç›–, ä»¥ä¸‹ç›´æ¥åœ¨pdf/config.elä¸­ä¿®æ”¹
  ;; (setq-default pdf-view-display-size 'fit-width)

  (map! :map pdf-view-mode-map
        ;; é¼ æ ‡æ“ä½œ
        [C-mouse-5] (cmd! (pdf-view-shrink 1.10))
        [C-mouse-5] (cmd! (pdf-view-shrink 1.10))
        [mouse-9] (cmd! (pdf-view-previous-page-command))
        [mouse-8] (cmd! (pdf-view-next-page-command))
        ;; æ–¹ä¾¿æ ‡æ³¨, æŒ‰dç›´æ¥é«˜äº®é€‰ä¸­æ–‡æœ¬
        :v "d" #'pdf-annot-add-highlight-markup-annotation
        ;; æ–¹ä¾¿å•æ‰‹æ“ä½œ
        :n "d" #'pdf-view-scroll-up-or-next-page
        :n "a" #'pdf-view-scroll-down-or-previous-page
        ;; org-noterå¾ˆå¥½ç”¨
        :localleader
        (:prefix ("n" . "org-noter")
         "n" #'org-noter
         "i" #'org-noter-insert-note
         "I" #'org-noter-insert-precise-note
         )))
#+end_src

**** pairs
doomåŠ äº†å¾ˆå¤šæ²¡ç”¨çš„pair, æ¯”å¦‚ /, ~, *ç­‰. [2020-03-13 Fri] æŠ˜è…¾äº†ä¸€æ™šä¸Šæ‰è¯•å¥½.
#+begin_src elisp :tangle pkg/.doom.d/packages.el
(package! smartparens-org :ignore t)
#+end_src

[2020-05-16 Sat] doomæ›´æ–°åæ²¡è¿™äº›é—®é¢˜äº†
#+begin_src elisp :tangle no
(after! smartparens-org
  (sp-with-modes '(org-mode)
    (sp-local-pair "/" nil :actions :rem)
    (sp-local-pair "=" nil :actions :rem)
    (sp-local-pair "~" nil :actions :rem)
    (sp-local-pair "*" nil :actions :rem)
    (sp-local-pair "_" nil :actions :rem)))
#+end_src

**** narrow
[2021-10-02 Sat] å’Œorg-tree-to-indirect-bufferç›¸æ¯”, ä»¥ä¸‹ä»£ç åŠŸèƒ½ç±»ä¼¼, ä½†æ˜¯å…ˆç”Ÿæˆ
æ•´ä¸ªindirect bufferå†narrow, kill-bufferæ—¶ä¸å½±å“åŸbuffer.

[[https://www.reddit.com/r/orgmode/comments/dbsngi/finally_solving_the_lack_of_a_treeview_navigation/][Finally solving the lack of a tree-view navigation window in Org : orgmode]]

#+begin_src elisp
(defun ap/org-tree-to-indirect-buffer (&optional arg)
  "Create indirect buffer and narrow it to current subtree.
The buffer is named after the subtree heading, with the filename
appended.  If a buffer by that name already exists, it is
selected instead of creating a new buffer."
  (interactive "P")
  (let* ((new-buffer-p)
         (pos (point))
         (buffer-name (let* ((heading (org-get-heading t t))
                             (level (org-outline-level))
                             (face (intern (concat "outline-" (number-to-string level))))
                             (heading-string (propertize (org-link-display-format heading)
                                                         'face face)))
                        (concat heading-string "::" (buffer-name))))
         (new-buffer (or (get-buffer buffer-name)
                         (prog1 (condition-case nil
                                    (make-indirect-buffer (current-buffer) buffer-name 'clone)
                                  (error (make-indirect-buffer (current-buffer) buffer-name)))
                           (setq new-buffer-p t)))))
    (switch-to-buffer new-buffer)
    (when new-buffer-p
      ;; I don't understand why setting the point again is necessary, but it is.
      (goto-char pos)
      (rename-buffer buffer-name)
      (org-narrow-to-subtree))))

(advice-add 'org-tree-to-indirect-buffer :override 'ap/org-tree-to-indirect-buffer)
#+end_src

narrow åˆ°å½“å‰ä»£ç å—å¯¹åº”çš„ tangle æ–‡ä»¶æ‰€åœ¨çš„å±‚çº§. ä¸“æ³¨ç¼–è¾‘, ä¹Ÿä¸ç”¨æ‹…å¿ƒ tangle å‡ºçš„ä»£ç ä¸å…¨çš„é—®é¢˜.
#+name: ab0515d6
#+begin_src elisp
;;;###autoload
(defun gwp::org-babel-narrow-to-tangle-heading ()
  "narrowè‡³å½“å‰ä»£ç å—å¯¹åº”çš„ tangle æ–‡ä»¶æ‰€åœ¨çº§åˆ«"
  (interactive)
  (let ((tangle-file (cdr (assq :tangle (nth 2 (org-babel-get-src-block-info 'light)))))
        (start-position (point))
        offset)
    ;; :tangle no ä¸èƒ½ç®—
    (if (and tangle-file (not (string= tangle-file "no")))
        (save-excursion
          (if (search-backward (format ":tangle %s" tangle-file) nil t)
              (progn
                (setq offset (- start-position (point)))
                (ap/org-tree-to-indirect-buffer)
                (forward-char offset)
                (message "narrowed to heading: %s" tangle-file))
            (message "no root headline found")))
      (message "narrowed to headline at point")
      (ap/org-tree-to-indirect-buffer))))
#+end_src

**** zotero/ui                                                          :ATTACH:
:PROPERTIES:
:ID:       0cbea3c4-ceef-44b4-9d07-250080801511
:END:
[[file:rust-modules/rust-modules.note][rust-module.note]]

ä½¿ç”¨space-m-z-zæ‰“å¼€zoteroæœç´¢ç•Œé¢
æµç¨‹:
- æœç´¢æ–‡çŒ®
- é€‰ä¸­æ–‡çŒ®, å³é”®æˆ–Ctrl-o, æ‰“å¼€ivy actionsç•Œé¢
- é€‰æ‹©æ‰“å¼€é™„ä»¶, ctrl-o, æ‰“å¼€actionç•Œé¢, é€‰æ‹©æ ‡æ³¨

#+caption: æ–‡çŒ®PDFæ³¨è§£ç•Œé¢
#+name: fig:3381b8ba
#+attr_org: :width 800
#+attr_odt: :width 10
[[attachment:2021-08-25_16-19-20_screenshot.png]]

#+begin_src elisp
;; rust-modules
(add-to-list 'load-path "/home/ybyygu/Workspace/Programming/emacs/rust-modules")
(require 'zotero)

(defun gwp/zotero-search-by-tag (name)
  "Search Zotero entries by tag using ivy."
  (interactive "sTag: ")

  (let* ((candidates (zotero-search-items-by-tag name)))
    (ivy-read (format "Zotero entries: ")
              candidates
              :action '(2               ; set the default action to open attachments
                        ("o" gwp--ivy-action-open-link "Open link")
                        ("O" gwp--ivy-action-open-attachments "Open attachments")
                        ("r" gwp--ivy-action-show-related-items "Show Related Items")
                        ("i" gwp--ivy-action-insert-link "Insert link")))))

(defun gwp/zotero-search-by-collection (name)
  "Search Zotero entries by collection name using ivy."
  (interactive "sCollection: ")

  (let* ((candidates (zotero-search-items-by-collection name)))
    (ivy-read (format "Zotero entries: ")
              candidates
              :action '(2               ; set the default action to open attachments
                        ("o" gwp--ivy-action-open-link "Open link")
                        ("O" gwp--ivy-action-open-attachments "Open attachments")
                        ("r" gwp--ivy-action-show-related-items "Show Related Items")
                        ("i" gwp--ivy-action-insert-link "Insert link")))))

(defun gwp--ivy-action-show-related-items (x)
  "show related items from selection"
  (let* ((candidates (zotero-get-related-items x)))
    (ivy-read (format "Related: ")
              candidates
              :action '(2               ; set the default action to open attachments
                        ("o" gwp--ivy-action-open-link "Open link")
                        ("O" gwp--ivy-action-open-attachments "Open attachments")
                        ("r" gwp--ivy-action-show-related-items "Show Related Items")
                        ("i" gwp--ivy-action-insert-link "Insert link")))))

(defun gwp--ivy-action-annotate-attachment (pdf-file)
  "Annotate the attachment with org-noter."
  (let ((annotation-file (expand-file-name (car org-noter-default-notes-file-names) (file-name-directory pdf-file))))
    (progn
      ;; create an empty annotation file if not exists
      (unless (file-exists-p annotation-file) (write-region "" nil annotation-file))
      (org-open-file pdf-file)
      (org-noter))))

(defun gwp--ivy-action-open-attachments (x)
  "ivy completion for zotero attachments."
  (let* ((candidates (zotero-get-selected-item-attachment-paths x)))
    (ivy-read (format "Open attachment: ")
              candidates
              :action '(1               ; set the default action to open link
                        ("o" org-open-file "Open")
                        ("n" gwp--ivy-action-annotate-attachment "Annotate")))))

(defun gwp--ivy-action-insert-link (x)
  (let ((uri (zotero-get-selected-item-link x)))
    (if uri
        (progn
          (message "%s!" x)
          (insert "[[" uri "][" "zotero-item" "]]"))
      (error "No link extracted from: %s" x))))

(defun gwp--ivy-action-open-link (x)
  (let ((uri (zotero-get-selected-item-link x)))
    (if uri
        (progn
          (message "%s!" x)
          (org-link-open-from-string (format "[[%s]]" uri)))
      (error "No link extracted from: %s" x))))

(defun gwp/org-open-zotero-attachments-at-point (arg)
  "Handle zotero attachments in org-mode"
  (interactive "P")
  (let ((ct (org-element-context)))
    (if (eq 'link (org-element-type ct))
        (let ((link (org-element-property :raw-link ct)))
          (when link
            (let ((key (zotero-get-item-key-from-link link)))
              (if key
                  (gwp--ivy-action-open-attachments key)
                (error "Invalid zotero link!"))))))))

(defun gwp/org-open-zotero-related-at-point (arg)
  "Open related zotero items for zotero link at point"
  (interactive "P")
  (let ((ct (org-element-context)))
    (if (eq 'link (org-element-type ct))
        (let ((link (org-element-property :raw-link ct)))
          (when link
            (let ((key (zotero-get-item-key-from-link link)))
              (if key
                  (gwp--ivy-action-show-related-items key)
                (error "Invalid zotero link!"))))))))

(defun gwp/insert-new-zotero-item (arg)
  "Create a new zotero item (report)"
  (interactive "P")

  (let ((uri (zotero-create-new-note)))
    (if uri
        (progn
          (message "%s!" uri)
          (insert "[[" uri "][" "zotero-note" "]]"))
      (error "create zotero item failed!"))))

;; https://www.reddit.com/r/emacs/comments/f3o0v8/anyone_have_good_examples_for_transient/
(require 'transient)
(transient-define-prefix gwp/zotero-search-transient ()
  "Search zotero database"
  [["Search zotero items:"
    ("t" "search by tag" gwp/zotero-search-by-tag)
    ("c" "search by collection" gwp/zotero-search-by-collection)
    ("o" "open attachments at point" gwp/org-open-zotero-attachments-at-point)
    ("r" "open related items at point" gwp/org-open-zotero-related-at-point)
    ]]
  )
;; key bindings
(map! :map org-mode-map
      :localleader
      "z" #'gwp/zotero-search-transient
      "O" #'gwp/org-open-zotero-attachments-at-point)
#+end_src

**** zotero/link
#+begin_src elisp
;; since org 9
(org-link-set-parameters "zotero" :follow #'gwp/org-zotero-open :export #'gwp/org-zotero-export)

(defun gwp/org-zotero-open (path)
  (setq url (format "zotero:%s" path))
  (browse-url url))
#+end_src

**** zotero/export
æ”¯æŒ "zotero" é“¾æ¥çš„ç‚¹å‡»è¡Œä¸ºåŠodtå¯¼å‡º.

bibtexæ›´æ–°äº†item linkçš„æ ¼å¼.
ä¹‹å‰çš„:
: zotero://select/items/1_WZKAZKJG
æ–°çš„
: zotero://select/items/6974

[[zotero://select/items/1_IIAJ9MX2][@Cao2011JMCC]]

#+begin_src emacs-lisp
(with-eval-after-load 'org-compat
  (defun gwp/org-zotero-export (path desc format)
    "Create the export version of zotero link specified by PATH and
DESC. FORMATs understood are 'odt','latex and 'html."
    (cond
     ((eq format 'html)
      (format "<a href=\"zotero:%s\">%s</a>" path desc))
     ((eq format 'latex)
      (format "\\href{zotero:%s}{%s}" path desc))
     ((eq format 'odt)
      ;; (format "<text:a xlink:type=\"simple\" xlink:href=\"zotero:%s\">%s</text:a>" path desc)
      (gwp/org-zotero-export-odt path desc)
      )
     (t desc)
     )
    )
  )

;;;; The magic string of zitem:
;; ZOTERO_ITEM CSL_CITATION
;; {
;; "properties": {
;; "formattedCitation": "[1]",
;; "plainCitation": "[1]"
;; },
;; "citationItems": [
;;                   {
;;                   "uri": [
;;                           "http://zotero.org/users/15074/items/S5JM4V35"
;;                           ]
;;                   }
;;                   ],
;; "schema": "https://github.com/citation-style-language/schema/raw/master/csl-citation.json"
;; } %s-rnd

;; adopted from https://www.mail-archive.com/emacs-orgmode@gnu.org/msg48905.html
(defun gwp/org-zotero-export-odt (path desc)
  (let
      ((refmark "<text:reference-mark-start text:name=\"%s\"/>%s<text:reference-mark-end text:name=\"%s\"/>")
       (zitem "ZOTERO_ITEM CSL_CITATION {
    &quot;properties&quot;: {
        &quot;formattedCitation&quot;: &quot;%s&quot;,
        &quot;plainCitation&quot;: &quot;%s&quot;
    },
    &quot;citationItems&quot;: [
        {
            &quot;uri&quot;: [
                &quot;http://zotero.org/users/15074/items/%s&quot;
            ]
        }
    ],
    &quot;schema&quot;: &quot;https://github.com/citation-style-language/schema/raw/master/csl-citation.json&quot;
} %s ")

       (item-key (car (cdr (split-string path "_"))))
       (rnd (concat "RND" (substring (org-id-new) -10))))
    (setq zitem
          (format zitem
                  desc
                  desc
                  item-key
                  rnd)
          )
    (setq desc (format "%s" desc))
    (format refmark zitem desc zitem))
  )

#+end_src

**** odt export
odtå¯¼å‡ºæ—¶, å›¾è¡¨é»˜è®¤ä»¥å¤§çº²çº§åˆ«æ¥ç¼–å·. å¯¹äºä¸­æ–‡æ–‡æ¡£, å¦‚æœç« èŠ‚ä»¥ä¸­æ–‡ä¸€äºŒä¸‰ç¼–å·æ—¶,
å›¾è¡¨ç¼–å·é»˜è®¤ä¸ºä¸€.1, äºŒ.3. è¿™å¾ˆå¤æ€ª, è¿˜æ˜¯å–æ¶ˆçš„å¥½.

odtä½¿ç”¨dvipngå¯¼å‡ºå…¬å¼æ—¶ç”Ÿæˆçš„å›¾ç‰‡åˆ†è¾¨ç‡å¤ªä½, è¿™é‡Œæ”¾å¤§3å€, ç„¶åé€šè¿‡è®¾ç½®odt dpiä¸º
300(é»˜è®¤ä¸º96), å°†imageç¼©å°ä¸ºåŸå§‹å¤§å°.

æ³¨æ„latexå…¬å¼å›¾ç‰‡å¯¹åº”çš„ç›®å½•ltxpngåœ¨ox-odt.elä»£ç é‡Œå†™æ­»äº†, æ²¡æ³•ä¿®æ”¹ä¸ºå…¶å®ƒçš„.

#+begin_src emacs-lisp
(use-package ox-odt
  :config
  (progn
    ;; continually numbering captions without outline level
    (setq org-odt-display-outline-level 0)

    ;; useful for odt export using dvipng
    (setq org-format-latex-options (plist-put org-format-latex-options :html-scale 3.0))
    (setq org-odt-pixels-per-inch 300.0)
    )
  )
#+end_src

ç”±äºæ‰‹åŠ¨æ¢è¡Œçš„åŸå› , odtå¯¼å‡ºæ—¶, ä¸­æ–‡å­—ç¬¦é—´ä¼šæœ‰å¤šä½™çš„ç©ºæ ¼. ä¸‹é¢çš„è®¾ç½®ç”¨äºè§£å†³è¿™ä¸ªé—®é¢˜:
#+begin_src emacs-lisp
;; adopted from https://github.com/tumashu/emacs-helper/blob/master/eh-org.el
(defun gwp/clear-unwanted-space (text)
  "clear unwanted space when exporting org-mode to other formats"
  (let ((regexp "[[:multibyte:]]")
        (string text))
    ;; org-mode é»˜è®¤å°†ä¸€ä¸ªæ¢è¡Œç¬¦è½¬æ¢ä¸ºç©ºæ ¼ï¼Œä½†ä¸­æ–‡ä¸éœ€è¦è¿™ä¸ªç©ºæ ¼ï¼Œåˆ é™¤ã€‚
    (setq string
          (replace-regexp-in-string
           (format "\\(%s\\) *\n *\\(%s\\)" regexp regexp)
           "\\1\\2" string))
    ;; åˆ é™¤ç²—ä½“ä¹‹åçš„ç©ºæ ¼
    (dolist (str '("</b>" "</code>" "</del>" "</i>"))
      (setq string
            (replace-regexp-in-string
             (format "\\(%s\\)\\(%s\\)[ ]+\\(%s\\)" regexp str regexp)
             "\\1\\2\\3" string)))
    ;; åˆ é™¤ç²—ä½“ä¹‹å‰çš„ç©ºæ ¼
    (dolist (str '("<b>" "<code>" "<del>" "<i>" "<span class=\"underline\">"))
      (setq string
            (replace-regexp-in-string
             (format "\\(%s\\)[ ]+\\(%s\\)\\(%s\\)" regexp str regexp)
             "\\1\\2\\3" string)))
    string)
  )

(defun gwp/ox-odt-wash-text (text backend info)
  "å¯¼å‡º org file æ—¶ï¼Œåˆ é™¤ä¸­æ–‡ä¹‹é—´ä¸å¿…è¦çš„ç©ºæ ¼ã€‚"
  (when (org-export-derived-backend-p backend 'odt 'html 'latex)
    (gwp/clear-unwanted-space text)
    )
  )

(add-hook 'org-export-filter-headline-functions #'gwp/ox-odt-wash-text)
(add-hook 'org-export-filter-paragraph-functions #'gwp/ox-odt-wash-text)
#+end_src

**** encryption
#+begin_src emacs-lisp
(require 'org-crypt)
(require 'epa-file)
(epa-file-enable)

;; Encrypt all entries before saving
(org-crypt-use-before-save-magic)
(setq org-crypt-tag-matcher "crypt")
(setq org-tags-exclude-from-inheritance (quote ("crypt")))
                                        ; GPG key to use for encryption
(setq org-crypt-key "38D95BC6411A87E7") ; ybyygu@gmail.com
(setq org-crypt-disable-auto-save nil)
#+end_src

**** org-attach
***** setup
#+begin_src emacs-lisp
(require 'org-attach)
#+end_src

***** copy & paste attachments
#+begin_src emacs-lisp
(setq org-attach-store-link-p 'attached)

;; 1. store the ataach files into clipboard
(defun gwp/org-attach-copy (&optional force)
  "store org attachment directory of current enetry"
  (interactive "P")
  ;; make a temporary symlink to store the attachment path
  (if-let (attach-files (counsel-org-files))
      (let ((current-dir (if buffer-file-name (file-name-directory buffer-file-name) default-directory)))
        (zotero-attach-txclip-copy-files attach-files current-dir))
    (message "No attachment found")))

;; 2. paste the stored files to new location
(defun gwp/org-attach-paste (&optional force)
  "move stored attachments to current entry"
  (interactive "P")
  (let ((current-dir (file-name-directory buffer-file-name)))
    (zotero-attach-txclip-paste-files current-dir)))
#+end_src

****** old
:PROPERTIES:
:header-args: :tangle no
:END:
æ·»åŠ é™„ä»¶æ—¶ç”ŸæˆæŒ‡å‘é™„ä»¶çš„è·¯å¾„, æ–¹ä¾¿org-insert-linkæ·»åŠ .

ä½¿ç”¨è½¯é“¾æ¥ä¿å­˜å½“å‰entryçš„é™„ä»¶ç›®å½•. æ³¨æ„make-symbolic-linkçš„ç‰¹æ®Šæ€§:
- å¦‚æœdestæ˜¯ä¸ªç›®å½•, ä¼šåœ¨ç›®å½•ä¸‹å»ºç«‹ç›®å½•
- å¦‚æœdestæ˜¯ä¸ªæ–‡ä»¶æˆ–symlink, ä¼šæŠ¥é”™

file-exists-på‡½æ•°å¯¹symlinkçš„ç‰¹æ®Šæ€§:
- å¦‚æœæµ‹è¯•ç›®æ ‡æ˜¯ä¸ªboken symlink, è¯¥å‡½æ•°è¿”å›nil
- æ­¤å¤–åç»­å†symlink, ä»ç„¶ä¼šæŠ¥é”™.

#+begin_src emacs-lisp
;; 1. store the directory
(defun gwp/org-attach-copy (&optional force)
  "store org attachment directory of current enetry"
  (interactive "P")
  ;; make a temporary symlink to store the attachment path
  (setq file-attach-tmp (concat spacemacs-cache-directory ".gwp-attach-tmp"))
  (let ((attach-dir (org-attach-dir)))
    (when attach-dir
      (progn
        ;; remove existing directory
        (when (file-directory-p file-attach-tmp) (delete-directory file-attach-tmp t))
        ;; remove existing file and symlink
        (when (file-exists-p file-attach-tmp) (delete-file file-attach-tmp))
        ;; remove broken symlink
        (when (file-symlink-p file-attach-tmp) (delete-file file-attach-tmp))
        (make-symbolic-link attach-dir file-attach-tmp)
        (message (format "stored to: %s" file-attach-tmp))
        )
      )
    )
  )
#+end_src

ä»å­˜å‚¨çš„è½¯é“¾æ¥ä¸­è¯»å–ä¹‹å‰çš„entryçš„é™„ä»¶, å¹¶ç§»åŠ¨åˆ°å½“å‰entryçš„é™„ä»¶ç›®å½•é‡Œ.
#+begin_src emacs-lisp
;; 2. move the stored directory to new location
(defun gwp/org-attach-paste (&optional force)
  "move stored attachments to current entry"
  (interactive "P")
  ;; ~/.emacs.d/.cache/.gwp-attach-tmp
  (setq file-attach-tmp (concat spacemacs-cache-directory ".gwp-attach-tmp"))

  (if (file-exists-p file-attach-tmp)
      ;; create attachment directory if not exists using org-attach-dir function
      (let ((attach-dir (org-attach-dir t)))
        (progn
          ;; read old attach directory from previous stored symlink
          (setq attach-dir-old (file-chase-links file-attach-tmp))
          ;; sanity check
          (if (y-or-n-p (format "%s/* ==> %s ?" attach-dir-old attach-dir))
              (progn
                (shell-command (format "mv %s/* %s" attach-dir-old attach-dir))
                ;; remove stale tmp-link
                (delete-file file-attach-tmp)
                )
            (message "cancelled")
            )
          )
        )
    (message (format "no stored symbolic link found: %s" file-attach-tmp))
    )
  )
#+end_src

***** take file link as attachment
[2020-03-21 Sat] orgé‡Œæœ‰å¯¹åº”çš„åŠŸèƒ½: [[file:doom-emacs/.local/straight/repos/org-mode/contrib/lisp/org-attach-embedded-images.el][org-attach-embedded-images.el]]
****** ä»å½“å‰ä½ç½®æ–‡ä»¶é“¾æ¥æå–æ–‡ä»¶å.
#+begin_src emacs-lisp
(defun gwp/org-file-link-p (&optional element)
  (let ((el (or element (org-element-context))))
    (and (eq (org-element-type el) 'link)
         (or
          (string= (org-element-property :type el) "file")
          (string= (org-element-property :type el) "attachment")
          ))))

(defun gwp/org-file-path-at-point()
  "get file path from link at point"
  (let ((el (org-element-context)))
    (when (eq (org-element-type el) 'link)
      (cond
       ((string= (org-element-property :type el) "file") (org-element-property :path el))
       ((string= (org-element-property :type el) "attachment") (org-attach-expand (org-element-property :path el)))
       (t nil)
       ))))
#+end_src

****** ä½¿ç”¨org-attachå°†æ–‡ä»¶moveåˆ°å½“åˆ°é™„å½•ä¸­å¹¶æ›´æ–°æ–‡ä»¶é“¾æ¥
#+begin_src emacs-lisp
;; (require 'org-download)

(defun gwp/org-store-link-without-desc (file)
  "store file link without the description part -- a tweak to make odt image exporting correct."
  (setq org-stored-links
        (cons (list (org-attach-expand-link (file-name-nondirectory file)) "")
              org-stored-links)))

(defun gwp/org-take-as-local-attachment ()
  "move file link at point as local attachment"
  (interactive)
  (let ((file (gwp/org-file-path-at-point)))
    (if file
        (progn
          ;; 1. store the file using copy
          ;; or we can use the mv method: (org-attach-attach file nil 'mv)
          ;; do not store file link since it will corrupt odt image exporting
          (let ((org-attach-store-link-p nil))
            (org-attach-attach file))
          ;; 2. remove the old
          (call-interactively 'org-download-delete)
          ;; 3. insert the new
          ;; use file name as the default caption
          (gwp/org-insert-image-attributes (file-name-sans-extension (file-name-nondirectory file)))
          (insert "\n")
          (gwp/org-store-link-without-desc file)
          (call-interactively 'org-insert-last-stored-link)
          ;; refresh the image if possbile
          (org-display-inline-images))
      (user-error "Point is not on a link"))))
#+end_src

***** delete link file
åˆ é™¤å½“å‰æ‰€åœ¨é“¾æ¥å¯¹åº”çš„æ–‡ä»¶. org-download-deleteç°åœ¨ä¸å¯ç”¨(attachment link).
#+begin_src elisp
(defun gwp/org-delete-link-file (arg)
  "Delete the file that link points to."
  (interactive "P")

  (let ((file (gwp/org-file-path-at-point)))
    (if file
        (if (file-exists-p file)
            (when (yes-or-no-p (format "Delete link file: %s?" file))
              (progn (delete-file file)
                     (message "File deleted"))
              )
          (error "No such attachment: %s" file))
      (user-error "Point is not on a file link"))))
#+end_src
**** protocol
#+name: d3403c99
#+begin_src elisp
(require 'org-protocol)
#+end_src

**** capture
å ä½ç¬¦:
| %:link                            | URL of the web-page                                  |
| %:description                     | The title of the web-page                            |
| %:initial / %i                    | Selected text.                                       |
| %x                                | Content of the X clipboard.                          |
| %(org-get-x-clipboard 'CLIPBOARD) | å¼ºåˆ¶ä½¿ç”¨X clipboardå¤åˆ¶çš„å†…å®¹, è€Œéprimary clipboard |

#+begin_src emacs-lisp
(setq org-capture-templates
      '(
        ("n" "Note" entry (file "~/Notes/refile.note")
         "* %u %? %(org-get-x-clipboard 'CLIPBOARD)\n  %:initial\n" :prepend t)
        ("t" "Task" entry (file+headline "~/Notes/life.note" "Tasks")
         "* TODO %^T %? %(org-get-x-clipboard 'CLIPBOARD)\n  %i" :prepend t)
        ("r" "Research Memo" entry (file+headline "~/Notes/research.note" "Memo")
         "* %u %? %(org-get-x-clipboard 'CLIPBOARD)\n  %i\n" :prepend t)
        ("p" "Paper" entry (file+headline "~/Notes/research.note" "Literature")
         "* TODO %u %? %(org-get-x-clipboard 'CLIPBOARD)\n  %i\n" :prepend t)
        ("j" "Life Journal" entry (file+headline "~/Notes/life.note" "Journals")
         "* %u %? %(org-get-x-clipboard 'CLIPBOARD)\n  %i\n" :prepend t)
        ("N" "Note from protocol" entry (file "~/Notes/refile.note")
         "* %u %? [[%:link][%:description]]\n  %:initial\n" :prepend t)))
#+end_src

**** refile
refileæµç¨‹:
- æ‰“å¼€refile.note
- æ£€æŸ¥å…¶ä¸­çš„æ¡ç›®, æ‰¾åˆ°å¯èƒ½çš„åˆé€‚çš„å½’æ¡£.noteæ–‡ä»¶, æ‰“å¼€ä¹‹.
- SPC-m-r-r, org-refile
- SPC-u SPC-m-r-r: è·³è½¬è‡³refile targets

#+name: 568eea25
#+BEGIN_SRC emacs-lisp
(defun gwp/org-get-refile-targets ()
  "Return the list of files currently opened in emacs"
  (delq nil
        (mapcar (lambda (x)
                  (if (and (buffer-file-name x)
                           (string-match "\\.note$"
                                         (buffer-file-name x)))
                      (buffer-file-name x)))
                (buffer-list))))

;;(setq org-refile-targets '((gwp/org-get-refile-targets :tag . "Incoming")))
(setq org-refile-targets '((gwp/org-get-refile-targets :regexp . "^* Memo")))
(setq org-refile-use-outline-path nil)

(setq org-reverse-note-order t)
(defun gwp/get-org-file-link-path ()
  (save-excursion
    (beginning-of-line)
    (search-forward "[[file:" (line-end-position))
    (if (org-in-regexp org-bracket-link-regexp 1)
        (org-link-unescape (match-string-no-properties 1)))))
#+END_SRC

**** read/done
:PROPERTIES:
:header-args: :tangle no
:END:
åŸºæœ¬å¼ƒç”¨. æœ‰å¾…æ”¹è¿›.
#+begin_src elisp
(defun gwp/enter-to-read-state()
  "evoke external shell script when entering READ state"
  (when (equal org-state "READ")
    (setq file (gwp/get-org-file-link-path))
    (if file
        (progn
          (setq cmd (concat "org-to-read.sh " (shell-quote-argument file)))
          (message cmd)
          (shell-command cmd))))
  (when (equal org-last-state "READ")
    (message "try to remove READ state")
    (setq file (gwp/get-org-file-link-path))
    (if file
        (progn
          (setq cmd (concat "org-read-done.sh " (shell-quote-argument file)))
          (message cmd)
          (shell-command cmd)))))
(add-hook 'org-after-todo-state-change-hook 'gwp/enter-to-read-state)

;; show a sparse-tree in READ keyword
(defun gwp/org-show-read-tree ()
  "show a sparse-tree in READ keyword"
  (interactive)

  (let ((base-vector [?\C-u ?\M-x ?o ?r ?g ?- ?s ?h ?o ?w ?- ?t ?o ?d ?o ?- ?t ?r ?e ?e return ?R ?E ?A ?D return]))
    ;; create new macro of the form
    ;; C-u M-x org-show-todo-tree RET READ RET
    (execute-kbd-macro (vconcat base-vector
                                (vector 'return)))))
#+end_src

**** agenda
åŸºæœ¬è®¾ç½®
#+name: 43fd72e2
#+BEGIN_SRC emacs-lisp
(with-eval-after-load 'org-agenda
  ;; 2013-01-20: less is more
  ;; (setq org-agenda-files (append (file-expand-wildcards "~/Notes/*.note") (file-expand-wildcards "~/Notes/*/*.note")))
  (setq org-agenda-files "~/Notes/.agenda_files")

  ;; the default is todo-start
  (setq org-icalendar-use-scheduled (quote (event-if-not-todo event-if-todo todo-start)))
  (setq org-icalendar-alarm-time 5)

  ;; Show all future entries for repeating tasks
  (setq org-agenda-repeating-timestamp-show-all t)

  ;; do not show agenda dates if they are empty
  (setq org-agenda-show-all-dates nil)

  ;; Sorting order for tasks on the agenda
  (setq org-agenda-sorting-strategy
        (quote ((agenda time-up priority-down category-up)
                (todo priority-down)
                (tags priority-down))))

  ;; Start the weekly agenda today
  (setq org-agenda-start-on-weekday nil)

  ;; do not include todo items
  (setq org-agenda-include-all-todo nil))
#+END_SRC

å¿½ç•¥å·²ç»å®Œæˆçš„ä»»åŠ¡
#+begin_src emacs-lisp
(setq org-agenda-skip-deadline-if-done t)
(setq org-agenda-skip-scheduled-if-done t)
#+end_src

è‡ªå®šä¹‰agendaå‘½ä»¤
#+begin_src emacs-lisp
(with-eval-after-load 'org-agenda
  (setq org-agenda-custom-commands
               '(
                 ("g" . "GTD contexts") ; description for "g" prefix
                 )
               )
  ;; project overview
  (add-to-list 'org-agenda-custom-commands
               '("gp" "Project"
                 (
                  (tags "Project+Action+TODO=\"TODO\""
                        (
                         (org-agenda-overriding-header "Project\n------------------")
                         (org-agenda-sorting-strategy '(priority-down category-keep timestamp-up))
                         )
                        )
                  (tags "Action+Study+TODO=\"TODO\""
                        (
                         (org-agenda-overriding-header "Topics\n------------------")
                         (org-agenda-files '("~/Notes/research.note"))
                         (org-agenda-sorting-strategy '(priority-down timestamp-up))
                         (org-agenda-max-entries 5)
                         )
                        )
                  (tags "Action+TODO=\"TODO\""
                        (
                         (org-agenda-overriding-header "ç”Ÿæ´»çäº‹\n------------------")
                         (org-agenda-files '("~/Notes/life.note"))
                         (org-agenda-sorting-strategy '(priority-down timestamp-up))
                         (org-agenda-max-entries 5)
                         )
                        )
                  ;; (tags "Computer+TODO=\"TODO\""
                  ;;       (
                  ;;        (org-agenda-overriding-header "ç”µè„‘è°ƒä¼˜\n------------------")
                  ;;        (org-agenda-sorting-strategy '(priority-down timestamp-up))
                  ;;        (org-agenda-max-entries 5)
                  ;;        )
                  ;;       )
                  )
                 ;; options set here apply to the entire block
                 (
                  (org-tags-match-list-sublevels nil)
                  (org-agenda-prefix-format "%-20c ")
                  (org-agenda-todo-keyword-format "")
                  (org-agenda-remove-tags t)
                  (org-agenda-compact-blocks t)
                  )
                 )
               )

  (add-to-list 'org-agenda-custom-commands
               '("gr" "Reading"
                 (
                  (tags-todo "Reading|Read"
                             (
                              (org-agenda-overriding-header "å¾…è¯»åˆ—è¡¨\n------------------")
                              (org-agenda-sorting-strategy '(category-keep priority-down))
                              (org-agenda-remove-tags t)
                              (org-agenda-compact-blocks t)
                              )
                             )
                  (tags "REFILE"
                        (
                         (org-agenda-overriding-header "Tasks to Refile\n------------------")
                         (org-tags-match-list-sublevels nil)
                         )
                        )
                  )
                 ;; options set here apply to the entire block
                 ((org-agenda-compact-blocks t))
                 )
               )

  (add-to-list 'org-agenda-custom-commands
               '("gt" "Tasks"
                 (
                  (agenda ""
                          (
                           ;; (org-agenda-entry-types '(:deadline :scheduled))
                           (org-agenda-span (quote month)) ;; or (org-agenda-span 90)
                           (org-agenda-include-diary nil)
                           (org-agenda-overriding-header "Agenda\n------------------")
                           )
                          )
                  ;; (tags "ASAP+TODO=\"TODO\""
                  (tags-todo "ASAP"
                        (
                         (org-agenda-entry-types '(:timestamp))
                         (org-agenda-skip-function '(org-agenda-skip-entry-if 'scheduled))
                         (org-agenda-overriding-header "\nASAP\n------------------")
                         (org-agenda-sorting-strategy '(priority-down category-keep timestamp-up))
                         (org-agenda-max-entries 20)
                         (org-agenda-prefix-format "%-12c ")
                         (org-agenda-compact-blocks t)
                         )
                        )
                  )
                 ;; options set here apply to the entire block
                 (
                  (org-tags-match-list-sublevels nil)
                  ;; (org-agenda-files '("~/Notes/research.note" "~/Notes/life.note"))
                  (org-agenda-todo-keyword-format "")
                  (org-agenda-remove-tags t)
                  )
                 ;; agenda view exported with: Ctrl-C a e
                 ("~/Notes/agenda.html" "~/Notes/agenda.txt")
                 )
               )
  )
#+end_src

åå°è‡ªåŠ¨å¯¼å‡ºæ—¥ç¨‹. æš‚æ—¶ç¦ç”¨
#+BEGIN_SRC emacs-lisp :tangle no
;; disabled for upgrading to org-9.0
;; auto export agenda
(defun gwp/run-agenda-store ()
  ""
  (message "Exporting agenda... ")
  (org-batch-store-agenda-views)
  (message "Agenda exported."))

;; export agenda if I am away for 2 minutes
(run-with-idle-timer 600 t 'gwp/run-agenda-store)
#+END_SRC

é—²æ—¶æ˜¾ç¤ºæ—¥ç¨‹. æœ‰å…¼å®¹æ€§é—®é¢˜, æš‚æ—¶ç¦ç”¨.
#+begin_src emacs-lisp :tangle no
(use-package idle-org-agenda
  :after org-agenda
  :ensure t
  :config (idle-org-agenda-mode))

(custom-set-variables
 '(idle-org-agenda-interval 600) ;; 10 x 60 seconds
 '(idle-org-agenda-key "gt")     ;; Choose your specific agenda
 '(idle-org-agenda-mode t)
 )
#+end_src

**** org-file-apps
org-open-fileè°ƒç”¨pdf-toolsæ‰“å¼€PDFæ–‡ä»¶
#+begin_src elisp
(add-to-list 'org-file-apps
             '("\\.pdf\\'" . (lambda (file link)
                               (org-pdftools-open link))))
#+end_src

**** fix tab
è§£å†³æŒ‰tabé”®ä¹±çªœçš„é—®é¢˜
#+begin_src elisp
(add-hook 'org-mode-hook #'evil-normalize-keymaps)
#+end_src

**** my .note files
***** search all notes
æœç´¢æ‰€æœ‰~/.cache/notesç›®å½•ä¸‹æ‰€æœ‰.notesæ–‡ä»¶. ä¸ºäº†é¿å…symlinkæ–‡ä»¶ä¸å­˜åœ¨å¯¼è‡´ivyæŠ¥é”™,
æˆ‘ä»¬ä½¿ç”¨è‡ªå®šä¹‰è„šæœ¬ripgrep, å¼ºåˆ¶å‘½ä»¤é€€å‡ºç ä¸º0. æ³¨æ„~/.local/binåº”åœ¨PATHå˜é‡ä¸­.

#+begin_src shell :tangle ~/.local/bin/ripgrep :shebang #! /bin/bash
/usr/bin/rg $@

exit 0
#+end_src

#+name: 4971b464
#+begin_src emacs-lisp
;;;###autoload
(defun gwp/search-all-notes ()
  "search all notes in ~/.cache/notes"
  (interactive)
  ;; (defun counsel-rg (&optional initial-input initial-directory extra-rg-args rg-prompt)
  (let ((counsel-rg-base-command (list "ripgrep" "--follow" "-M" "240" "--with-filename" "--no-heading" "--line-number" "--color" "never" "%s")))
    (counsel-rg "" "~/.cache/notes")))
#+end_src

deadgrepä¸doomæœ‰å†²çª, ä¸èƒ½ç”¨äº†.
#+begin_src emacs-lisp :tangle no
(defun gwp/return-default-notes-dir ()
  "~/.cache/notes"
  )
(use-package! deadgrep
              :config
              (setq deadgrep-project-root-function #'gwp/return-default-notes-dir)
              )
#+end_src

***** find notes
#+name: 05419467
#+begin_src elisp
(defun gwp/find-file-in-notes ()
  "Find a file under `~/.cache/notes', recursively."
  (interactive) (doom-project-find-file "~/.cache/notes"))
#+end_src

**** misc
Org links to Unix man pages [[http://orgmode.org/manual/Adding-hyperlink-types.html][doc]]
#+begin_src emacs-lisp
;; (require 'org-man)
#+end_src

ç¦ç”¨*bold*ç­‰æ ‡æ³¨çš„å­—ä½“æ•ˆæœ. å†™ä»£ç æ—¶å®¹æ˜“å¼„èŠ±æ˜¾ç¤º. æ¯”å¦‚__init__.
#+begin_src emacs-lisp
(setq org-fontify-emphasized-text nil)
#+end_src

#+begin_src emacs-lisp :tangle no
(defun gwp/org-confirm-babel-evaluate (lang body)
  (not (string= lang "python")))  ; don't ask for python
(setq org-confirm-babel-evaluate 'gwp/org-confirm-babel-evaluate)
#+end_src

è‡ªåŠ¨ä¿å­˜ç¼–è¾‘çš„ä»£ç . [2018-12-17 Mon] will cause timerp error
#+begin_src emacs-lisp :tangle no
;; saving a source code buffer back into its base buffer
(setq org-edit-src-auto-save-idle-delay 1)
#+end_src

**** bindings
***** core
#+name: 917381e9
#+begin_src elisp
;; 2021-10-20: å¯ç”¨ gwp-leader-def æ¥ä»£æ›¿
;; å®šä¹‰ä¸€äº›ç‰¹åˆ«å¸¸ç”¨çš„å‘½ä»¤, ä»…åœ¨org-modeä¸­æ˜¾ç¤º
;; (defun gwp/org-mode-keys-hook ()
;;   ;; (evil-local-set-key 'normal (kbd "SPC RET") '+org/dwim-at-point)
;;   ;; (evil-local-set-key 'normal (kbd "SPC j t") 'gwp/org-babel-tangle-jump-to-file)
;;   ;; (evil-local-set-key 'normal (kbd "SPC d d") 'gwp/org-babel-tangle-dwim)
;; )
;; (add-hook 'org-mode-hook 'gwp/org-mode-keys-hook)
;; (defun gwp/org-src-mode-keys-hook ()
;;   (evil-local-set-key 'normal (kbd "SPC d d") 'gwp/org-babel-tangle-dwim))
;; (add-hook 'org-src-mode-hook 'gwp/org-mode-keys-hook)

;; [2021-10-04 Mon] leader mapæ˜¯å…¨å±€æ€§çš„, ä¸èƒ½åŠ¨æ€åŠ è½½å’Œå¸è½½
;; (map! :mode org-mode
;;       :leader
;;       ;; :when (equal major-mode 'org-mode)
;;       :desc "tangle blocks at point"      "o b" #'gwp/org-babel-tangle-dwim
;;       ;; :desc "execute in edit buffer"      "SPC" #'org-babel-do-key-sequence-in-edit-buffer
;;       ;; :desc "org-babel"                   "a"   org-babel-map;  æ¢ä¸ªå®¹æ˜“æŒ‰çš„é”®ä½
;;       :desc "Enter-dwim"                  "RET" #'+org/dwim-at-point
;;       )
#+end_src

***** edit
#+name: bfe4f470
#+begin_src elisp
(map! :map org-mode-map
      :localleader
      "-" #'org-ctrl-c-minus            ; toggle item (-)
      "*" #'org-ctrl-c-star             ; toggle headline (*)
      )
#+end_src

***** attach/agenda
#+name: c09b236a
#+begin_src elisp
(map! :map org-mode-map
      :localleader
      (:prefix ("a" . "attach/agenda")
       :desc "attachment" "a" #'org-attach
       :desc "agenda (next)"     "n" #'org-agenda
       ))
#+end_src

***** babel
#+name: 21ae7ae2
#+begin_src elisp
;; æ›´å¤šçš„å‘½ä»¤å®šä¹‰åœ¨org-babel-map
(map! :map org-mode-map
      :localleader
      :desc "previous block" "M-p" #'org-previous-block
      :desc "next block" "M-n" #'org-next-block
      (:prefix ("b" . "babel/buffer")
       :desc "check src block headers"    "c" #'org-babel-check-src-block
       :desc "insert header argument"     "i" #'org-babel-insert-header-arg
       :desc "view header arguments"      "I" #'org-babel-view-src-block-info
       :desc "demarcate block"            "d" #'org-babel-demarcate-block
       :desc "edit src codes in place"    "s" #'gwp/org-babel-edit-structure-in-place
       :desc "jump to tangled file"       "j" #'gwp/org-babel-tangle-jump-to-file
       :desc "insert header tangle no"    "n" #'gwp/org-babel-tangle-no
       :desc "execute in edit buffer"     "x" #'org-babel-do-key-sequence-in-edit-buffer
       :desc "tangle blocks in subtree"   "t" #'gwp/org-tangle-subtree
       :desc "name code block at point"   "SPC" #'gwp/org-src-insert-name
       :desc "tangle blocks in buffer"    "T" #'org-babel-tangle
       :desc "switch org buffer"          "b" #'org-switchb ; ä»¿SPC-b-b
       ))
#+end_src
***** edit
#+name: 8d8e9273
#+begin_src elisp
(map! :map org-mode-map
      :localleader
      (:prefix ("d" . "do")
       :desc "sort list" "s" #'org-sort-list ; å¯ç”¨äºç»™åˆ—è¡¨æ’åº, é»˜è®¤ä¸ºC-c ^
       ))
#+end_src

***** goto
#+name: a02d9b1f
#+begin_src elisp
(map! :map org-mode-map
      :localleader
      (:prefix ("g" . "goto")
       :desc "previous position"  "p" #'org-mark-ring-goto
       :desc "æ ‡è®°ä½ç½®"  "m" #'org-mark-ring-push
       :desc "Jump to org heading"  "g" #'counsel-org-goto
       ))
#+end_src
***** jump
#+name: 3bbc773a
#+begin_src elisp
(map! :map org-mode-map
      :localleader
      (:prefix-map ("j" . "org jump")
       :desc "è·³è½¬è‡³ä»£ç å—"              "b"   #'gwp/org-jump-block/body
       :desc "è·³è½¬è‡³é“¾æ¥"                "l"   #'gwp/org-jump-link/body
       :desc "è·³è½¬è‡³ tangled ä»£ç æ–‡ä»¶"   "t"   #'gwp/org-babel-tangle-jump-to-file
       ))
#+end_src

***** link
#+name: 32a3b56a
#+begin_src elisp
(map! :map org-mode-map
      :localleader
      :desc "next link"           [tab]   #'org-next-link
      :desc "prev link"           [backtab]   #'org-previous-link
      (:prefix ("l" . "links")
       "l" #'org-insert-link
       "D" #'gwp/org-delete-link-file
       ))
#+end_src
***** note
#+name: ac0d3d18
#+begin_src elisp
(map! :map org-mode-map
      :localleader
      (:prefix ("n" . "note/noter")
       "o" #'gwp::org-note::open-pdf
       "i" #'gwp::org-note::new-note
       ))

(map! :map dired-mode-map
      :localleader
      (:prefix ("n" . "note/noter")
       "n" #'gwp::org-note::dired-annotate-file-at-point
       ))
#+end_src

***** subtree/search
#+name: a393f96d
#+begin_src elisp
(map! :map org-mode-map
      :localleader
      (:prefix-map ("s" . "subtree/search")
       :desc "Demote" "l" #'org-demote-subtree
       :desc "Promote" "h" #'org-promote-subtree
       :desc "Archive" "A" #'org-archive-subtree
       :desc "Narrow" "n" #'ap/org-tree-to-indirect-buffer
       ;; ä»¿SPC-s-s
       :desc "Goto" "s" #'counsel-org-goto
       :desc "Goto (all)" "S" #'counsel-org-goto-all
       :desc "Toggle org-sidebar-tree" "t" #'org-sidebar-tree-toggle
       ))
#+end_src

***** todo/toggle
#+name: ebc6075d
#+begin_src elisp
(defun gwp::org-toggle-checkbox ()
  (interactive)
  (unless (org-at-item-p)
    (call-interactively #'org-toggle-item)
    )
  (let ((current-prefix-arg '(4)))     ; C-u
    (call-interactively #'org-toggle-checkbox)))

(map! :map org-mode-map
      :localleader
      :desc "TODO" "C-t" #'org-todo
      (:prefix ("t" . "todo/toggle/tag")
       :desc "TODO" "t" #'org-todo
       :desc "heading" "h" #'org-toggle-heading
       :desc "item" "i" #'org-toggle-item
       :desc "tag" "s" #'counsel-org-tag
       :desc "fixed-width markup (:)" ":" #'org-toggle-fixed-width
       "c" #'gwp::org-toggle-checkbox))
#+end_src

***** refile
#+name: f4447dfb
#+begin_src elisp
(map! :map org-mode-map
      :localleader
      (:prefix ("r" . "refile")
       :desc "refile entry" "r" #'org-refile
       :desc "refile but preserve subtree" "c" #'org-refile-copy))
#+end_src

***** export
#+name: d7c4714d
#+begin_src elisp
(map! :map org-mode-map
      :localleader
      (:prefix ("e" . "export")
       :desc "export dispatch" "e" #'org-export-dispatch
       ))
#+end_src

***** insert
#+name: 3d7188a4
#+begin_src elisp
(defun gwp::new-memo-time-stamp (arg)
  "Insert a new org-mode memo entry under heading at point."
  (interactive "P")
  (unless (org-at-heading-p)
    (org-up-element))
  (call-interactively 'evil-open-below)
  (call-interactively 'org-insert-todo-subheading)
  (call-interactively 'org-time-stamp-inactive)
  (insert " "))

(defun gwp::new-item-time-stamp (arg)
  (interactive "P")
  (evil-first-non-blank)
  (call-interactively 'org-insert-item)
  (call-interactively 'org-time-stamp-inactive)
  (insert " "))

(map! :map org-mode-map
      :localleader
      (:prefix ("i" . "insert")
       :desc "new memo entry" "m" #'gwp::new-memo-time-stamp ; ç®€åŒ–æ“ä½œ
       :desc "new item" "i" #'gwp::new-item-time-stamp
       :desc "inactive time-stamp" "t" #'org-time-stamp-inactive
       :desc "active time-stamp" "." #'org-time-stamp
       :desc "stored link" "l" #'org-insert-last-stored-link
       :desc "schedule" "s" #'org-schedule
       :desc "deadline" "d" #'org-deadline
       :desc "note" "n" #'org-add-note
       ))
#+end_src

***** toggle
#+name: 1e605e7a
#+begin_src elisp
(map! :map org-mode-map
      :localleader
      :desc "preview inline images"       "I"     #'org-toggle-inline-images
      :desc "preview latex fragments"     "L"     #'org-latex-preview
      :desc "Paste image from clipboard"  "C-v"   #'org-download-clipboard
      )
#+end_src

***** org-sidebar
ç”¨çš„ä¸å¤š
#+name: 1a561e81
#+begin_src elisp :tangle no
(map! :map org-sidebar-tree-map
      :localleader
      :n "RET" #'org-sidebar-tree-jump
      :n [return] #'org-sidebar-tree-jump
      )
#+end_src

***** gwp leader key
æœ€å¸¸ç”¨çš„æŒ‰é”®
#+name: fdd56fa5
#+begin_src elisp
(gwp-leader-def
  :keymaps 'org-mode-map
  "g" 'counsel-org-goto                        ; goto
  "t" 'org-todo                                ; todo
  "b" 'gwp/org-babel-tangle-dwim               ; babel
  "e" 'org-edit-special                        ; edit
  "a" 'org-attach                              ; attach
  "n" 'gwp::org-babel-narrow-to-tangle-heading ; narrow
  )

(gwp-leader-def
  :keymaps 'org-src-mode-map
  "b" 'gwp/org-babel-tangle-dwim
  )
#+end_src

*** packages.el
:PROPERTIES:
:header-args: :tangle pkg/.doom.d/modules/gwp/org/packages.el
:END:
#+name: c98fa262
#+begin_src elisp
(package! org)
(package! websocket)
(package! evil-org)
(package! org-roam)
(package! org-roam-ui)
(package! org-superstar)
(package! org-pdftools)
(package! org-download)
(package! org-noter)
(package! orgit)
(package! ob-ipython)
(package! org-sidebar)

(package! org-contrib
  :recipe (:host nil :repo "https://git.sr.ht/~bzg/org-contrib"))
#+end_src

** bindings
:PROPERTIES:
:header-args: :tangle pkg/.doom.d/modules/gwp/bindings/config.el
:END:
è¿˜æ˜¯è‡ªå®šä¹‰æ›´èˆ’æœäº›. ä»¥åhackä¸‹default +evil-bindings.elä»…ç”¨äºå–æ¶ˆæŸäº›ä¸ä¹ æƒ¯çš„æŒ‰
é”®. æ³¨æ„çš„é”®ä½å˜é‡ä¸º doom-leader-<xx>-map, å…¶ä¸­xxä¸º"prefix-map"åæ‰€å®šä¹‰çš„å†…å®¹,
æ¯”å¦‚ "doom-leader-workspace-map".

å¸¸ç”¨å‘½ä»¤
- regexp-builder
- apropos-value

*** core
ä¿å­˜æ–‡ä»¶åŒæ—¶æ ‡è®°å½“å‰ä½ç½®, æ–¹ä¾¿éšåè·³å›.
#+name: 2d76b8e4
#+begin_src elisp
(defun gwp::mark-and-save-buffer()
  "æ ‡è®°å…‰æ ‡æ‰€åœ¨ä½ç½®, å¹¶ä¿å­˜buffer"
  (interactive)
  (call-interactively #'gwp::mark-current-position)
  (save-buffer))

(map! :leader
      :desc "Save buffer" "SPC"         #'gwp::mark-and-save-buffer
      :desc "Universal argument"    "u" #'universal-argument
      :desc "Pop up scratch buffer" "x" #'doom/open-scratch-buffer
      :desc "Jump to previous mark" "," #'gwp::jump-to-previous-mark
      :desc "Switch to last buffer" "`" #'evil-switch-to-windows-last-buffer)

(map!
 "C-`"                             #'+popup/toggle
 "C-~"                             #'+popup/raise
 "C-x p"                           #'+popup/other)
#+end_src

*** a: ??
*** b: buffer
#+name: 19c9e88c
#+begin_src elisp
;; https://stackoverflow.com/a/10395406/173271
(require 'cl-lib)
(require 'recentf)

(defun gwp::find-last-killed-file ()
  (interactive)
  (let ((active-files (cl-loop for buf in (buffer-list)
                            when (buffer-file-name buf) collect it)))
    (cl-loop for file in recentf-list
          unless (member file active-files) return (find-file file))))

(map! :leader
      (:prefix-map ("b" . "buffer/bookmark")
       :desc "Switch workspace buffer"     "b"   #'persp-switch-to-buffer
       :desc "Switch buffer"               "B"   #'switch-to-buffer
       :desc "Kill buffer"                 "d"   #'kill-current-buffer
       :desc "delete buffer file"          "D"   #'doom/delete-this-file
       :desc "Kill buffer"                 "k"   #'kill-current-buffer
       :desc "Kill all buffers"            "K"   #'doom/kill-all-buffers
       :desc "Revert buffer"               "r"   #'revert-buffer
       :desc "Previous buffer"             "p"   #'previous-buffer
       :desc "Next buffer"                 "n"   #'next-buffer
       :desc "Save buffer"                 "s"   #'basic-save-buffer
       :desc "Save file as..."             "S"   #'write-file
       :desc "Clone indirect buffer"       "c"   #'clone-indirect-buffer-other-window
       :desc "Toggle narrowing"            "-"   #'doom/toggle-narrow-buffer
       :desc "Switch to last buffer"       "l"   #'evil-switch-to-windows-last-buffer
       :desc "New empty buffer"            "N"   #'evil-buffer-new
       :desc "ibuffer"                     "i"   #'ibuffer
       :desc "Open in new frame"           "o"   #'gwp::display-current-buffer-other-frame
       :desc "Kill other buffers"          "O"   #'doom/kill-other-buffers
       :desc "reopen killed file"          "u"   #'gwp::find-last-killed-file
       :desc "copy file path"              "y"   #'+default/yank-buffer-path
       :desc "Bury buffer"                 "z"   #'bury-buffer
       :desc "Kill buried buffers"         "Z"   #'doom/kill-buried-buffers
       :desc "Set bookmark"                "m"   #'bookmark-set
       :desc "Delete bookmark"             "M"   #'bookmark-delete
       ))
#+end_src

*** c: code
#+name: e78a01dd
#+begin_src elisp
(map! :leader
      (:prefix-map ("c" . "code/compile")
       :desc "Align the current region regexp"       "a"   #'align-regexp
       :desc "Comment or uncomment lines"            "l"   #'gwp/comment-or-uncomment-dwim
       :desc "Copy & comment"                        "y"   #'evilnc-copy-and-comment-lines
       :desc "å°†TABè½¬ä¸ºç©ºæ ¼"                         "SPC" #'untabify
       :desc "indent region"                         "TAB" #'indent-region ; æœ‰ç”¨
       :desc "indent region"                         [tab] #'indent-region ; æœ‰ç”¨
       :desc "Compile"                               "c"   #'compile
       :desc "Recompile"                             "C"   #'recompile
       :desc "highlight"                             "h"   gwp::symbol-overlay-map
       :desc "Jump to definition"                    "d"   #'+lookup/definition
       :desc "Jump to references"                    "D"   #'+lookup/references
       :desc "Evaluate buffer/region"                "e"   #'+eval/buffer-or-region
       :desc "Evaluate & replace region"             "E"   #'+eval:replace-region
       :desc "Format buffer/region"                  "f"   #'+format/region-or-buffer
       :desc "Find implementations"                  "i"   #'+lookup/implementations
       :desc "Jump to documentation"                 "k"   #'+lookup/documentation
       :desc "Send to repl"                          "s"   #'gwp/tmux-ipython-paste-region ; å’Œtmuxé…åˆ
       :desc "Find type definition"                  "t"   #'+lookup/type-definition
       :desc "Delete trailing whitespace"            "w"   #'delete-trailing-whitespace
       :desc "Delete trailing newlines"              "W"   #'doom/delete-trailing-newlines
       :desc "List errors"                           "x"   #'+default/diagnostics
       ))
#+end_src

*** d: dodo
#+name: 5e265fdb
#+begin_src elisp
(map! :leader
      (:prefix-map ("d" . "dodo")
       :desc "select text"   "s" #'gwp/advanced-selection
       :desc "resize window" "w" #'gwp/adjust-window-size/body
       :desc "smart parents" "p" #'gwp/hydra-smartparens/body
       ))
#+end_src

*** e: external
#+name: 6c75cff0
#+begin_src elisp
(map! :leader
      (:prefix-map ("e" . "external")
       :desc "ç¨‹åºçª—å£ç®¡ç†" "w" #'counsel-wmctrl
       :desc "å¯åŠ¨æ¡Œé¢ç¨‹åº" "a" #'counsel-linux-app
       ))
#+end_src

*** f: file/find
#+name: 9ef458a0
#+begin_src elisp
(map! :leader
      ;; æ³¨æ„ "file/find"ç‰¹æ„ä¸+evil-bindings.elä¸­å®šä¹‰çš„ä¸åŒ, ç”¨äºè¦†ç›–åŸæŒ‰é”®
      (:prefix-map ("f" . "file/find")
       :desc "Open bookmarks"              "b"   #'counsel-bookmark ; æœ‰ç”¨
       :desc "Jump to Dired buffer"        "j"   #'dired-jump ; æœ‰ç”¨
       :desc "Find .note files"            "n"   #'gwp/find-file-in-notes
       :desc "Find directory"              "d"   #'+default/dired
       :desc "Delete this file"            "D"   #'doom/delete-this-file
       :desc "Find file in emacs.d"        "e"   #'doom/find-file-in-emacsd
       :desc "Browse emacs.d"              "E"   #'doom/browse-in-emacsd
       :desc "Find file"                   "f"   #'find-file
       :desc "Find file from here"         "F"   #'+default/find-file-under-here
       :desc "Locate file"                 "l"   #'locate
       :desc "Open file/dir externally"    "o"   #'spacemacs/open-file-or-directory-in-external-app
       :desc "Find file in private config" "p"   #'doom/find-file-in-private-config
       :desc "Browse private config"       "P"   #'doom/open-private-config
       :desc "Recent files"                "r"   #'recentf-open-files
       :desc "Copy this file"              "C"   #'doom/copy-this-file
       :desc "Rename/move file"            "R"   #'doom/move-this-file
       :desc "Save file"                   "s"   #'save-buffer
       :desc "Save file as..."             "S"   #'write-file
       :desc "Sudo find file"              "u"   #'doom/sudo-find-file
       :desc "Sudo this file"              "U"   #'doom/sudo-this-file
       :desc "Yank file path"              "y"   #'+default/yank-buffer-path
       :desc "Yank file path from project" "Y"   #'+default/yank-buffer-path-relative-to-project)
      )
#+end_src
*** g: git
#+name: ac7488a5
#+begin_src elisp
(map! :leader
      (:prefix-map ("g" . "git")
       :desc "Revert file"                 "R"   #'vc-revert
       :desc "Copy link to remote"         "y"   #'+vc/browse-at-remote-kill
       :desc "Copy link to homepage"       "Y"   #'+vc/browse-at-remote-kill-homepage
       (:when (featurep! :ui hydra)
        :desc "SMerge"                    "m"   #'+vc/smerge-hydra/body)
       (:when (featurep! :ui vc-gutter)
        (:when (featurep! :ui hydra)
         :desc "VCGutter"                "."   #'+vc/gutter-hydra/body)
        :desc "Revert hunk"               "r"   #'git-gutter:revert-hunk
        :desc "Git stage hunk"            "s"   #'git-gutter:stage-hunk
        :desc "Git time machine"          "t"   #'git-timemachine-toggle
        :desc "Jump to next hunk"         "]"   #'git-gutter:next-hunk
        :desc "Jump to previous hunk"     "["   #'git-gutter:previous-hunk)
       (:when (featurep! :gwp magit) ; æ”¹ç”¨è‡ªå®šä¹‰ç‰ˆ
        :desc "Manage dotfiles (yadm)"    "y"   (cmd! (magit-status "/yadm::"))
        :desc "Magit dispatch"            "/"   #'magit-dispatch
        :desc "Magit file dispatch"       "."   #'magit-file-dispatch
        :desc "Forge dispatch"            "'"   #'forge-dispatch
        :desc "Magit switch branch"       "b"   #'magit-branch-checkout
        :desc "Magit status"              "g"   #'magit-status
        :desc "Magit status here"         "G"   #'magit-status-here
        :desc "Magit file delete"         "D"   #'magit-file-delete
        :desc "Magit blame"               "B"   #'magit-blame-addition
        :desc "Magit clone"               "C"   #'magit-clone
        :desc "Magit fetch"               "F"   #'magit-fetch
        :desc "Magit buffer log"          "L"   #'magit-log-buffer-file
        :desc "Git stage file"            "S"   #'magit-stage-file
        :desc "Git unstage file"          "U"   #'magit-unstage-file
        (:prefix ("f" . "find")
         :desc "Find file"                 "f"   #'magit-find-file
         :desc "Find gitconfig file"       "g"   #'magit-find-git-config-file
         :desc "Find commit"               "c"   #'magit-show-commit
         :desc "Find issue"                "i"   #'forge-visit-issue
         :desc "Find pull request"         "p"   #'forge-visit-pullreq)
        (:prefix ("o" . "open in browser")
         :desc "Browse file or region"     "o"   #'+vc/browse-at-remote
         :desc "Browse homepage"           "h"   #'+vc/browse-at-remote-homepage
         :desc "Browse remote"             "r"   #'forge-browse-remote
         :desc "Browse commit"             "c"   #'forge-browse-commit
         :desc "Browse an issue"           "i"   #'forge-browse-issue
         :desc "Browse a pull request"     "p"   #'forge-browse-pullreq
         :desc "Browse issues"             "I"   #'forge-browse-issues
         :desc "Browse pull requests"      "P"   #'forge-browse-pullreqs)
        (:prefix ("l" . "list")
         (:when (featurep! :tools gist)
          :desc "List gists"              "g"   #'+gist:list)
         :desc "List repositories"         "r"   #'magit-list-repositories
         :desc "List submodules"           "s"   #'magit-list-submodules
         :desc "List issues"               "i"   #'forge-list-issues
         :desc "List pull requests"        "p"   #'forge-list-pullreqs
         :desc "List notifications"        "n"   #'forge-list-notifications)
        (:prefix ("c" . "create")
         :desc "Initialize repo"           "r"   #'magit-init
         :desc "Clone repo"                "R"   #'magit-clone
         :desc "Commit"                    "c"   #'magit-commit-create
         :desc "Fixup"                     "f"   #'magit-commit-fixup
         :desc "Branch"                    "b"   #'magit-branch-and-checkout
         :desc "Issue"                     "i"   #'forge-create-issue
         :desc "Pull request"              "p"   #'forge-create-pullreq)))
      )
#+end_src

*** h: help
å¸®åŠ©ç³»ç»Ÿ
- apropos-value

#+name: e7792733
#+begin_src elisp
(map! :leader
      :desc "help"                  "h"    help-map
      )
#+end_src

*** i: insert
#+name: 4a4573c2
#+begin_src elisp
(map! :leader
      (:prefix-map ("i" . "insert")
       :desc "Snippet"                       "s"   #'yas-insert-snippet
       :desc "From clipboard"                "y"   #'+default/yank-pop
       :desc "Current file name"             "f"   #'+default/insert-file-path
       :desc "Current file path"             "F"   (cmd!! #'+default/insert-file-path t)
       :desc "Evil ex path"                  "p"   (cmd! (evil-ex "R!echo "))
       :desc "From evil register"            "r"   #'evil-ex-registers
       :desc "Unicode"                       "u"   #'insert-char
       ))
#+end_src

*** j: jump
#+name: 6ea0d271
#+begin_src elisp
(map! :leader
      (:prefix ("j" . "jump")
       :desc "org src"                "o" #'gwp/org-babel-tangle-jump-to-org
       :desc "search occurrence"      "j" #'gwp/evil-ex-search-avy-jump
       :desc "avy line"               "l" #'evil-avy-goto-line
       :desc "emacs mark ring"        "m" #'gwp::hydra-mark-ring-pop/body
       ))
#+end_src

*** l: load/workspace
#+name: 2598d642
#+begin_src elisp
(map! :leader
      (:prefix-map ("l" . "load/workspace") ;; ç”¨tabä¸æ–¹ä¾¿
       :desc "Load or witch workspace"   "l"   #'gwp/workspace/load-or-switch
       :desc "Switch workspace"          "TAB" #'+workspace/switch-to ; è°ƒæ•´ä¸‹
       :desc "Switch to last workspace"  "b"   #'+workspace/other ; æ¢ä¸ªå¥½æŒ‰çš„
       :desc "Next workspace"            "n"   #'+workspace/switch-right
       :desc "Previous workspace"        "p"   #'+workspace/switch-left
       :desc "Display tab bar"           "."   #'+workspace/display
       :desc "Switch to last workspace"  "`"   #'+workspace/other
       :desc "New named workspace"       "N"   #'+workspace/new-named
       :desc "Save workspace to file"    "s"   #'+workspace/save
       :desc "Delete session"            "x"   #'+workspace/kill-session
       :desc "Delete this workspace"     "d"   #'+workspace/delete
       :desc "Rename workspace"          "r"   #'+workspace/rename
       :desc "Restore last session"      "R"   #'+workspace/restore-last-session
       :desc "Switch to 1st workspace"   "1"   #'+workspace/switch-to-0
       :desc "Switch to 2nd workspace"   "2"   #'+workspace/switch-to-1
       :desc "Switch to 3rd workspace"   "3"   #'+workspace/switch-to-2
       :desc "Switch to 4th workspace"   "4"   #'+workspace/switch-to-3
       :desc "Switch to 5th workspace"   "5"   #'+workspace/switch-to-4
       :desc "Switch to 6th workspace"   "6"   #'+workspace/switch-to-5
       :desc "Switch to 7th workspace"   "7"   #'+workspace/switch-to-6
       :desc "Switch to 8th workspace"   "8"   #'+workspace/switch-to-7
       :desc "Switch to 9th workspace"   "9"   #'+workspace/switch-to-8
       :desc "Switch to final workspace" "0"   #'+workspace/switch-to-final
       ))
#+end_src

*** m: my? memo?

*** n: note/next
#+name: 1ad72c87
#+begin_src elisp
(map! :leader
      (:prefix-map ("n" . "note/next")
       :desc "Search notes for symbol"      "*" #'+default/search-notes-for-symbol-at-point
       :desc "Org agenda"                   "a" #'org-agenda
       :desc "Find .note files"             "f" #'gwp/find-file-in-notes
       :desc "Browse notes"                 "F" #'+default/browse-notes
       :desc "Org store link"               "l" #'org-store-link
       :desc "Tags search"                  "m" #'org-tags-view
       :desc "Org capture"                  "c" #'org-capture
       :desc "org-agenda"                   "n" (cmd! (org-agenda nil "gt"))
       :desc "Goto capture"                 "N" #'org-capture-goto-target
       :desc "Todo list"                    "t" #'org-todo-list
       :desc "Search notes"                 "s" #'+default/org-notes-search
       :desc "Search org agenda headlines"  "S" #'+default/org-notes-headlines
       :desc "View search"                  "v" #'org-search-view
       ))
#+end_src

*** o: org/open
#+name: fc304196
#+begin_src elisp
(map! :leader
      (:prefix-map ("o" . "org/open")
       :desc "Org attachment"        "a" #'org-attach
       :desc "org-agenda (GTD)"      "n" (cmd! (org-agenda nil "gt"))
       :desc "org-capture"           "c" #'org-capture
       :desc "Tags search"           "m" #'org-tags-view
       :desc "View search"           "v" #'org-search-view
       :desc "New frame"             "f" #'make-frame
       :desc "Select frame"          "F" #'select-frame-by-name
       :desc "REPL"                  "r" #'+eval/open-repl-other-window
       :desc "REPL (same window)"    "R" #'+eval/open-repl-same-window
       :desc "Toggle vterm popup"    "t" #'+vterm/toggle
       :desc "Open termerinal here"  "T" #'gwp/open-terminal-here ; æ‰“å¼€å¤–éƒ¨terminal
       ))
#+end_src

*** p: quit/session
#+name: 1f0c2364
#+begin_src elisp
(map! :leader
      (:prefix-map ("q" . "quit/session")
       :desc "Quit Emacs"                   "q" #'save-buffers-kill-terminal
       :desc "Restart & restore Emacs"      "r" #'doom/restart-and-restore
       :desc "Restart Emacs"                "R" #'doom/restart
       :desc "Delete frame"                 "f" #'delete-frame
       :desc "Clear current frame"          "F" #'doom/kill-all-buffers
       :desc "Kill Emacs (and daemon)"      "K" #'save-buffers-kill-emacs
       :desc "Quit Emacs without saving"    "Q" #'evil-quit-all-with-error-code
       :desc "Quick save current session"   "s" #'doom/quicksave-session
       :desc "Restore last session"         "l" #'doom/quickload-session
       :desc "Save session to file"         "S" #'doom/save-session
       :desc "Restore session from file"    "L" #'doom/load-session
       ))
#+end_src

*** r: resume/rings
emacså¯ä»¥è®°å½•æ‰€æœ‰markæ“ä½œçš„ä½ç½®(mark-ring), ä¹Ÿå¯ä»¥ç”¨må‘½ä»¤(evil-set-marke)æ‰‹åŠ¨è®¾ç½®ä½ç½®è®°å½•, ç„¶åéšæ—¶è·³è½¬å›æ¥.

#+name: 1c637dc8
#+begin_src elisp
(map! :leader
      (:prefix-map ("r" . "resume/rings")
       :desc "Open bookmarks"        "b" #'counsel-bookmark
       :desc "Resume last search"    "l" #'ivy-resume
       :desc "Evil registers"        "e" #'counsel-register
       :desc "Evil mark ring"        "r" #'counsel-mark-ring
       :desc "Evil markers"          "m" #'counsel-evil-marks
       :desc "Restore selection"     "v" #'evil-visual-restore
       :desc "Restore insert point"  "i" #'evil-insert-resume
       :desc "Last change"           "c" #'gwp::hydra-last-change/body
       :desc "Jump list"             "j" #'+ivy/jump-list
       ))
#+end_src

*** s: search
SPC-s-så’ŒSPC-s-bæœ‰ä»€ä¹ˆåŒºåˆ«?
#+name: 321efaf0
#+begin_src elisp
(map! :leader
      :desc "Search buffer at point"        "*" #'swiper-isearch-thing-at-point
      (:prefix-map ("s" . "search")
       :desc "Search all notes"             "n" #'gwp/search-all-notes ; å…¨å±€æœç´¢.noteæ–‡ä»¶
       :desc "Search buffer"                "s" #'+default/search-buffer ; èµ°isearchè·¯çº¿, å¯ä¸€è¡Œå¤šä¸ªåŒ¹é…
       :desc "Search buffer at point"       "S" #'swiper-isearch-thing-at-point
       :desc "Search buffer"                "b" #'swiper ; ä¸€è¡Œä»…ä¸€ä¸ªåŒ¹é…?
       :desc "Search buffer from clipboard" "y" #'gwp::swiper-from-clipboard
       :desc "Search all open buffers"      "B" #'swiper-all
       :desc "Jump to search occurrence"    ";" #'gwp/evil-ex-search-avy-jump
       :desc "Search current directory"     "d" #'+default/search-cwd
       :desc "Search other directory"       "D" #'+default/search-other-cwd
       :desc "Search .emacs.d"              "e" #'+default/search-emacsd
       :desc "fd in current dir"            "f" #'find-file-in-project-by-selected ; æœç´¢æ–‡ä»¶å
       :desc "Jump to symbol"               "i" #'imenu
       :desc "Locate file"                  "l" #'counsel-locate
       :desc "Jump list"                    "j" #'evil-show-jumps
       :desc "Jump to bookmark"             "m" #'bookmark-jump
       :desc "Look up online"               "o" #'+lookup/online
       :desc "Look up online (select)"      "O" #'+lookup/online-select
       :desc "Search project"               "p" #'+default/search-project
       :desc "Search other project"         "P" #'+default/search-other-project
       :desc "Jump to mark"                 "r" #'evil-show-marks
       (:prefix-map ("h" . "highlight")
        :desc "highlight symbol at point"         "." #'highlight-symbol-at-point
        :desc "highlight REGEXP"                  "h" #'highlight-regexp
        :desc "unhighlight regexp"                "u" #'unhighlight-regexp)))
#+end_src

*** t: toggle
#+name: 95d4be8a
#+begin_src elisp
(map! :leader
      (:prefix-map ("t" . "toggle")
       :desc "åˆ‡æ¢ç»ˆç«¯(vterm)"            "t" #'vterm-toggle
       :desc "Big mode"                   "b" #'doom-big-font-mode
       :desc "Debug on error"             "d" #'toggle-debug-on-error
       :desc "Flycheck"                   "f" #'flycheck-mode
       :desc "Frame fullscreen"           "F" #'toggle-frame-fullscreen
       :desc "Indent style"               "I" #'doom/toggle-indent-style
       :desc "Line numbers"               "l" #'gwp::toggle-line-numbers
       :desc "Read-only mode"             "r" #'read-only-mode
       ;; :desc "Spell checker"              "s" #'spell-fu-mode
       :desc "Spell checker"              "s" #'flyspell-mode
       :desc "Socks proxy"                "p" #'proxy-socks-toggle
       :desc "Soft line wrapping"         "w" #'visual-line-mode
       :desc "Zen mode"                   "z" #'+zen/toggle
       :desc "Zen mode (fullscreen)"      "Z" #'+zen/toggle-fullscreen
       ))
#+end_src

*** v: visual selection
#+name: d2dc925d
#+begin_src elisp
(map! :leader
      (:prefix-map ("v" . "visual")
       :desc "expand region"            "v" #'er/expand-region
       :desc "select text"              "s" #'gwp/advanced-selection
       :desc "jump to emacs mark ring"  "j" #'gwp::hydra-mark-ring-pop/body
       :desc "multi-cursor mode"        "m" #'gwp::hydra-multiedit/body))
#+end_src

*** w/W: window/frame
#+name: 011dce65
#+begin_src elisp
(map! :leader
      :desc "window"                "w"    evil-window-map ; é»˜è®¤ä¸ºC-w
      :desc "frame"                 "W"    ctl-x-5-map     ; æ¢ä¸ªå®¹æ˜“æŒ‰çš„é”®ä½
      )
#+end_src

*** y: Yank/paste
#+name: bc190292
#+begin_src elisp
(map! :leader
      (:prefix-map ("y" . "yank")
       :desc "Snippet"                       "s"   #'yas-insert-snippet
       :desc "From clipboard"                "y"   #'gwp::yank-dwim
       :desc "Current file name"             "f"   #'+default/insert-file-path
       :desc "Current file path"             "F"   (cmd!! #'+default/insert-file-path t)
       :desc "Evil ex path"                  "p"   (cmd! (evil-ex "R!echo "))
       :desc "From evil register"            "r"   #'evil-ex-registers
       :desc "Unicode"                       "u"   #'insert-char
       ))
#+end_src

*** z: ???
** misc
:PROPERTIES:
:header-args: :tangle pkg/.doom.d/modules/gwp/misc/config.el
:END:
*** packages.el
:PROPERTIES:
:header-args: :tangle pkg/.doom.d/modules/gwp/misc/packages.el
:END:

* modules/hack
æ–°æ€è·¯:
- fork doom-emacs, ä»…åšå¿…è¦çš„ä¿®æ”¹. å°†å…¶ä¸­çš„org moduleæ›´åå, æ”¾åˆ°pkgä¸‹è½½å…¥. è¿™æ ·æ˜“äºè·Ÿè¸ªå®˜æ–¹è¿›åº¦.
- æ–°çš„gwp/orgä¼šè¦†ç›–lang/orgä¸­çš„è®¾ç½®
- æ³¨æ„ä¿®æ”¹æ–‡ä»¶é¦–è¡Œçš„è·¯å¾„, ç‰¹åˆ«æ˜¯autoloads, å¦åˆ™ä¸èƒ½æ­£å¸¸åŠ è½½([2021-10-03 Sun] ä¼¼ä¹å·²ä¸éœ€è¦?):
  : -;;; lang/org/autoload/org-link.el -*- lexical-binding: t; -*-
  : +;;; ~/.doom.d/modules/gwp/org/autoload/org-link.el -*- lexical-binding: t; -*-
- æ³¨æ„ä¿®æ”¹makefileä¸­çš„stowç›¸å…³å†…å®¹, ä»¥å°†å¯¹åº”çš„moduleå®‰è£…è‡³ ~/.doom.d/modules/gwp

ä¿®æ”¹çš„æ¨¡å—:
** [[file:doom-hacks/modules/lang/org/config.el][org/config.el]]
** [[file:doom-hacks/modules/lang/rust/config.el][rust/config.el]]
** [[file:doom-hacks/modules/tools/pdf][pdf]]
** [[file:doom-hacks/modules/tools/magit/][magit/]]
** [[file:doom-hacks/modules/config/default][default]]

* snippets
:PROPERTIES:
:header-args: :comments nil
:END:
TABè‡ªåŠ¨è¡¥å…¨å¾ˆå¯æ€•, æ— æ„æŒ‰é”®, è¡¥å‡ºå¾ˆå¤šæ²¡ç”¨çš„ä¸œè¥¿. doomç³»ç»Ÿä¸‹private snippetsç›®å½•
ä¸º ~/.doom.d/snippets.

- [[https://github.com/hlissner/doom-snippets][hlissner/doom-snippets: The Doom Emacs snippets library]] [[file:doom-snippets][visit]]

** org-mode
*** begin_src
#+BEGIN_SRC snippet :tangle pkg/.doom.d/snippets/org-mode/begin_src
# -*- mode: snippet -*-
# name: #+begin_src
# key: <s
# --
,#+begin_src $1
$0
,#+end_src
#+END_SRC

*** begin_src shell
#+BEGIN_SRC snippet :tangle pkg/.doom.d/snippets/org-mode/begin_src_sh
# -*- mode: snippet -*-
# name: #+begin_src shell
# key: <sh
# --
,#+begin_src shell
$0
,#+end_src
#+END_SRC

*** begin_src elisp
#+BEGIN_SRC snippet :tangle pkg/.doom.d/snippets/org-mode/begin_src_elisp
# -*- mode: snippet -*-
# name: #+begin_src elisp
# key: <el
# --
,#+begin_src elisp
$0
,#+end_src
#+END_SRC

*** begin_src python
#+BEGIN_SRC snippet :tangle pkg/.doom.d/snippets/org-mode/begin_src_python
# -*- mode: snippet -*-
# name: #+begin_src python
# key: <p
# --
,#+begin_src python
$0
,#+end_src
#+END_SRC

*** begin_src rust
#+BEGIN_SRC snippet :tangle pkg/.doom.d/snippets/org-mode/begin_src_rust
# -*- mode: snippet -*-
# name: #+begin_src rust
# key: <r
# --
,#+begin_src rust
$0
,#+end_src
#+END_SRC

** rust-mode
*** cfg
: pkg/.doom.d/snippets/rust-mode/cfg
*** impl Default
#+BEGIN_SRC snippet :tangle pkg/.doom.d/snippets/rust-mode/impl_default
# -*- mode: snippet -*-
# name: impl Default
# key: Default
# --
impl Default for ${1:Type} {
    fn default() -> Self {
        ${0:Self::new()}
    }
}
#+END_SRC

*** structopt
#+BEGIN_SRC snippet :tangle pkg/.doom.d/snippets/rust-mode/structopt
# -*- mode: snippet -*-
# name: #[derive(StructOpt)]
# key: structopt
# --
#[derive(StructOpt, Debug, Clone)]
struct ${1:Cli} {
    #[structopt(long, short)]
    ${2:n}: ${0:usize}
}
#+END_SRC

*** if let
: pkg/.doom.d/snippets/rust-mode/if_let
*** deprecated
#+BEGIN_SRC snippet :tangle pkg/.doom.d/snippets/rust-mode/deprecated
# -*- mode: snippet -*-
# name: #deprecated(note=X);
# key: #dep
# --
#[deprecated(note = "$1")]
#+END_SRC

*** for
#+BEGIN_SRC snippet :tangle pkg/.doom.d/snippets/rust-mode/for
# -*- mode: snippet -*-
# name: for var in iterable { ... }
# key: for
# --
for ${1:var} in ${2:iterable} {
    $0
}
#+END_SRC

*** print
#+BEGIN_SRC snippet :tangle pkg/.doom.d/snippets/rust-mode/print
# -*- mode: snippet -*-
# name: print!("{}", value);
# key: print
# --
print!("${1:{}}", $2);
#+END_SRC

*** println
#+BEGIN_SRC snippet :tangle pkg/.doom.d/snippets/rust-mode/println
# -*- mode: snippet -*-
# name: println!("{}", value);
# key: println
# --
println!("${1:{}}", $2);
#+END_SRC

*** eprintln
#+BEGIN_SRC snippet :tangle pkg/.doom.d/snippets/rust-mode/eprintln
# -*- mode: snippet -*-
# name: eprintln!("{}", value);
# key: eprintln
# --
eprintln!("${1:{}}", $2);
#+END_SRC

*** fn
#+BEGIN_SRC snippet :tangle pkg/.doom.d/snippets/rust-mode/fn
# -*- mode: snippet -*-
# name: fn name() { ... }
# key: fn
# --
fn ${1:name}($2) {
   ${0:todo!()}
}
#+END_SRC

*** fnr
#+BEGIN_SRC snippet :tangle pkg/.doom.d/snippets/rust-mode/fnr
# -*- mode: snippet -*-
# name: fn name() -> Type { ... }
# key: fnr
# --
fn ${1:name}($2) -> ${3:Result<${4:()}>} {
     ${0:todo!()}
}
#+END_SRC

*** fnw
#+BEGIN_SRC snippet :tangle pkg/.doom.d/snippets/rust-mode/fnw
# -*- mode: snippet -*-
# name: fn name<T>(x: T) where T: Clone { ... }
# key: fnw
# --
fn ${1:name}<${2:T}>(${3:x: T}) where ${4:T: Clone} {
     $0
}
#+END_SRC

*** test
#+BEGIN_SRC snippet :tangle pkg/.doom.d/snippets/rust-mode/test
# -*- mode: snippet -*-
# name: #[test] fn test_name() { .. }
# key: #test
# --
#[test]
fn ${1:test_name}() {
   $0
}
#+END_SRC

*** result
: pkg/.doom.d/snippets/rust-mode/result

*** todo!
: pkg/.doom.d/snippets/rust-mode/todo

*** derive
: pkg/.doom.d/snippets/rust-mode/derive

*** main
#+BEGIN_SRC snippet :tangle pkg/.doom.d/snippets/rust-mode/main
# -*- mode: snippet -*-
# name: fn main() { ... }
# key: main
# --
fn main() {
   $0
}
#+END_SRC

** prog-mode
*** fixme
: pkg/.doom.d/snippets/prog-mode/fixme

*** todo
: pkg/.doom.d/snippets/prog-mode/todo

** elisp
: pkg/.doom.d/snippets/emacs-lisp-mode

* theme
[[file:emacs-material-theme/][file:~/Workspace/Programming/emacs/emacs-material-theme/]]

* Local variables
# Emacs:
# Local Variables:
# mode: org
# end:
